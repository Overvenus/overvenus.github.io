<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Android," />





  <link rel="alternate" href="/atom.xml" title="Neil" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.png?v=0.5.0" />






<meta name="description" content="PullToRefresh 与 SwipeRefreshLayout这段时间我在 Easyinking 公司实习， 做安卓开发。之前的 App 中大量使用 Android-PullToRefresh。这个轮子很经典，在较久版本的安卓上面也很好使，不过作者已经放弃维护了，在我们的 App 上也发现了一个诡异的BUG：与WebView配合使用时，在网络环境差的情况下会出现一次下拉多次刷新的情况，症状就">
<meta property="og:type" content="article">
<meta property="og:title" content="Android触屏事件处理分发--以SwipeRefreshLayout为例">
<meta property="og:url" content="http://neilsh.me/2015/08/13/dispatch_and_handle_motionevent_in_android/index.html">
<meta property="og:site_name" content="Neil">
<meta property="og:description" content="PullToRefresh 与 SwipeRefreshLayout这段时间我在 Easyinking 公司实习， 做安卓开发。之前的 App 中大量使用 Android-PullToRefresh。这个轮子很经典，在较久版本的安卓上面也很好使，不过作者已经放弃维护了，在我们的 App 上也发现了一个诡异的BUG：与WebView配合使用时，在网络环境差的情况下会出现一次下拉多次刷新的情况，症状就">
<meta property="og:image" content="http://ww1.sinaimg.cn/bmiddle/7f793092gw1ev1xydoiwoj20u01hcwoe.jpg">
<meta property="og:image" content="http://ww3.sinaimg.cn/bmiddle/7f793092gw1ev1ys28bm4j20u01hc12q.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/bmiddle/7f793092gw1ev1ytgovwpj20u01hcgve.jpg">
<meta property="og:image" content="http://ww2.sinaimg.cn/bmiddle/7f793092gw1ev34kpb2ldj20u01hc7an.jpg">
<meta property="og:image" content="http://ww4.sinaimg.cn/bmiddle/7f793092gw1ev34lnjl05j20u01hcn3v.jpg">
<meta property="og:image" content="http://ww3.sinaimg.cn/bmiddle/7f793092gw1ev34m7lgjxj20u01hcdmi.jpg">
<meta property="og:image" content="http://ww2.sinaimg.cn/bmiddle/7f793092gw1ev34y348moj20u01hc454.jpg">
<meta property="og:image" content="http://ww2.sinaimg.cn/bmiddle/7f793092gw1ev34xmt6cjj20u01hcn3w.jpg">
<meta property="og:image" content="http://ww4.sinaimg.cn/bmiddle/7f793092gw1ev34x7oe5fj20u01hcdm9.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/bmiddle/7f793092gw1ev3c6eyty8j20u01hc0zi.jpg">
<meta property="og:image" content="http://ww4.sinaimg.cn/bmiddle/7f793092gw1ev3c6qlmwhj20u01hcwl4.jpg">
<meta property="og:updated_time" content="2016-01-22T09:57:05.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android触屏事件处理分发--以SwipeRefreshLayout为例">
<meta name="twitter:description" content="PullToRefresh 与 SwipeRefreshLayout这段时间我在 Easyinking 公司实习， 做安卓开发。之前的 App 中大量使用 Android-PullToRefresh。这个轮子很经典，在较久版本的安卓上面也很好使，不过作者已经放弃维护了，在我们的 App 上也发现了一个诡异的BUG：与WebView配合使用时，在网络环境差的情况下会出现一次下拉多次刷新的情况，症状就">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>

  <title> Android触屏事件处理分发--以SwipeRefreshLayout为例 | Neil </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-69367210-1', 'auto');
  ga('send', 'pageview');
</script>







  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Neil</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Share something cool.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/me" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      
      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Android触屏事件处理分发--以SwipeRefreshLayout为例
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2015-08-13T14:33:00+08:00" content="2015-08-13">
              2015-08-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/08/13/dispatch_and_handle_motionevent_in_android/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/08/13/dispatch_and_handle_motionevent_in_android/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="PullToRefresh__u4E0E_SwipeRefreshLayout"><a href="#PullToRefresh__u4E0E_SwipeRefreshLayout" class="headerlink" title="PullToRefresh 与 SwipeRefreshLayout"></a>PullToRefresh 与 SwipeRefreshLayout</h2><p>这段时间我在 Easyinking 公司实习， 做安卓开发。之前的 App 中大量使用 <a href="https://github.com/chrisbanes/Android-PullToRefreshhttps://github.com/chrisbanes/Android-PullToRefresh" target="_blank" rel="external">Android-PullToRefresh</a>。这个轮子很经典，在较久版本的安卓上面也很好使，不过作者已经放弃维护了，在我们的 App 上也发现了一个诡异的BUG：与WebView配合使用时，在网络环境差的情况下会出现一次下拉多次刷新的情况，症状就是整个网页在那上下抽搐。在官方支持库 support-v4:22 中自带了一个类似的 SwipeRefreshLayout，效果也是一级棒。由于两者的 API 设计差不多，使用的情景也几乎一样，所以可以无痛地从 <a href="https://github.com/chrisbanes/Android-PullToRefreshhttps://github.com/chrisbanes/Android-PullToRefresh" target="_blank" rel="external">PullToRefresh</a> 转移过来。</p>
<h2 id="u654F_u611F_u7684_SwipeRefreshLayout"><a href="#u654F_u611F_u7684_SwipeRefreshLayout" class="headerlink" title="敏感的 SwipeRefreshLayout"></a>敏感的 SwipeRefreshLayout</h2><p>从 PullToRefresh 转移到 SwipeRefreshLayout 大概花了十来分钟，初步测试出来的效果也令人满意。但是，实际使用中总会有意想不到的问题。我们把一个WebView放在了 SwipeRefreshLayout 中， 该 WebView 呈现的网页中有一个图片轮播，可左右滑动，下面的问题是 SwipeRefreshLayout 过于敏感，它把稍有下拉倾向的左右滑动全部拦截掉，并把他们当作下拉的手势，典型的 False Positive ， 处理的思路也很简单，既然是误报，过滤之即可。</p>
<h3 id="u8BEF_u62A5_u7684_u624B_u52BF"><a href="#u8BEF_u62A5_u7684_u624B_u52BF" class="headerlink" title="误报的手势"></a><strong>误报的手势</strong></h3><p><img src="http://ww1.sinaimg.cn/bmiddle/7f793092gw1ev1xydoiwoj20u01hcwoe.jpg" alt=""><img src="http://ww3.sinaimg.cn/bmiddle/7f793092gw1ev1ys28bm4j20u01hc12q.jpg" alt=""></p>
<h3 id="u7406_u60F3_u4E2D_u7684_u624B_u52BF"><a href="#u7406_u60F3_u4E2D_u7684_u624B_u52BF" class="headerlink" title="理想中的手势"></a><strong>理想中的手势</strong></h3><p><img src="http://ww1.sinaimg.cn/bmiddle/7f793092gw1ev1ytgovwpj20u01hcgve.jpg" alt=""></p>
<a id="more"></a>
<h2 id="SwipeRefreshLayout__u5237_u65B0_u7684_u7EC6_u8282"><a href="#SwipeRefreshLayout__u5237_u65B0_u7684_u7EC6_u8282" class="headerlink" title="SwipeRefreshLayout 刷新的细节"></a>SwipeRefreshLayout 刷新的细节</h2><p>SwipeRefreshLayout 有个自定义接口 SwipeRefreshLayout.OnRefreshListener，里面的函数<code>onRefresh()</code>会在下拉刷新时执行。SwipeRefreshLayout 把 OnRefreshListener 包装进了<code>AnimationListener mRefreshListener</code>，并且<code>onRefresh()</code>方法只会在<code>onAnimationEnd()</code>中执行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Animation.AnimationListener mRefreshListener = <span class="keyword">new</span> Animation.AnimationListener() &#123;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animation animation)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animation animation)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animation animation)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mRefreshing) &#123;</span><br><span class="line">            <span class="comment">// Make sure the progress view is fully visible</span></span><br><span class="line">            mProgress.setAlpha(MAX_ALPHA);</span><br><span class="line">            mProgress.start();</span><br><span class="line">            <span class="keyword">if</span> (mNotify) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    mListener.onRefresh();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            mProgress.stop();</span><br><span class="line">            mCircleView.setVisibility(View.GONE);</span><br><span class="line">            setColorViewAlpha(MAX_ALPHA);</span><br><span class="line">            <span class="comment">// Return the circle to its start position</span></span><br><span class="line">            <span class="keyword">if</span> (mScale) &#123;</span><br><span class="line">                setAnimationProgress(<span class="number">0</span> <span class="comment">/* animation complete and view is hidden */</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                setTargetOffsetTopAndBottom(mOriginalOffsetTop - mCurrentTargetOffsetTop,</span><br><span class="line">                        <span class="keyword">true</span> <span class="comment">/* requires update */</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mCurrentTargetOffsetTop = mCircleView.getTop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 创建刷新指示图标    </span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createProgressView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mCircleView = <span class="keyword">new</span> CircleImageView(getContext(), CIRCLE_BG_LIGHT, CIRCLE_DIAMETER/<span class="number">2</span>);</span><br><span class="line">    mProgress = <span class="keyword">new</span> MaterialProgressDrawable(getContext(), <span class="keyword">this</span>);</span><br><span class="line">    mProgress.setBackgroundColor(CIRCLE_BG_LIGHT);</span><br><span class="line">    mCircleView.setImageDrawable(mProgress);</span><br><span class="line">    mCircleView.setVisibility(View.GONE);</span><br><span class="line">    addView(mCircleView);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个 listener 注册在<code>mCircleView</code>，负责了<strong>两个动画</strong>，一个是下拉回弹的动画，另一个是刷新转圈的动画。下拉回弹动画的完成，代表触发了刷新，接下来就执行<code>onRefresh()</code>。刷新转圈的动画完成时，代表了<code>onRefresh()</code>的完成，之后就让刷新图标消失。</p>
<p>下拉回弹的动画是由<code>animateOffsetToCorrectPosition()</code>开始的，也就是说刷新也是由这个方法触发的。经过简单分析后不难发现触发刷新的是<code>onTouchEvent()</code>方法。</p>
<h2 id="onInterceptTouchEvent_28_29_V-S-_onTouchEvent_28_29"><a href="#onInterceptTouchEvent_28_29_V-S-_onTouchEvent_28_29" class="headerlink" title="onInterceptTouchEvent() V.S. onTouchEvent()"></a>onInterceptTouchEvent() V.S. onTouchEvent()</h2><p>在安卓触屏事件分发处理过程中这两个是关键方法。在覆写这两个方法时需要遵守一定的规则，否则会有奇怪的事情发生，具体如下：</p>
<h3 id="ViewGroup-onInterceptTouchEvent_28_29"><a href="#ViewGroup-onInterceptTouchEvent_28_29" class="headerlink" title="ViewGroup.onInterceptTouchEvent()"></a>ViewGroup.onInterceptTouchEvent()</h3><blockquote>
<p>Implement this method to intercept all touch screen motion events. This allows you to watch events as they are dispatched to your children, and take ownership of the current gesture at any point.</p>
<p>Using this function takes some care, as it has a fairly complicated interaction with View.onTouchEvent(MotionEvent), and using it requires implementing that method as well as this one in the correct way. Events will be received in the following order:</p>
<ul>
<li>You will receive the down event here.</li>
<li>The down event will be handled either by a child of this view group, or given to your own onTouchEvent() method to handle; this means you should implement onTouchEvent() to return true, so you will continue to see the rest of the gesture (instead of looking for a parent view to handle it). Also, by returning true from onTouchEvent(), you will not receive any following events in onInterceptTouchEvent() and all touch processing must happen in onTouchEvent() like normal.</li>
<li>For as long as you return false from this function, each following event (up to and including the final up) will be delivered first here and then to the target’s onTouchEvent().</li>
<li>If you return true from here, you will not receive any following events: the target view will receive the same event but with the action ACTION_CANCEL, and all further events will be delivered to your onTouchEvent() method and no longer appear here.</li>
</ul>
</blockquote>
<h3 id="View-onTouchEvent_28_29"><a href="#View-onTouchEvent_28_29" class="headerlink" title="View.onTouchEvent()"></a>View.onTouchEvent()</h3><blockquote>
<p>Implement this method to handle touch screen motion events.</p>
<p>If this method is used to detect click actions, it is recommended that the actions be performed by implementing and calling performClick(). This will ensure consistent system behavior, including:</p>
<ul>
<li>obeying click sound preferences</li>
<li>dispatching OnClickListener calls</li>
<li>handling ACTION_CLICK when accessibility features are enabled</li>
</ul>
</blockquote>
<p>从文档上来看，当一个触屏事件发生时，安卓框架会先把事件发送到<code>ViewGroup.onInterceptTouchEvent()</code>，再根据其返回的结果来决定该事件该份配给自己的<code>ViewGroup.onTouchEvent()</code>，还是 target view 的<code>View.onTouchEvent()</code>。（注意 target view 指的是 layout.xml 中嵌套在SwipeRefreshLayout里的View，或是处于SwipeRefreshLayout之下的View。）那么SwipeRefreshLayout在处理触屏事件的流程也应如此。</p>
<h2 id="SwipeRefreshLayout__u5BF9_u89E6_u5C4F_u4E8B_u4EF6_u7684_u53CD_u5E94"><a href="#SwipeRefreshLayout__u5BF9_u89E6_u5C4F_u4E8B_u4EF6_u7684_u53CD_u5E94" class="headerlink" title="SwipeRefreshLayout 对触屏事件的反应"></a>SwipeRefreshLayout 对触屏事件的反应</h2><p>在修改SwipeRefreshLayout前，就算不清楚它的代码，那至少也要了解它对触屏事件的反馈。最直观的方法是创建一个子类，覆写那两个方法，算是曲线救国吧。具体的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SSwipeRefreshLayout</span> <span class="keyword">extends</span> <span class="title">SwipeRefreshLayout</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"SSwipe"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SSwipeRefreshLayout</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SSwipeRefreshLayout</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> b = <span class="keyword">super</span>.onTouchEvent(ev);</span><br><span class="line">        Log.d(TAG + <span class="string">"BT"</span>, String.valueOf(b));</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> b = <span class="keyword">super</span>.onInterceptTouchEvent(ev);</span><br><span class="line">        Log.d(TAG + <span class="string">"BI"</span>, String.valueOf(b));</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u89E6_u53D1_u5237_u65B0"><a href="#u89E6_u53D1_u5237_u65B0" class="headerlink" title="触发刷新"></a>触发刷新</h3><h4 id="u5411_u5DE6_u4E0B_u6ED1"><a href="#u5411_u5DE6_u4E0B_u6ED1" class="headerlink" title="向左下滑"></a><strong>向左下滑</strong></h4><p><img src="http://ww2.sinaimg.cn/bmiddle/7f793092gw1ev34kpb2ldj20u01hc7an.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">03</span>:<span class="number">52.650</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">03</span>:<span class="number">52.679</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.657</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.790</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.808</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true  &lt;--- onTouchEvent</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.811</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.831</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="u5411_u53F3_u4E0B_u6ED1"><a href="#u5411_u53F3_u4E0B_u6ED1" class="headerlink" title="向右下滑"></a><strong>向右下滑</strong></h4><p><img src="http://ww4.sinaimg.cn/bmiddle/7f793092gw1ev34lnjl05j20u01hcn3v.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.546</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.700</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.717</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.726</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.743</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.760</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.777</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.794</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.812</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.829</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true  &lt;--- onTouchEvent</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.845</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.868</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.893</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="u7B14_u76F4_u5411_u4E0B_u6ED1"><a href="#u7B14_u76F4_u5411_u4E0B_u6ED1" class="headerlink" title="笔直向下滑"></a><strong>笔直向下滑</strong></h4><p><img src="http://ww3.sinaimg.cn/bmiddle/7f793092gw1ev34m7lgjxj20u01hcdmi.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">13.798</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">14.115</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">14.132</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">14.150</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true  &lt;--- onTouchEvent</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">14.166</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">14.183</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="u4E0D_u89E6_u53D1_u5237_u65B0"><a href="#u4E0D_u89E6_u53D1_u5237_u65B0" class="headerlink" title="不触发刷新"></a>不触发刷新</h3><p>注意查看<strong>滚动条</strong>。</p>
<h4 id="u5411_u5DE6_u4E0B_u6ED1-1"><a href="#u5411_u5DE6_u4E0B_u6ED1-1" class="headerlink" title="向左下滑"></a><strong>向左下滑</strong></h4><p><img src="http://ww2.sinaimg.cn/bmiddle/7f793092gw1ev34y348moj20u01hc454.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.169</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.249</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.273</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.290</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.307</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.324</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.341</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.358</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.375</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.392</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line">...                                                                                           &lt;-- <span class="function"><span class="title">onTouchEvent</span><span class="params">()</span></span> Never Called!</span><br></pre></td></tr></table></figure>
<h4 id="u5411_u53F3_u4E0B_u6ED1-1"><a href="#u5411_u53F3_u4E0B_u6ED1-1" class="headerlink" title="向右下滑"></a><strong>向右下滑</strong></h4><p><img src="http://ww2.sinaimg.cn/bmiddle/7f793092gw1ev34xmt6cjj20u01hcn3w.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">01.868</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.028</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.050</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.067</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.084</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.102</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.119</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.136</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line">...                                                                                           &lt;-- <span class="function"><span class="title">onTouchEvent</span><span class="params">()</span></span> Never Called!</span><br></pre></td></tr></table></figure>
<h4 id="u7B14_u76F4_u5411_u4E0B_u6ED1-1"><a href="#u7B14_u76F4_u5411_u4E0B_u6ED1-1" class="headerlink" title="笔直向下滑"></a><strong>笔直向下滑</strong></h4><p><img src="http://ww4.sinaimg.cn/bmiddle/7f793092gw1ev34x7oe5fj20u01hcdm9.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.059</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.185</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.203</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.222</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.237</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.247</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.265</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line">...                                                                                           &lt;-- <span class="function"><span class="title">onTouchEvent</span><span class="params">()</span></span> Never Called!</span><br></pre></td></tr></table></figure>
<h3 id="SwipeRefreshLayout__u884C_u4E3A_u603B_u7ED3"><a href="#SwipeRefreshLayout__u884C_u4E3A_u603B_u7ED3" class="headerlink" title="SwipeRefreshLayout 行为总结"></a>SwipeRefreshLayout 行为总结</h3><p>从上面两类大情况，六种小情况来看，它的行为和文档写明的一致：</p>
<ul>
<li><p>触发刷新</p>
<ul>
<li><p>当触屏发生时，事件先到达<code>onInterceptTouchEvent()</code></p>
</li>
<li><p><code>onInterceptTouchEvent()</code>收到事件后，返回<code>false</code>，则此事件会向下传递到 <strong>target view</strong> ,同时使得下一次事件也是也<strong>先经过此方法</strong>。</p>
</li>
<li><p>经过几次事件后<code>onInterceptTouchEvent()</code>返回<code>true</code>，之后的事件都<strong>不再经过此方法</strong>，也不会传给 target view，<strong>直接传给</strong><code>SwipeRefreshLayout.onTouchEvent()</code>。</p>
</li>
<li><p><code>SwipeRefreshLayout.onTouchEvent()</code>接手事件， <strong>target view</strong> 不再收到任何事件，下拉刷新的指示图标开始出现。</p>
</li>
</ul>
</li>
<li><p>不触发刷新</p>
<ul>
<li><p>当触屏发生时，事件先到达<code>onInterceptTouchEvent()</code></p>
</li>
<li><p><code>onInterceptTouchEvent()</code>收到事件后，判读为此次手势没有刷新的意图，一直返回<code>false</code>。</p>
</li>
</ul>
</li>
</ul>
<p><code>onInterceptTouchEvent()</code>返回的结果就是我们要的循环不变量，分析到此差不多就结束了，根据它的行为，可以很轻松的降低它的敏感度。</p>
<h2 id="u964D_u4F4E_SwipeRefreshLayout__u7684_u654F_u611F_u5EA6"><a href="#u964D_u4F4E_SwipeRefreshLayout__u7684_u654F_u611F_u5EA6" class="headerlink" title="降低 SwipeRefreshLayout 的敏感度"></a>降低 SwipeRefreshLayout 的敏感度</h2><p><em>此小节部分内容有关 <code>MotionEvent</code>, 由于篇幅原因不再赘述。详见参考资料。</em></p>
<p>返回我们碰到问题中来，现在有个 WebView 嵌在 SwipeRefreshLayout 中，该 WebView 呈现的网页中有个图片轮播，但我们想切换图片时经常会被 SwipeRefreshLayout 打断，使切换图片的动作成为下来刷新的动作，造成使用体验上的缺陷。</p>
<p>既然 SwipeRefreshLayout 真正接手触屏事件是从 <code>onInterceptTouchEvent()</code> 返回 <code>true</code> 开始的。那我们只要触屏事件开始时判断用户是想刷新还是像切换图片。解决的思路清晰了，接下来是判断的策略</p>
<p>如何判断用户的意图？我们可以简单一点，取从 <code>ACTION_DOWN</code> 开始的两次 <code>ACTION_MOVE</code>,并计算两点所构成的直线同屏幕 <code>X</code> 轴所呈的角度：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">O                 X</span><br><span class="line">  +----------------+</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">        M1 +    </span>|</span><br><span class="line">  |<span class="string">         /      </span>|</span><br><span class="line">  |<span class="string">       /ang     </span>|</span><br><span class="line">  |<span class="string">  M2 + ----- X  </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">Y +----------------+</span><br></pre></td></tr></table></figure>
<p>当用户手势的头两次 <code>ACTION_MOVE</code> 构成角度小于 <code>ang</code> 时就让 <code>onInterceptTouchEvent()</code> 一直返回 <code>false</code> 直到 <code>ACTION_UP</code> 为止。这样保证了 SwipeRefreshLayout 不会轻易地截断触屏事件，让 <strong>target view</strong> 有机会处理该事件，同时也保证了循环不变式的成立，不会影响 SwipeRefreshLayout 的正常工作。</p>
<h2 id="SHOW_ME_THE_CODE"><a href="#SHOW_ME_THE_CODE" class="headerlink" title="SHOW ME THE CODE"></a>SHOW ME THE CODE</h2><script src="https://gist.github.com/Overvenus/dc0ec5c4de5c27585c91.js"></script>

<p>欢迎到我的<a href="https://gist.github.com/Overvenus/dc0ec5c4de5c27585c91#file-numbswiperefreshlayout-java" target="_blank" rel="external">Gist</a>查看代码。</p>
<h3 id="NumbSwipeRefreshLayout__u6548_u679C"><a href="#NumbSwipeRefreshLayout__u6548_u679C" class="headerlink" title="NumbSwipeRefreshLayout 效果"></a>NumbSwipeRefreshLayout 效果</h3><p>注意查看<strong>上方阴影</strong>。</p>
<p><img src="http://ww1.sinaimg.cn/bmiddle/7f793092gw1ev3c6eyty8j20u01hc0zi.jpg" alt=""><img src="http://ww4.sinaimg.cn/bmiddle/7f793092gw1ev3c6qlmwhj20u01hcwl4.jpg" alt=""></p>
<h2 id="u53C2_u8003_u8D44_u6599"><a href="#u53C2_u8003_u8D44_u6599" class="headerlink" title="参考资料"></a>参考资料</h2><blockquote>
<p><a href="https://android.googlesource.com/platform/frameworks/support/+/d9df810a8e9ac28148c853249f0951329053c784/v4/java/android/support/v4/widget/SwipeRefreshLayout.java" target="_blank" rel="external">SwipeRefreshLayout 源码</a><br><a href="https://developer.android.com/reference/android/support/v4/widget/SwipeRefreshLayout.html" target="_blank" rel="external">SwipeRefreshLayout 文档</a><br><a href="https://developer.android.com/training/gestures/viewgroup.html" target="_blank" rel="external">Managing Touch Events in a ViewGroup</a><br><a href="https://developer.android.com/reference/android/view/ViewGroup.html#onInterceptTouchEvent(android.view.MotionEvent" target="_blank" rel="external">ViewGroup.onInterceptTouchEvent(MotionEvent)</a><br><a href="https://developer.android.com/reference/android/view/View.html#onTouchEvent(android.view.MotionEvent" target="_blank" rel="external">View.onTouchEvent(MotionEvent)</a><br><a href="https://developer.android.com/reference/android/view/MotionEvent.html" target="_blank" rel="external">MotionEvent</a><br><a href="http://stackoverflow.com/a/12559204/3920448" target="_blank" rel="external">Calculate gesture distance in Android – Stack Overflow</a><br><a href="http://android-developers.blogspot.com/2010/06/making-sense-of-multitouch.html" target="_blank" rel="external">Making Sense of Multitouch</a><br><a href="https://en.wikipedia.org/wiki/False_positives_and_false_negatives" target="_blank" rel="external">False positives and false negatives</a></p>
</blockquote>
<p>个人笔记，难免有误，如有发现，还望指出。<br>END.</p>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag">#Android</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/07/04/goto_and_topological_sorting/" rel="next" title="GOTO与拓扑排序">
                <i class="fa fa-chevron-left"></i> GOTO与拓扑排序
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/08/29/my_frist_internship/" rel="prev" title="第一份实习">
                第一份实习 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/asset/image/avatar.jpg"
               alt="Neil Shen" />
          <p class="site-author-name" itemprop="name">Neil Shen</p>
          <p class="site-description motion-element" itemprop="description">It's now, or never.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">17</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">16</span>
              <span class="site-state-item-name">tags</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Overvenus" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/idstn" target="_blank">
                  
                    <i class="fa fa-weibo"></i> Weibo
                  
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#PullToRefresh__u4E0E_SwipeRefreshLayout"><span class="nav-number">1.</span> <span class="nav-text">PullToRefresh 与 SwipeRefreshLayout</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#u654F_u611F_u7684_SwipeRefreshLayout"><span class="nav-number">2.</span> <span class="nav-text">敏感的 SwipeRefreshLayout</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#u8BEF_u62A5_u7684_u624B_u52BF"><span class="nav-number">2.1.</span> <span class="nav-text">误报的手势</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#u7406_u60F3_u4E2D_u7684_u624B_u52BF"><span class="nav-number">2.2.</span> <span class="nav-text">理想中的手势</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SwipeRefreshLayout__u5237_u65B0_u7684_u7EC6_u8282"><span class="nav-number">3.</span> <span class="nav-text">SwipeRefreshLayout 刷新的细节</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#onInterceptTouchEvent_28_29_V-S-_onTouchEvent_28_29"><span class="nav-number">4.</span> <span class="nav-text">onInterceptTouchEvent() V.S. onTouchEvent()</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ViewGroup-onInterceptTouchEvent_28_29"><span class="nav-number">4.1.</span> <span class="nav-text">ViewGroup.onInterceptTouchEvent()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#View-onTouchEvent_28_29"><span class="nav-number">4.2.</span> <span class="nav-text">View.onTouchEvent()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SwipeRefreshLayout__u5BF9_u89E6_u5C4F_u4E8B_u4EF6_u7684_u53CD_u5E94"><span class="nav-number">5.</span> <span class="nav-text">SwipeRefreshLayout 对触屏事件的反应</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#u89E6_u53D1_u5237_u65B0"><span class="nav-number">5.1.</span> <span class="nav-text">触发刷新</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#u5411_u5DE6_u4E0B_u6ED1"><span class="nav-number">5.1.1.</span> <span class="nav-text">向左下滑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#u5411_u53F3_u4E0B_u6ED1"><span class="nav-number">5.1.2.</span> <span class="nav-text">向右下滑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#u7B14_u76F4_u5411_u4E0B_u6ED1"><span class="nav-number">5.1.3.</span> <span class="nav-text">笔直向下滑</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#u4E0D_u89E6_u53D1_u5237_u65B0"><span class="nav-number">5.2.</span> <span class="nav-text">不触发刷新</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#u5411_u5DE6_u4E0B_u6ED1-1"><span class="nav-number">5.2.1.</span> <span class="nav-text">向左下滑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#u5411_u53F3_u4E0B_u6ED1-1"><span class="nav-number">5.2.2.</span> <span class="nav-text">向右下滑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#u7B14_u76F4_u5411_u4E0B_u6ED1-1"><span class="nav-number">5.2.3.</span> <span class="nav-text">笔直向下滑</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SwipeRefreshLayout__u884C_u4E3A_u603B_u7ED3"><span class="nav-number">5.3.</span> <span class="nav-text">SwipeRefreshLayout 行为总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#u964D_u4F4E_SwipeRefreshLayout__u7684_u654F_u611F_u5EA6"><span class="nav-number">6.</span> <span class="nav-text">降低 SwipeRefreshLayout 的敏感度</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SHOW_ME_THE_CODE"><span class="nav-number">7.</span> <span class="nav-text">SHOW ME THE CODE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#NumbSwipeRefreshLayout__u6548_u679C"><span class="nav-number">7.1.</span> <span class="nav-text">NumbSwipeRefreshLayout 效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#u53C2_u8003_u8D44_u6599"><span class="nav-number">8.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Neil Shen</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  



  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'neilsh';
      var disqus_identifier = '2015/08/13/dispatch_and_handle_motionevent_in_android/';
      var disqus_title = 'Android触屏事件处理分发--以SwipeRefreshLayout为例';
      var disqus_url = 'http://neilsh.me/2015/08/13/dispatch_and_handle_motionevent_in_android/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        run_disqus_script('embed.js');
      
    </script>
  



  
  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>

  
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  
  


</body>
</html>
