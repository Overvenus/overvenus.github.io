<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Android触屏事件处理分发--以SwipeRefreshLayout为例 | 铅笔迹</title>
  <meta name="author" content="Neil Shen">
  
  <meta name="description" content="PullToRefresh 与 SwipeRefreshLayout这段时间我在 Easyinking 公司实习， 做安卓开发。之前的 App 中大量使用 Android-PullToRefresh。这个轮子很经典，在较久版本的安卓上面也很好使，不过作者已经放弃维护了，在我们的 App 上也发现了一个诡异的BUG：与WebView配合使用时，在网络环境差的情况下会出现一次下拉多次刷新的情况，症状就是整个网页在那上下抽搐。在官方支持库 support-v4:22 中自带了一个类似的 SwipeRefreshLayout，效果也是一级棒。由于两者的 API 设计差不多，使用的情景也几乎一样，所以可以无痛地从 PullToRefresh 转移过来。
敏感的 SwipeRefreshLayout从 PullToRefresh 转移到 SwipeRefreshLayout 大概花了十来分钟，初步测试出来的效果也令人满意。但是，实际使用中总会有意想不到的问题。我们把一个WebView放在了 SwipeRefreshLayout 中， 该 WebView 呈现的网页中有一个图片轮播，可左右滑动，下面的问题是 SwipeRefreshLayout 过于敏感，它把稍有下拉倾向的左右滑动全部拦截掉，并把他们当作下拉的手势，典型的 False Positive ， 处理的思路也很简单，既然是误报，过滤之即可。
误报的手势
理想中的手势">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Android触屏事件处理分发--以SwipeRefreshLayout为例"/>
  <meta property="og:site_name" content="铅笔迹"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="铅笔迹" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//cdnjsnet.b0.upaiyun.com/html5shiv/3.7.2/html5shiv.min.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">铅笔迹</a></h1>
  <h2><a href="/">Share Somthing Cool.</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/me">Me</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-08-13T06:33:00.000Z"><a href="/2015/08/13/dispatch_and_handle_motionevent_in_android/">2015-08-13</a></time>
      
      
  
    <h1 class="title">Android触屏事件处理分发--以SwipeRefreshLayout为例</h1>
  

    </header>
    <div class="entry">
      
        <!-- Table of Contents -->
        
          <div id="toc" class="toc-article">
          <h1>TOC</h1>
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#PullToRefresh_与_SwipeRefreshLayout"><span class="toc-number">1.</span> <span class="toc-text">PullToRefresh 与 SwipeRefreshLayout</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#敏感的_SwipeRefreshLayout"><span class="toc-number">2.</span> <span class="toc-text">敏感的 SwipeRefreshLayout</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#误报的手势"><span class="toc-number">2.1.</span> <span class="toc-text">误报的手势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#理想中的手势"><span class="toc-number">2.2.</span> <span class="toc-text">理想中的手势</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SwipeRefreshLayout_刷新的细节"><span class="toc-number">3.</span> <span class="toc-text">SwipeRefreshLayout 刷新的细节</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#onInterceptTouchEvent()_V-S-_onTouchEvent()"><span class="toc-number">4.</span> <span class="toc-text">onInterceptTouchEvent() V.S. onTouchEvent()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ViewGroup-onInterceptTouchEvent()"><span class="toc-number">4.1.</span> <span class="toc-text">ViewGroup.onInterceptTouchEvent()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#View-onTouchEvent()"><span class="toc-number">4.2.</span> <span class="toc-text">View.onTouchEvent()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SwipeRefreshLayout_对触屏事件的反应"><span class="toc-number">5.</span> <span class="toc-text">SwipeRefreshLayout 对触屏事件的反应</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#触发刷新"><span class="toc-number">5.1.</span> <span class="toc-text">触发刷新</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#向左下滑"><span class="toc-number">5.1.1.</span> <span class="toc-text">向左下滑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#向右下滑"><span class="toc-number">5.1.2.</span> <span class="toc-text">向右下滑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#笔直向下滑"><span class="toc-number">5.1.3.</span> <span class="toc-text">笔直向下滑</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#不触发刷新"><span class="toc-number">5.2.</span> <span class="toc-text">不触发刷新</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#向左下滑-1"><span class="toc-number">5.2.1.</span> <span class="toc-text">向左下滑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#向右下滑-1"><span class="toc-number">5.2.2.</span> <span class="toc-text">向右下滑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#笔直向下滑-1"><span class="toc-number">5.2.3.</span> <span class="toc-text">笔直向下滑</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SwipeRefreshLayout_行为总结"><span class="toc-number">5.3.</span> <span class="toc-text">SwipeRefreshLayout 行为总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#降低_SwipeRefreshLayout_的敏感度"><span class="toc-number">6.</span> <span class="toc-text">降低 SwipeRefreshLayout 的敏感度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SHOW_ME_THE_CODE"><span class="toc-number">7.</span> <span class="toc-text">SHOW ME THE CODE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NumbSwipeRefreshLayout_效果"><span class="toc-number">7.1.</span> <span class="toc-text">NumbSwipeRefreshLayout 效果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-number">8.</span> <span class="toc-text">参考资料</span></a></li></ol>
          </div>
        
        <h2 id="PullToRefresh_与_SwipeRefreshLayout">PullToRefresh 与 SwipeRefreshLayout</h2><p>这段时间我在 Easyinking 公司实习， 做安卓开发。之前的 App 中大量使用 <a href="https://github.com/chrisbanes/Android-PullToRefreshhttps://github.com/chrisbanes/Android-PullToRefresh" target="_blank" rel="external">Android-PullToRefresh</a>。这个轮子很经典，在较久版本的安卓上面也很好使，不过作者已经放弃维护了，在我们的 App 上也发现了一个诡异的BUG：与WebView配合使用时，在网络环境差的情况下会出现一次下拉多次刷新的情况，症状就是整个网页在那上下抽搐。在官方支持库 support-v4:22 中自带了一个类似的 SwipeRefreshLayout，效果也是一级棒。由于两者的 API 设计差不多，使用的情景也几乎一样，所以可以无痛地从 <a href="https://github.com/chrisbanes/Android-PullToRefreshhttps://github.com/chrisbanes/Android-PullToRefresh" target="_blank" rel="external">PullToRefresh</a> 转移过来。</p>
<h2 id="敏感的_SwipeRefreshLayout">敏感的 SwipeRefreshLayout</h2><p>从 PullToRefresh 转移到 SwipeRefreshLayout 大概花了十来分钟，初步测试出来的效果也令人满意。但是，实际使用中总会有意想不到的问题。我们把一个WebView放在了 SwipeRefreshLayout 中， 该 WebView 呈现的网页中有一个图片轮播，可左右滑动，下面的问题是 SwipeRefreshLayout 过于敏感，它把稍有下拉倾向的左右滑动全部拦截掉，并把他们当作下拉的手势，典型的 False Positive ， 处理的思路也很简单，既然是误报，过滤之即可。</p>
<h3 id="误报的手势"><strong>误报的手势</strong></h3><p><img src="http://ww1.sinaimg.cn/bmiddle/7f793092gw1ev1xydoiwoj20u01hcwoe.jpg" alt=""><img src="http://ww3.sinaimg.cn/bmiddle/7f793092gw1ev1ys28bm4j20u01hc12q.jpg" alt=""></p>
<h3 id="理想中的手势"><strong>理想中的手势</strong></h3><p><img src="http://ww1.sinaimg.cn/bmiddle/7f793092gw1ev1ytgovwpj20u01hcgve.jpg" alt=""></p>
<a id="more"></a>
<h2 id="SwipeRefreshLayout_刷新的细节">SwipeRefreshLayout 刷新的细节</h2><p>SwipeRefreshLayout 有个自定义接口 SwipeRefreshLayout.OnRefreshListener，里面的函数<code>onRefresh()</code>会在下拉刷新时执行。SwipeRefreshLayout 把 OnRefreshListener 包装进了<code>AnimationListener mRefreshListener</code>，并且<code>onRefresh()</code>方法只会在<code>onAnimationEnd()</code>中执行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Animation.AnimationListener mRefreshListener = <span class="keyword">new</span> Animation.AnimationListener() &#123;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animation animation)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animation animation)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animation animation)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mRefreshing) &#123;</span><br><span class="line">            <span class="comment">// Make sure the progress view is fully visible</span></span><br><span class="line">            mProgress.setAlpha(MAX_ALPHA);</span><br><span class="line">            mProgress.start();</span><br><span class="line">            <span class="keyword">if</span> (mNotify) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    mListener.onRefresh();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            mProgress.stop();</span><br><span class="line">            mCircleView.setVisibility(View.GONE);</span><br><span class="line">            setColorViewAlpha(MAX_ALPHA);</span><br><span class="line">            <span class="comment">// Return the circle to its start position</span></span><br><span class="line">            <span class="keyword">if</span> (mScale) &#123;</span><br><span class="line">                setAnimationProgress(<span class="number">0</span> <span class="comment">/* animation complete and view is hidden */</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                setTargetOffsetTopAndBottom(mOriginalOffsetTop - mCurrentTargetOffsetTop,</span><br><span class="line">                        <span class="keyword">true</span> <span class="comment">/* requires update */</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mCurrentTargetOffsetTop = mCircleView.getTop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 创建刷新指示图标    </span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createProgressView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mCircleView = <span class="keyword">new</span> CircleImageView(getContext(), CIRCLE_BG_LIGHT, CIRCLE_DIAMETER/<span class="number">2</span>);</span><br><span class="line">    mProgress = <span class="keyword">new</span> MaterialProgressDrawable(getContext(), <span class="keyword">this</span>);</span><br><span class="line">    mProgress.setBackgroundColor(CIRCLE_BG_LIGHT);</span><br><span class="line">    mCircleView.setImageDrawable(mProgress);</span><br><span class="line">    mCircleView.setVisibility(View.GONE);</span><br><span class="line">    addView(mCircleView);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个 listener 注册在<code>mCircleView</code>，负责了<strong>两个动画</strong>，一个是下拉回弹的动画，另一个是刷新转圈的动画。下拉回弹动画的完成，代表触发了刷新，接下来就执行<code>onRefresh()</code>。刷新转圈的动画完成时，代表了<code>onRefresh()</code>的完成，之后就让刷新图标消失。</p>
<p>下拉回弹的动画是由<code>animateOffsetToCorrectPosition()</code>开始的，也就是说刷新也是由这个方法触发的。经过简单分析后不难发现触发刷新的是<code>onTouchEvent()</code>方法。</p>
<h2 id="onInterceptTouchEvent()_V-S-_onTouchEvent()">onInterceptTouchEvent() V.S. onTouchEvent()</h2><p>在安卓触屏事件分发处理过程中这两个是关键方法。在覆写这两个方法时需要遵守一定的规则，否则会有奇怪的事情发生，具体如下：</p>
<h3 id="ViewGroup-onInterceptTouchEvent()">ViewGroup.onInterceptTouchEvent()</h3><blockquote>
<p>Implement this method to intercept all touch screen motion events. This allows you to watch events as they are dispatched to your children, and take ownership of the current gesture at any point.</p>
<p>Using this function takes some care, as it has a fairly complicated interaction with View.onTouchEvent(MotionEvent), and using it requires implementing that method as well as this one in the correct way. Events will be received in the following order:</p>
<ul>
<li>You will receive the down event here.</li>
<li>The down event will be handled either by a child of this view group, or given to your own onTouchEvent() method to handle; this means you should implement onTouchEvent() to return true, so you will continue to see the rest of the gesture (instead of looking for a parent view to handle it). Also, by returning true from onTouchEvent(), you will not receive any following events in onInterceptTouchEvent() and all touch processing must happen in onTouchEvent() like normal.</li>
<li>For as long as you return false from this function, each following event (up to and including the final up) will be delivered first here and then to the target’s onTouchEvent().</li>
<li>If you return true from here, you will not receive any following events: the target view will receive the same event but with the action ACTION_CANCEL, and all further events will be delivered to your onTouchEvent() method and no longer appear here.</li>
</ul>
</blockquote>
<h3 id="View-onTouchEvent()">View.onTouchEvent()</h3><blockquote>
<p>Implement this method to handle touch screen motion events.</p>
<p>If this method is used to detect click actions, it is recommended that the actions be performed by implementing and calling performClick(). This will ensure consistent system behavior, including:</p>
<ul>
<li>obeying click sound preferences</li>
<li>dispatching OnClickListener calls</li>
<li>handling ACTION_CLICK when accessibility features are enabled</li>
</ul>
</blockquote>
<p>从文档上来看，当一个触屏事件发生时，安卓框架会先把事件发送到<code>ViewGroup.onInterceptTouchEvent()</code>，再根据其返回的结果来决定该事件该份配给自己的<code>ViewGroup.onTouchEvent()</code>，还是 target view 的<code>View.onTouchEvent()</code>。（注意 target view 指的是 layout.xml 中嵌套在SwipeRefreshLayout里的View，或是处于SwipeRefreshLayout之下的View。）那么SwipeRefreshLayout在处理触屏事件的流程也应如此。</p>
<h2 id="SwipeRefreshLayout_对触屏事件的反应">SwipeRefreshLayout 对触屏事件的反应</h2><p>在修改SwipeRefreshLayout前，就算不清楚它的代码，那至少也要了解它对触屏事件的反馈。最直观的方法是创建一个子类，覆写那两个方法，算是曲线救国吧。具体的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SSwipeRefreshLayout</span> <span class="keyword">extends</span> <span class="title">SwipeRefreshLayout</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"SSwipe"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SSwipeRefreshLayout</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SSwipeRefreshLayout</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> b = <span class="keyword">super</span>.onTouchEvent(ev);</span><br><span class="line">        Log.d(TAG + <span class="string">"BT"</span>, String.valueOf(b));</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> b = <span class="keyword">super</span>.onInterceptTouchEvent(ev);</span><br><span class="line">        Log.d(TAG + <span class="string">"BI"</span>, String.valueOf(b));</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="触发刷新">触发刷新</h3><h4 id="向左下滑"><strong>向左下滑</strong></h4><p><img src="http://ww2.sinaimg.cn/bmiddle/7f793092gw1ev34kpb2ldj20u01hc7an.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">03</span>:<span class="number">52.650</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">03</span>:<span class="number">52.679</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.657</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.790</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.808</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true  &lt;--- onTouchEvent</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.811</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.831</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="向右下滑"><strong>向右下滑</strong></h4><p><img src="http://ww4.sinaimg.cn/bmiddle/7f793092gw1ev34lnjl05j20u01hcn3v.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.546</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.700</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.717</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.726</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.743</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.760</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.777</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.794</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.812</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.829</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true  &lt;--- onTouchEvent</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.845</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.868</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.893</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="笔直向下滑"><strong>笔直向下滑</strong></h4><p><img src="http://ww3.sinaimg.cn/bmiddle/7f793092gw1ev34m7lgjxj20u01hcdmi.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">13.798</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">14.115</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">14.132</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">14.150</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true  &lt;--- onTouchEvent</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">14.166</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">14.183</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBT﹕ true</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="不触发刷新">不触发刷新</h3><p>注意查看<strong>滚动条</strong>。</p>
<h4 id="向左下滑-1"><strong>向左下滑</strong></h4><p><img src="http://ww2.sinaimg.cn/bmiddle/7f793092gw1ev34y348moj20u01hc454.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.169</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.249</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.273</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.290</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.307</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.324</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.341</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.358</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.375</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.392</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line">...                                                                                           &lt;-- <span class="function"><span class="title">onTouchEvent</span><span class="params">()</span></span> Never Called!</span><br></pre></td></tr></table></figure>
<h4 id="向右下滑-1"><strong>向右下滑</strong></h4><p><img src="http://ww2.sinaimg.cn/bmiddle/7f793092gw1ev34xmt6cjj20u01hcn3w.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">01.868</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.028</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.050</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.067</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.084</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.102</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.119</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.136</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line">...                                                                                           &lt;-- <span class="function"><span class="title">onTouchEvent</span><span class="params">()</span></span> Never Called!</span><br></pre></td></tr></table></figure>
<h4 id="笔直向下滑-1"><strong>笔直向下滑</strong></h4><p><img src="http://ww4.sinaimg.cn/bmiddle/7f793092gw1ev34x7oe5fj20u01hcdm9.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.059</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.185</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.203</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.222</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.237</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.247</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.265</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBI﹕ false</span><br><span class="line">...                                                                                           &lt;-- <span class="function"><span class="title">onTouchEvent</span><span class="params">()</span></span> Never Called!</span><br></pre></td></tr></table></figure>
<h3 id="SwipeRefreshLayout_行为总结">SwipeRefreshLayout 行为总结</h3><p>从上面两类大情况，六种小情况来看，它的行为和文档写明的一致：</p>
<ul>
<li><p>触发刷新</p>
<ul>
<li><p>当触屏发生时，事件先到达<code>onInterceptTouchEvent()</code></p>
</li>
<li><p><code>onInterceptTouchEvent()</code>收到事件后，返回<code>false</code>，则此事件会向下传递到 <strong>target view</strong> ,同时使得下一次事件也是也<strong>先经过此方法</strong>。</p>
</li>
<li><p>经过几次事件后<code>onInterceptTouchEvent()</code>返回<code>true</code>，之后的事件都<strong>不再经过此方法</strong>，也不会传给 target view，<strong>直接传给</strong><code>SwipeRefreshLayout.onTouchEvent()</code>。</p>
</li>
<li><p><code>SwipeRefreshLayout.onTouchEvent()</code>接手事件， <strong>target view</strong> 不再收到任何事件，下拉刷新的指示图标开始出现。</p>
</li>
</ul>
</li>
<li><p>不触发刷新</p>
<ul>
<li><p>当触屏发生时，事件先到达<code>onInterceptTouchEvent()</code></p>
</li>
<li><p><code>onInterceptTouchEvent()</code>收到事件后，判读为此次手势没有刷新的意图，一直返回<code>false</code>。</p>
</li>
</ul>
</li>
</ul>
<p><code>onInterceptTouchEvent()</code>返回的结果就是我们要的循环不变量，分析到此差不多就结束了，根据它的行为，可以很轻松的降低它的敏感度。</p>
<h2 id="降低_SwipeRefreshLayout_的敏感度">降低 SwipeRefreshLayout 的敏感度</h2><p><em>此小节部分内容有关 <code>MotionEvent</code>, 由于篇幅原因不再赘述。详见参考资料。</em></p>
<p>返回我们碰到问题中来，现在有个 WebView 嵌在 SwipeRefreshLayout 中，该 WebView 呈现的网页中有个图片轮播，但我们想切换图片时经常会被 SwipeRefreshLayout 打断，使切换图片的动作成为下来刷新的动作，造成使用体验上的缺陷。</p>
<p>既然 SwipeRefreshLayout 真正接手触屏事件是从 <code>onInterceptTouchEvent()</code> 返回 <code>true</code> 开始的。那我们只要触屏事件开始时判断用户是想刷新还是像切换图片。解决的思路清晰了，接下来是判断的策略</p>
<p>如何判断用户的意图？我们可以简单一点，取从 <code>ACTION_DOWN</code> 开始的两次 <code>ACTION_MOVE</code>,并计算两点所构成的直线同屏幕 <code>X</code> 轴所呈的角度：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">O                 X</span><br><span class="line">  +----------------+</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">        M1 +    </span>|</span><br><span class="line">  |<span class="string">         /      </span>|</span><br><span class="line">  |<span class="string">       /ang     </span>|</span><br><span class="line">  |<span class="string">  M2 + ----- X  </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">Y +----------------+</span><br></pre></td></tr></table></figure>
<p>当用户手势的头两次 <code>ACTION_MOVE</code> 构成角度小于 <code>ang</code> 时就让 <code>onInterceptTouchEvent()</code> 一直返回 <code>false</code> 直到 <code>ACTION_UP</code> 为止。这样保证了 SwipeRefreshLayout 不会轻易地截断触屏事件，让 <strong>target view</strong> 有机会处理该事件，同时也保证了循环不变式的成立，不会影响 SwipeRefreshLayout 的正常工作。</p>
<h2 id="SHOW_ME_THE_CODE">SHOW ME THE CODE</h2><script src="https://gist.github.com/Overvenus/dc0ec5c4de5c27585c91.js"></script>

<p>欢迎到我的<a href="https://gist.github.com/Overvenus/dc0ec5c4de5c27585c91#file-numbswiperefreshlayout-java" target="_blank" rel="external">Gist</a>查看代码。</p>
<h3 id="NumbSwipeRefreshLayout_效果">NumbSwipeRefreshLayout 效果</h3><p>注意查看<strong>上方阴影</strong>。</p>
<p><img src="http://ww1.sinaimg.cn/bmiddle/7f793092gw1ev3c6eyty8j20u01hc0zi.jpg" alt=""><img src="http://ww4.sinaimg.cn/bmiddle/7f793092gw1ev3c6qlmwhj20u01hcwl4.jpg" alt=""></p>
<h2 id="参考资料">参考资料</h2><blockquote>
<p><a href="https://android.googlesource.com/platform/frameworks/support/+/d9df810a8e9ac28148c853249f0951329053c784/v4/java/android/support/v4/widget/SwipeRefreshLayout.java" target="_blank" rel="external">SwipeRefreshLayout 源码</a><br><a href="https://developer.android.com/reference/android/support/v4/widget/SwipeRefreshLayout.html" target="_blank" rel="external">SwipeRefreshLayout 文档</a><br><a href="https://developer.android.com/training/gestures/viewgroup.html" target="_blank" rel="external">Managing Touch Events in a ViewGroup</a><br><a href="https://developer.android.com/reference/android/view/ViewGroup.html#onInterceptTouchEvent(android.view.MotionEvent" target="_blank" rel="external">ViewGroup.onInterceptTouchEvent(MotionEvent)</a><br><a href="https://developer.android.com/reference/android/view/View.html#onTouchEvent(android.view.MotionEvent" target="_blank" rel="external">View.onTouchEvent(MotionEvent)</a><br><a href="https://developer.android.com/reference/android/view/MotionEvent.html" target="_blank" rel="external">MotionEvent</a><br><a href="http://stackoverflow.com/a/12559204/3920448" target="_blank" rel="external">Calculate gesture distance in Android — Stack Overflow</a><br><a href="http://android-developers.blogspot.com/2010/06/making-sense-of-multitouch.html" target="_blank" rel="external">Making Sense of Multitouch</a><br><a href="https://en.wikipedia.org/wiki/False_positives_and_false_negatives" target="_blank" rel="external">False positives and false negatives</a></p>
</blockquote>
<p>个人笔记，难免有误，如有发现，还望指出。<br>END.</p>

      
    </div>
    <footer>
      
        
        
  
  <div class="tags">
    <a href="/tags/Android/">Android</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>

  
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:overvenus.gitcafe.io">
  </form>
</div>

  

  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/Algorithms/" style="font-size: 10px;">Algorithms</a> <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/C/" style="font-size: 20px;">C</a> <a href="/tags/C-S-笔记/" style="font-size: 20px;">C.S.笔记</a> <a href="/tags/Career/" style="font-size: 10px;">Career</a> <a href="/tags/MIT/" style="font-size: 20px;">MIT</a> <a href="/tags/Reading/" style="font-size: 10px;">Reading</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/python/" style="font-size: 10px;">python</a>
  </div>
</div>


  <iframe width="100%" height="110" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=110&fansRow=2&ptype=1&speed=0&skin=5&isTitle=0&noborder=1&isWeibo=0&isFans=0&uid=2138648722&verifier=045e79b4&dpc=1"></iframe>

  <div class="widget widget-toc" style="display: none">
  <h3 class="title">文章目录</h3>
  <div class="container" style="padding: 15px 20px;">
  </div>
</div>
<script src="/js/toc.js" type="text/javascript"></script>

  <div class="scrollup"></div>

<script src="/js/scrollup.js" type="text/javascript"></script>
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 Neil Shen
  
</div>
<div class="clearfix"></div></footer>
  <script src="//upcdn.b0.upaiyun.com/libs/jquery/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'overvenus';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>