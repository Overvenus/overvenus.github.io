<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[Neil]]></title>
  <subtitle><![CDATA[Share something cool.]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://neilsh.me/"/>
  <updated>2015-11-13T02:51:04.000Z</updated>
  <id>http://neilsh.me/</id>
  
  <author>
    <name><![CDATA[Neil Shen]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[make slice map channel]]></title>
    <link href="http://neilsh.me/2015/11/09/make_slice_map_channel/"/>
    <id>http://neilsh.me/2015/11/09/make_slice_map_channel/</id>
    <published>2015-11-09T07:16:55.000Z</published>
    <updated>2015-11-13T02:51:04.000Z</updated>
    <content type="html"><![CDATA[<h2 id="Where_is_the_make_implemention?">Where is the make implemention?</h2><p>package <strong>runtime</strong><br>By the way, <em>new</em>, <em>map</em>, <em>slice</em>, <em>channel</em>, <em>goroutine</em> and <em>garbage collector</em>[<a href="https://docs.google.com/document/d/1P3BLR31VA8cvLJLfMibSuTdwTuF7WWLux71CYD0eeD8" target="_blank" rel="external">1</a>] are also implemented in this package.</p>
<h2 id="Slices">Slices</h2><p>Source file: go/src/runtime/slice.go</p>
<h3 id="Data_structure">Data structure</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> slice <span class="keyword">struct</span> &#123;</span><br><span class="line">    array unsafe.Pointer</span><br><span class="line">    <span class="built_in">len</span>   <span class="typename">int</span></span><br><span class="line">    <span class="built_in">cap</span>   <span class="typename">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Underlying data structure of <strong>slice</strong> is trival. Go is statically typed, and why this litte struct can be the template of any type of slices? Well, look at the comments of <code>unsafe.Pointer</code></p>
<blockquote>
<p>// Pointer represents a pointer to an arbitrary type.  There are four special operations<br>// available for type Pointer that are not available for other types.<br>//  1) A pointer value of any type can be converted to a Pointer.<br>//  2) A Pointer can be converted to a pointer value of any type.  &lt;â€” here!<br>//  3) A uintptr can be converted to a Pointer.<br>//  4) A Pointer can be converted to a uintptr.<br>// Pointer therefore allows a program to defeat the type system and read and write<br>// arbitrary memory. It should be used with extreme care.</p>
</blockquote>
<p>In my opinion, <strong>Pointer</strong> in Go and <strong>*void</strong> in C are very like. <em>Pointer</em> anesthetizes the type system and read and write arbitrary memory in Go. <em>*void</em> can be converted to any type without warning in C.</p>
<h3 id="Make_slices">Make slices</h3><p>Make slices is trival.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span>: take uintptrs instead of int64s?</span></span><br><span class="line"><span class="keyword">func</span> makeslice(t *slicetype, len64, cap64 <span class="typename">int64</span>) slice &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag"><span class="keyword">NOTE</span></span>: The len &gt; MaxMem/elemsize check here is not strictly necessary,</span></span><br><span class="line">    <span class="comment">// but it produces a 'len out of range' error instead of a 'cap out of range' error</span></span><br><span class="line">    <span class="comment">// when someone does make([]T, bignumber). 'cap out of range' is true too,</span></span><br><span class="line">    <span class="comment">// but since the cap is only being supplied implicitly, saying len is clearer.</span></span><br><span class="line">    <span class="comment">// See issue 4085.</span></span><br><span class="line">    <span class="built_in">len</span> := <span class="typename">int</span>(len64)</span><br><span class="line">    <span class="keyword">if</span> len64 &lt; <span class="number">0</span> || <span class="typename">int64</span>(<span class="built_in">len</span>) != len64 || t.elem.size &gt; <span class="number">0</span> &amp;&amp; <span class="typename">uintptr</span>(<span class="built_in">len</span>) &gt; _MaxMem/<span class="typename">uintptr</span>(t.elem.size) &#123;</span><br><span class="line">        <span class="built_in">panic</span>(errorString(<span class="string">"makeslice: len out of range"</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cap</span> := <span class="typename">int</span>(cap64)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">cap</span> &lt; <span class="built_in">len</span> || <span class="typename">int64</span>(<span class="built_in">cap</span>) != cap64 || t.elem.size &gt; <span class="number">0</span> &amp;&amp; <span class="typename">uintptr</span>(<span class="built_in">cap</span>) &gt; _MaxMem/<span class="typename">uintptr</span>(t.elem.size) &#123;</span><br><span class="line">        <span class="built_in">panic</span>(errorString(<span class="string">"makeslice: cap out of range"</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    p := newarray(t.elem, <span class="typename">uintptr</span>(<span class="built_in">cap</span>))</span><br><span class="line">    <span class="keyword">return</span> slice&#123;p, <span class="built_in">len</span>, <span class="built_in">cap</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>So, a slice is always 24 bytes(amd64, ubuntu 14.04 LTS), no matter how many elements it has or how much capacity it is. The actual data that a slice represents locate in other place, not in the slice itself. More details about slice can be found in [<a href="https://gist.github.com/Overvenus/f6cf225ec33cc98d6b8c" target="_blank" rel="external">3</a>] and [<a href="https://blog.golang.org/go-slices-usage-and-internals" target="_blank" rel="external">4</a>].</p>
<p><strong>newarray</strong> eventually calls <strong>mallocgc</strong>, which will allocate memory in heap(for big array) or per-thread cache (for small array) [<a href="http://goog-perftools.sourceforge.net/doc/tcmalloc.html" target="_blank" rel="external">2</a>].</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// implementation of make builtin for slices</span></span><br><span class="line"><span class="keyword">func</span> newarray(typ *_type, n <span class="typename">uintptr</span>) unsafe.Pointer &#123;</span><br><span class="line">    flags := <span class="typename">uint32</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> typ.kind&amp;kindNoPointers != <span class="number">0</span> &#123;</span><br><span class="line">        flags |= flagNoScan</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="typename">int</span>(n) &lt; <span class="number">0</span> || (typ.size &gt; <span class="number">0</span> &amp;&amp; n &gt; _MaxMem/<span class="typename">uintptr</span>(typ.size)) &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"runtime: allocation size out of range"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mallocgc(<span class="typename">uintptr</span>(typ.size)*n, typ, flags)</span><br><span class="line">    <span class="comment">/*                               ^^  multiply size by n  */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Maps">Maps</h2><p>Source file: go/src/runtime/hashmap.go</p>
<blockquote>
<p>// A map is just a hash table.  The data is arranged<br>// into an array of buckets.  Each bucket contains up to<br>// 8 key/value pairs.  The low-order bits of the hash are<br>// used to select a bucket.  Each bucket contains a few<br>// high-order bits of each hash to distinguish the entries<br>// within a single bucket.<br>//<br>// If more than 8 keys hash to a bucket, we chain on<br>// extra buckets.</p>
</blockquote>
<h3 id="Data_structure-1">Data structure</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A header for a Go map.</span></span><br><span class="line"><span class="keyword">type</span> hmap <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// Note: the format of the Hmap is encoded in ../../cmd/internal/gc/reflect.go and</span></span><br><span class="line">    <span class="comment">// ../reflect/type.go.  Don't change this structure without also changing that code!</span></span><br><span class="line">    count <span class="typename">int</span> <span class="comment">// # live cells == size of map.  Must be first (used by len() builtin)</span></span><br><span class="line">    flags <span class="typename">uint8</span></span><br><span class="line">    B     <span class="typename">uint8</span>  <span class="comment">// log_2 of # of buckets (can hold up to loadFactor * 2^B items)</span></span><br><span class="line">    hash0 <span class="typename">uint32</span> <span class="comment">// hash seed</span></span><br><span class="line"></span><br><span class="line">    buckets    unsafe.Pointer <span class="comment">// array of 2^B Buckets. may be nil if count==0.</span></span><br><span class="line">    oldbuckets unsafe.Pointer <span class="comment">// previous bucket array of half the size, non-nil only when growing</span></span><br><span class="line">    nevacuate  <span class="typename">uintptr</span>        <span class="comment">// progress counter for evacuation (buckets less than this have been evacuated)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// If both key and value do not contain pointers and are inline, then we mark bucket</span></span><br><span class="line">    <span class="comment">// type as containing no pointers. This avoids scanning such maps.</span></span><br><span class="line">    <span class="comment">// However, bmap.overflow is a pointer. In order to keep overflow buckets</span></span><br><span class="line">    <span class="comment">// alive, we store pointers to all overflow buckets in hmap.overflow.</span></span><br><span class="line">    <span class="comment">// Overflow is used only if key and value do not contain pointers.</span></span><br><span class="line">    <span class="comment">// overflow[0] contains overflow buckets for hmap.buckets.</span></span><br><span class="line">    <span class="comment">// overflow[1] contains overflow buckets for hmap.oldbuckets.</span></span><br><span class="line">    <span class="comment">// The first indirection allows us to reduce static size of hmap.</span></span><br><span class="line">    <span class="comment">// The second indirection allows to store a pointer to the slice in hiter.</span></span><br><span class="line">    overflow *[<span class="number">2</span>]*[]*bmap</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A bucket for a Go map.</span></span><br><span class="line"><span class="keyword">type</span> bmap <span class="keyword">struct</span> &#123;</span><br><span class="line">    tophash [bucketCnt]<span class="typename">uint8</span></span><br><span class="line">    <span class="comment">// Followed by bucketCnt keys and then bucketCnt values.</span></span><br><span class="line">    <span class="comment">// <span class="doctag"><span class="keyword">NOTE</span></span>: packing all the keys together and then all the values together makes the</span></span><br><span class="line">    <span class="comment">// code a bit more complicated than alternating key/value/key/value/... but it allows</span></span><br><span class="line">    <span class="comment">// us to eliminate padding which would be needed for, e.g., map[int64]int8.</span></span><br><span class="line">    <span class="comment">// Followed by an overflow pointer.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Make_maps">Make maps</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// makemap implements a Go map creation make(map[k]v, hint)</span></span><br><span class="line"><span class="comment">// If the compiler has determined that the map or the first bucket</span></span><br><span class="line"><span class="comment">// can be created on the stack, h and/or bucket may be non-nil.</span></span><br><span class="line"><span class="comment">// If h != nil, the map can be created directly in h.</span></span><br><span class="line"><span class="comment">// If bucket != nil, bucket can be used as the first bucket.</span></span><br><span class="line"><span class="keyword">func</span> makemap(t *maptype, hint <span class="typename">int64</span>, h *hmap, bucket unsafe.Pointer) *hmap &#123;</span><br><span class="line">    <span class="keyword">if</span> !ismapkey(t.key) &#123;                             <span class="comment">/* pointer --&gt; ^^^^^ */</span></span><br><span class="line">        throw(<span class="string">"runtime.makemap: unsupported map key type"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* I delete some checks */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// make sure zeroptr is large enough</span></span><br><span class="line">    mapzero(t.elem)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// find size parameter which will hold the requested # of elements</span></span><br><span class="line">    B := <span class="typename">uint8</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> ; hint &gt; bucketCnt &amp;&amp; <span class="typename">float32</span>(hint) &gt; loadFactor*<span class="typename">float32</span>(<span class="typename">uintptr</span>(<span class="number">1</span>)&lt;&lt;B); B++ &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// allocate initial hash table</span></span><br><span class="line">    <span class="comment">// if B == 0, the buckets field is allocated lazily later (in mapassign)</span></span><br><span class="line">    <span class="comment">// If hint is large zeroing this memory could take a while.</span></span><br><span class="line">    buckets := bucket</span><br><span class="line">    <span class="keyword">if</span> B != <span class="number">0</span> &#123;</span><br><span class="line">        buckets = newarray(t.bucket, <span class="typename">uintptr</span>(<span class="number">1</span>)&lt;&lt;B)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// initialize Hmap</span></span><br><span class="line">    <span class="keyword">if</span> h == <span class="constant">nil</span> &#123;</span><br><span class="line">        h = (*hmap)(newobject(t.hmap))  <span class="comment">/*  */</span></span><br><span class="line">    &#125;</span><br><span class="line">    h.count = <span class="number">0</span></span><br><span class="line">    h.B = B</span><br><span class="line">    h.flags = <span class="number">0</span></span><br><span class="line">    h.hash0 = fastrand1()</span><br><span class="line">    h.buckets = buckets</span><br><span class="line">    h.oldbuckets = <span class="constant">nil</span></span><br><span class="line">    h.nevacuate = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> h</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>A map is always 8 bytes(amd64, ubuntu 14.04 LTS), because <code>makemap</code> returns a poniter, ponites to hmap, the underlying data sturcture is allocated in heap.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// implementation of new builtin</span></span><br><span class="line"><span class="keyword">func</span> newobject(typ *_type) unsafe.Pointer &#123;</span><br><span class="line">    flags := <span class="typename">uint32</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> typ.kind&amp;kindNoPointers != <span class="number">0</span> &#123;</span><br><span class="line">        flags |= flagNoScan</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mallocgc(<span class="typename">uintptr</span>(typ.size), typ, flags)</span><br><span class="line">    <span class="comment">/* compares with newarray, no multiplication */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>It is worth nothing that <code>v, ok := map[k]</code> and <code>v := map[k]</code> are also implemented in this file.</p>
<h2 id="Channel">Channel</h2><p>source file: go/src/runtime/channel.go</p>
<h3 id="Data_structure-2">Data structure</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> hchan <span class="keyword">struct</span> &#123;</span><br><span class="line">    qcount   <span class="typename">uint</span>           <span class="comment">// total data in the queue</span></span><br><span class="line">    dataqsiz <span class="typename">uint</span>           <span class="comment">// size of the circular queue</span></span><br><span class="line">    buf      unsafe.Pointer <span class="comment">// points to an array of dataqsiz elements</span></span><br><span class="line">    elemsize <span class="typename">uint16</span></span><br><span class="line">    closed   <span class="typename">uint32</span></span><br><span class="line">    elemtype *_type <span class="comment">// element type</span></span><br><span class="line">    sendx    <span class="typename">uint</span>   <span class="comment">// send index</span></span><br><span class="line">    recvx    <span class="typename">uint</span>   <span class="comment">// receive index</span></span><br><span class="line">    recvq    waitq  <span class="comment">// list of recv waiters</span></span><br><span class="line">    sendq    waitq  <span class="comment">// list of send waiters</span></span><br><span class="line">    lock     mutex</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Make_chan">Make chan</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">makechan</span><span class="params">(t *chantype, size int64)</span></span> *hchan &#123;</span><br><span class="line">    elem := t.elem</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* I delete some checks */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">c</span> *hchan</span><br><span class="line">    <span class="keyword">if</span> elem.kind&amp;kindNoPointers != <span class="number">0</span> || size == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="comment">// Allocate memory in one call.</span></span><br><span class="line">        <span class="comment">// Hchan does not contain pointers interesting for GC in this case:</span></span><br><span class="line">        <span class="comment">// buf points into the same allocation, elemtype is persistent.</span></span><br><span class="line">        <span class="comment">// SudoG's are referenced from their owning thread so they can't be collected.</span></span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span>(dvyukov,rlh): Rethink when collector can move allocated objects.</span></span><br><span class="line">        <span class="built_in">c</span> = (*hchan)(mallocgc(hchanSize+uintptr(size)*uintptr(elem.size), <span class="literal">nil</span>, flagNoScan))</span><br><span class="line">        <span class="keyword">if</span> size &gt; <span class="number">0</span> &amp;&amp; elem.size != <span class="number">0</span> &#123;</span><br><span class="line">            <span class="built_in">c</span>.buf = add(<span class="keyword">unsafe</span>.<span class="type">Pointer</span>(<span class="built_in">c</span>), hchanSize)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// race detector uses this location for synchronization</span></span><br><span class="line">            <span class="comment">// Also prevents us from pointing beyond the allocation (see issue 9401).</span></span><br><span class="line">            <span class="built_in">c</span>.buf = <span class="keyword">unsafe</span>.<span class="type">Pointer</span>(<span class="built_in">c</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">c</span> = <span class="keyword">new</span>(hchan)</span><br><span class="line">        <span class="built_in">c</span>.buf = newarray(elem, uintptr(size))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">c</span>.elemsize = uint16(elem.size)</span><br><span class="line">    <span class="built_in">c</span>.elemtype = elem</span><br><span class="line">    <span class="built_in">c</span>.dataqsiz = uint(size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debugChan &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"makechan: chan="</span>, <span class="built_in">c</span>, <span class="string">"; elemsize="</span>, elem.size, <span class="string">"; elemalg="</span>, elem.alg, <span class="string">"; dataqsiz="</span>, size, <span class="string">"\n"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">c</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>A channel variable at runtime(not package) is very much like a map variable, they are both pointers, pointes to heap.</p>
<h2 id="Make_gist">Make gist</h2><p>I wrote a gist to uncover slice, map and channel at runtime(not package)<a href="http://goog-perftools.sourceforge.net/doc/tcmalloc.html" target="_blank" rel="external">2</a>.</p>
<script src="https://gist.github.com/Overvenus/f6cf225ec33cc98d6b8c.js"></script>

<h3 id="Outputs_in_my_laptop">Outputs in my laptop</h3><p>Env: Ubuntu 14.04 LTS, amd64</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">$ go run make.go</span><br><span class="line">GOOS linux</span><br><span class="line">GOARCH amd64</span><br><span class="line">--- array &amp; slice ---</span><br><span class="line"><span class="string">si:</span> <span class="string">type:</span> [<span class="number">100</span>]<span class="typename">int</span></span><br><span class="line"><span class="string">si:</span> <span class="string">sizeof:</span> <span class="number">800</span></span><br><span class="line"><span class="string">si:</span> address <span class="number">1</span>st ele.: <span class="number">0xc820062380</span></span><br><span class="line">---</span><br><span class="line"><span class="string">asi:</span>    <span class="string">type:</span> *[<span class="number">100</span>]<span class="typename">int</span></span><br><span class="line"><span class="string">asi:</span>    <span class="string">sizeof:</span> <span class="number">8</span></span><br><span class="line"><span class="string">asi:</span>    <span class="string">address:</span> <span class="number">0xc820062380</span></span><br><span class="line"><span class="string">asi:</span>    address <span class="number">1</span>st ele.: <span class="number">0xc820062380</span></span><br><span class="line">---</span><br><span class="line">si[:<span class="number">20</span>]:    <span class="string">type:</span> []<span class="typename">int</span></span><br><span class="line">si[:<span class="number">20</span>]:    <span class="string">sizeof:</span> <span class="number">24</span></span><br><span class="line">si[:<span class="number">20</span>]:    address <span class="number">1</span>st ele.: <span class="number">0xc820062380</span></span><br><span class="line">---</span><br><span class="line">si[:<span class="number">80</span>]:    <span class="string">type:</span> []<span class="typename">int</span></span><br><span class="line">si[:<span class="number">80</span>]:    <span class="string">sizeof:</span> <span class="number">24</span></span><br><span class="line">si[:<span class="number">80</span>]:    address <span class="number">1</span>st ele.: <span class="number">0xc820062380</span></span><br><span class="line">---</span><br><span class="line"><span class="string">assi:</span>   <span class="string">type:</span> *[]<span class="typename">int</span></span><br><span class="line"><span class="string">assi:</span>   <span class="string">sizeof:</span> <span class="number">8</span></span><br><span class="line"><span class="string">assi:</span>   <span class="string">address:</span> <span class="number">0xc8200105e0</span></span><br><span class="line">--- map ---</span><br><span class="line"><span class="string">m:</span>  <span class="string">type:</span> map[<span class="typename">int</span>]<span class="typename">int</span></span><br><span class="line"><span class="string">m:</span>  <span class="string">sizeof:</span> <span class="number">8</span></span><br><span class="line">---</span><br><span class="line"><span class="string">am:</span> <span class="string">type:</span> *map[<span class="typename">int</span>]<span class="typename">int</span></span><br><span class="line"><span class="string">am:</span> <span class="string">sizeof:</span> <span class="number">8</span></span><br><span class="line">--- channel ---</span><br><span class="line"><span class="string">ci:</span> <span class="string">type:</span> chan <span class="typename">int</span></span><br><span class="line"><span class="string">ci:</span> <span class="string">sizeof:</span> <span class="number">8</span></span><br><span class="line">---</span><br><span class="line"><span class="string">aci:</span>    <span class="string">type:</span> *chan <span class="typename">int</span></span><br><span class="line"><span class="string">aci:</span>    <span class="string">sizeof:</span> <span class="number">8</span></span><br><span class="line">---</span><br><span class="line"><span class="string">ci:</span> <span class="string">type:</span> chan <span class="typename">int</span></span><br><span class="line"><span class="string">ci:</span> <span class="string">sizeof:</span> <span class="number">8</span></span><br><span class="line">---</span><br><span class="line"><span class="string">abci:</span>   <span class="string">type:</span> *chan <span class="typename">int</span></span><br><span class="line"><span class="string">abci:</span>   <span class="string">sizeof:</span> <span class="number">8</span></span><br></pre></td></tr></table></figure>
<h2 id="Links">Links</h2><blockquote>
<p>[1], <a href="https://docs.google.com/document/d/1P3BLR31VA8cvLJLfMibSuTdwTuF7WWLux71CYD0eeD8" target="_blank" rel="external">Go 1.3+ Compiler Overhaul</a><br>[2], <a href="http://goog-perftools.sourceforge.net/doc/tcmalloc.html" target="_blank" rel="external">TCMalloc : Thread-Caching Malloc</a><br>[3], <a href="https://gist.github.com/Overvenus/f6cf225ec33cc98d6b8c" target="_blank" rel="external">slice, map and channel at runtime</a><br>[4], <a href="https://blog.golang.org/go-slices-usage-and-internals" target="_blank" rel="external">Go Slices: usage and internals</a></p>
</blockquote>
<p>End.</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="Where_is_the_make_implemention?">Where is the make implemention?</h2><p>package <strong>runtime</strong><br>By the way, <em>new</em>]]>
    </summary>
    
      <category term="go" scheme="http://neilsh.me/tags/go/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Protocol and FSM]]></title>
    <link href="http://neilsh.me/2015/10/23/protocol_and_fsm/"/>
    <id>http://neilsh.me/2015/10/23/protocol_and_fsm/</id>
    <published>2015-10-23T13:17:00.000Z</published>
    <updated>2015-11-11T12:33:40.000Z</updated>
    <content type="html"><![CDATA[<h2 id="Protocol">Protocol</h2><p>æœ¬æ–‡ä¸­ Protocol ç‰¹æŒ‡é€šè®¯åè®®ã€‚<br>é¦–å…ˆç®€å•çš„ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯ Protocolï¼Œæ¥çœ‹çœ‹ WIKI ä¸Šæ˜¯æ€ä¹ˆå®šä¹‰å®ƒçš„ï¼š</p>
<blockquote>
<p>Communications protocol, a defined set of rules and regulations that determine how data is transmitted in telecommunications and computer networking  â€”<a href="https://en.wikipedia.org/wiki/Protocol" target="_blank" rel="external">WIKI#Protocol</a></p>
</blockquote>
<p>ç®€å•çš„æ¥è¯´ï¼Œåè®®æ˜¯è§„èŒƒæ•°æ®ä¼ è¾“çš„ä¸€å¥—è§„åˆ™ã€‚</p>
<h2 id="Finite_State_Machines_(FSM)">Finite State Machines (FSM)</h2><p>ä¸‹é¢æ˜¯æ‘˜è‡ª WIKI çš„å¯¹æœ‰é™çŠ¶æ€æœºçš„è¯´æ˜ï¼š</p>
<blockquote>
<p>It is conceived as an abstract machine that can be in one of a finite number of states. The machine is in only one state at a time; the state it is in at any given time is called the current state. It can change from one state to another when initiated by a triggering event or condition; this is called a transition. A particular FSM is defined by a list of its states, and the triggering condition for each transition.    â€”<a href="https://en.wikipedia.org/wiki/Finite-state_machine" target="_blank" rel="external">WIKI#FSM</a></p>
</blockquote>
<p>æœ‰é™çŠ¶æ€æœºæ˜¯ä¸€ç§æŠ½è±¡çš„æœºå™¨ï¼Œæ‹¥æœ‰æœ‰é™ä¸ªçŠ¶æ€ã€‚å®ƒåœ¨æ¯ä¸ªç¡®å®šçš„æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªçŠ¶æ€ï¼ˆå½“å‰çŠ¶æ€ï¼‰ï¼Œå®ƒçš„çŠ¶æ€ä¼šç”±äºè¾“å…¥æ¡ä»¶è€Œå‘ç”Ÿå˜åŒ–ã€‚ä¸€ä¸ªçŠ¶æ€è½¬ç§»è¡¨å¯ä»¥å®šä¹‰ä¸€ä¸ªæœ‰é™çŠ¶æ€æœºã€‚<br>æœ‰ç‚¹ç»•ï¼Œä¸è¿‡æŒ‰æˆ‘çš„ç†è§£ï¼Œæœ‰é™çŠ¶æ€æœºæœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼ŒçŠ¶æ€å’Œè¾“å…¥æ¡ä»¶ã€‚è¿™ä¸¤è€…ä¹‹é—´æœ‰ä¸€å¥—è§„åˆ™æŸç¼šç€ï¼Œè§„åˆ™å°±è¿™ä¸ª FSM çš„è¡Œä¸ºã€‚<br><a id="more"></a></p>
<h2 id="Protocol_and_FSM">Protocol and FSM</h2><p>æŠŠ Protocol å’Œ FSM å†™åœ¨ä¸€èµ·è‡ªç„¶æ˜¯å› ä¸ºå®ƒä»¬æœ‰ç€ç´§å¯†çš„è”ç³»ã€‚ä¸å‡†ç¡®çš„æ¥è¯´ï¼Œ Protocol å°±æ˜¯ FSM çš„è¡Œä¸ºï¼Œéµå¾ª Protocol çš„å®ä½“ï¼ˆä»¬ï¼‰æ„æˆäº†è¿™ä¸ª FSM çš„æŠ½è±¡æœºå™¨ã€‚</p>
<h2 id="Implement_a_Protocol">Implement a Protocol</h2><p>å®ç°åè®®ä¸ç®€å•ï¼Œç‰¹åˆ«æ˜¯å¤æ‚çš„ï¼ŒæŒç»­çŠ¶æ€çš„åè®®ï¼ŒTCP ç®—å…¶ä¸­ä¸€ä¸ªğŸ˜‚ã€‚<br>åˆ—ä¸€ä¸‹å®ç°åè®®çš„å›°éš¾ç‚¹ï¼š</p>
<ol>
<li>çŠ¶æ€å¯èƒ½æœ‰å¤šç§ã€‚</li>
<li>æ¡ä»¶å¯èƒ½æœ‰å¤šç§ã€‚</li>
<li>1, 2ç»„åˆäº§ç”Ÿçš„æƒ…å†µæ›´å¤šï¼</li>
<li>å› é€»è¾‘ä¸æ¸…è€Œäº§ç”Ÿçš„ BUG éš¾ä»¥æ’æŸ¥ã€‚</li>
<li>å¤æ‚åè®®å®¹æ˜“äº§ç”Ÿé«˜è€¦åˆçš„ä»£ç ã€‚</li>
</ol>
<p>è¯´äº†å›°éš¾ç‚¹ï¼Œå½“ç„¶è¦é¢˜è§£å†³æ€è·¯ï¼š</p>
<ol>
<li>ç¼–å†™ä»£ç å‰ç”»å‡ºçŠ¶æ€è½¬ç§»å›¾ï¼Œç†æ¸…æ€è·¯ã€‚</li>
<li>ç¼–å†™ä»£ç å‰å®šå¥½å„ä¸ªå‡½æ•°çš„ä½œç”¨ï¼ŒåŠè°ƒç”¨èŒƒå›´ã€‚</li>
<li>ç¼–å†™ä»£ç æ—¶é¿å…è¿‡æ—©çš„ä¼˜åŒ–ï¼Œ premature optimization is the root of all evilï¼Œ Knuth</li>
<li>æœ‰ Test case é‚£è‡ªç„¶æ˜¯æå¥½çš„ã€‚</li>
</ol>
<p>è¿™å››ç‚¹ï¼Œç®­ç®­å°„ä¸­æˆ‘è†ç›–ã€‚å”‰ï¼Œäººå•Šï¼Œä¸ºä»€ä¹ˆç—›è¿‡ä¹‹åæ‰çŸ¥é“æ‚”æ”¹ï¼ï¼ˆä¸¥è‚ƒè„¸ï¼‰</p>
<h2 id="Viewservice">Viewservice</h2><p>6.824 çš„ lab2 Part A è®©æˆ‘ä»¬å®ç°ä¸€ä¸ªå…·ä½“çš„åè®®ã€‚è®¡ç®—æœºæœ‰éšæ—¶å®•æœºçš„å¯èƒ½ï¼Œä¸€æ—¦å‘ç”Ÿå®ƒæä¾›çš„æœåŠ¡å°±ä¸å¯å¾—äº†ã€‚è¯¥åè®®å¼•å…¥ä¸»æœºï¼ˆPrimaryï¼‰å’Œä»æœºï¼ˆBackupï¼‰æœºåˆ¶å¹¶åŠæ—¶æ£€æŸ¥ä¸¤è€…çš„å­˜æ´»çŠ¶æ€ï¼Œä½¿ç³»ç»ŸæœåŠ¡å…·æœ‰é«˜å¯ç”¨æ€§ï¼Œä¸‹é¢ç§°è¿™ä¸ªåè®®ä¸º <strong>Viewservice</strong>ã€‚<br>Viewservice åœ¨æŸäº›æ¡ä»¶ä¸‹ä¼šäº§ç”Ÿä¸€ä¸ª <strong>View</strong>ã€‚View æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼ŒåŒ…å«ä¸»æœºå’Œä»æœºçš„åœ°å€ã€‚<br>ä¸‹é¢è¯´ä¸€ä¸‹è¿™ä¸ªåè®®è¦å…³é”®çš„å‡ ä¸ªç‚¹ï¼š</p>
<ol>
<li>æŒç»­çŠ¶æ€åè®®ï¼Œå½“å‰çŠ¶æ€ä¼šå½±å“åˆ°ä¸‹ä¸€çŠ¶æ€ã€‚</li>
<li>æ¯æ¬¡æ›´æ–° Viewï¼Œ Primary ä¸èƒ½ä¸ºç©ºã€‚</li>
<li>ä¸‹ä¸€ä¸ª View ä¸­çš„ Primary å¿…é¡»ä¸ºå½“å‰ View çš„ Primary æˆ– Backupã€‚</li>
<li>æ¯ä¸ªæ´»åŠ¨çš„æœåŠ¡å™¨éƒ½ä¿å­˜åœ¨ viewserver ä¸­ï¼ŒçŠ¶æ€æ˜¯ Primary, Backup, Idle å…¶ä¸­çš„ä¸€ç§ã€‚</li>
<li>å½“å‰ View ä¸­çš„ Primary å’Œ Backup åŒæ—¶å‡ºé”™æ—¶ï¼ŒæœåŠ¡ç»“æŸã€‚</li>
</ol>
<p>ä¸Šé¢å‡ ç‚¹å¹¶æ²¡æœ‰å®Œæ•´åœ°æè¿° Viewserviceï¼Œä½†å·²è¶³å¤Ÿç”¨æ¥é˜è¿° Protocol å’Œ FSM ä¹‹å‰çš„å…³ç³»ï¼Œæƒ³çœ‹å®Œæ•´çš„åè®®è¯·è®¿é—®<a href="http://nil.csail.mit.edu/6.824/2015/labs/lab-2.html" target="_blank" rel="external">lab2#Part A</a>.</p>
<h2 id="Viewservice_FSM">Viewservice FSM</h2><p>ä¸éš¾å‘ç° View å°±æ˜¯çŠ¶æ€ï¼Œæ¡ä»¶å°±æ˜¯ Primaryï¼ŒBackupï¼ŒIdleä¸‰è€…çš„å­˜æ´»çŠ¶æ€ã€‚<br>æ³¨æ„ï¼Œä¸ºäº†ä¾¿äºç†è§£ï¼Œè¿™é‡Œçš„ FSM åªæ˜¯å®Œæ•´çš„ Viewservice ä¸­çš„<strong>å…³é”®éƒ¨åˆ†ï¼ˆé”™è¯¯å¤„ç†ï¼‰</strong>ï¼Œæˆ‘å»æ‰äº†ä¸€äº›æ— å…³ç—›ç—’çš„å†…å®¹ï¼Œå¹¶ä¸”æˆ‘å¯¹ Idle å¤šäº†ä¸€ä¸ªé™åˆ¶ï¼šæ¯ä¸ªæ—¶åˆ»è¦æ²¡æœ‰ Idleï¼Œè¦ä¹ˆåªæœ‰ä¸€ä¸ªï¼Œä¸ä¼šæœ‰å¤šä¸ªå­˜åœ¨ã€‚ä½†å°±ç®—è¿™ä¸ªé™åˆ¶ä¸å­˜åœ¨ä¹Ÿä¸ä¼šå½±å“æœ€åçš„æ­£ç¡®æ€§ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ Idle åªæœ‰ä¸¤ç§çŠ¶æ€ï¼Œç®€åŒ–äº†æ¡ä»¶çš„åŒæ—¶è¿˜ä¾¿äºè¡¨ç¤ºï¼ˆ0 or 1ï¼‰ ;-)</p>
<p>ç”±æ­¤è®¾ä¸‰ä½äºŒè¿›åˆ¶æ•°ï¼šXXXï¼Œ åˆ†åˆ«ä»£è¡¨ Primaryï¼ŒBackupå’ŒIdleã€‚1ä¸ºå­˜æ´»ï¼Œ0ä¸ºå‡ºé”™ã€‚</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">Primary</th>
<th style="text-align:center">Backup</th>
<th style="text-align:center">Idle</th>
<th style="text-align:right">XXX</th>
</tr>
</thead>
<tbody>
<tr>
<td>Alive</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:right">111</td>
</tr>
<tr>
<td>Dead</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
<td style="text-align:right">000</td>
</tr>
</tbody>
</table>
<p>å¯èƒ½è¾“å‡ºçš„çŠ¶æ€æœ‰å››ç§ï¼š</p>
<ol>
<li>100ï¼Œåªæœ‰ Primary å­˜æ´»ã€‚</li>
<li>110ï¼ŒPrimary å’Œ Backup å­˜æ´»ï¼Œæ²¡æœ‰ Idleã€‚</li>
<li>111ï¼ŒPrimaryï¼ŒBackup å’Œ Idle éƒ½å­˜æ´»ã€‚</li>
<li>00Xï¼ŒPrimary å’Œ Backupï¼Œ æœåŠ¡ç»“æŸã€‚</li>
</ol>
<p>æ³¨æ„ï¼š X ä»£è¡¨ 0 å’Œ 1ï¼Œ00X å°±æ˜¯ 000 å’Œ 001 çš„åˆé›†</p>
<p>æ‰€æœ‰å¯èƒ½çš„æ¡ä»¶ï¼š</p>
<p> 1.100<br> 2.101<br> 3.110<br> 4.111<br> 5.010<br> 6.011<br> 7.00X</p>
<p>ä¸¤è€…äº§ç”Ÿçš„çŠ¶æ€è½¬ç§»è¡¨ï¼š ç«–ä¸ºå½“å‰çŠ¶æ€ï¼Œæ¨ªä¸ºæ¡ä»¶ï¼Œ<code>\</code> ä¸ºä¸ä¼šå‡ºç°çš„æƒ…å†µ</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">100</th>
<th style="text-align:center">101</th>
<th style="text-align:center">110</th>
<th style="text-align:center">111</th>
<th style="text-align:center">010</th>
<th style="text-align:center">011</th>
<th style="text-align:center">00X</th>
</tr>
</thead>
<tbody>
<tr>
<td>100</td>
<td style="text-align:center">110</td>
<td style="text-align:center">\</td>
<td style="text-align:center">100</td>
<td style="text-align:center">\</td>
<td style="text-align:center">\</td>
<td style="text-align:center">\</td>
<td style="text-align:center">00X</td>
</tr>
<tr>
<td>110</td>
<td style="text-align:center">110</td>
<td style="text-align:center">110</td>
<td style="text-align:center">100</td>
<td style="text-align:center">111</td>
<td style="text-align:center">100</td>
<td style="text-align:center">110</td>
<td style="text-align:center">00X</td>
</tr>
<tr>
<td>111</td>
<td style="text-align:center">110</td>
<td style="text-align:center">110</td>
<td style="text-align:center">100</td>
<td style="text-align:center">111</td>
<td style="text-align:center">100</td>
<td style="text-align:center">110</td>
<td style="text-align:center">00X</td>
</tr>
<tr>
<td>00X</td>
<td style="text-align:center">00X</td>
<td style="text-align:center">00X</td>
<td style="text-align:center">00X</td>
<td style="text-align:center">00X</td>
<td style="text-align:center">00X</td>
<td style="text-align:center">00X</td>
<td style="text-align:center">00X</td>
</tr>
</tbody>
</table>
<p>æ ¹æ®ä¸Šé¢çš„è¡¨å¯ä»¥ç”»å‡ºçŠ¶æ€è½¬ç§»å›¾ï¼Œæ›´ç›´è§‚åœ°è¯´æ˜è¿™ä¸ª FSM</p>
<p><img src="http://ww1.sinaimg.cn/large/7f793092gw1exdcpwse63j21kw15madn.jpg" alt=""></p>
<p>æ¸…æ¥šäº†è¿™ä¸ª FSMï¼Œå„ç§æƒ…å†µäº†ç„¶äºå¿ƒï¼Œè®¾è®¡æ•°æ®ç»“æ„ï¼Œç¼–å†™ä»£ç ï¼Œå®ç°åè®® so easyã€‚</p>
<h2 id="åè¯">åè¯</h2><p>Part Aéƒ¨åˆ†æˆ‘èŠ±äº†ä¸å°‘æ—¶é—´ï¼Œä¸»è¦è¿˜æ˜¯å½“åˆæ²¡æœ‰ç†æ¸…åè®®ï¼Œæœ‰å¤šä¸ª Test é€šä¸è¿‡ï¼Œä»£ç ç»“æ„æ¨åˆ°äº†ä¸€éåˆä¸€éã€‚åœ¨æœºç¼˜å·§åˆä¸‹ï¼ˆdebugä¸‹ï¼‰å‘ç°åè®®å’Œæ•°ç”µä¸­çš„çŠ¶æ€è½¬ç§»å›¾æœ‰ç´§å¯†çš„è”ç³»ã€‚ç„¶åå°è¯•ç”¨çŠ¶æ€è½¬ç§»å›¾æ¥è¡¨ç¤ºåè®®ï¼Œæ²¡æƒ³åˆ°è¿˜çœŸå¯ä»¥ã€‚æ ¹æ®çŠ¶æ€è½¬ç§»å›¾æ”¹å–„äº†ä¸€ä¸‹ä»£ç ï¼Œé€šè¿‡å„ç§ Test å¿«å¾—é£èµ·ï¼è¿™ä¹ˆå¥½çš„æ–¹æ³•ä¸å¯èƒ½æ²¡æœ‰äººæ¯”æˆ‘å…ˆæƒ³åˆ°ï¼ŒæŸ¥äº† google æ‰çŸ¥é“æœ‰ä¸ªæ¦‚å¿µå«<em>æœ‰é™çŠ¶æ€æœº</em>ï¼Œæœ‰é—¨è¯¾å« <em>Protocol Engineering</em>ï¼Œæˆ‘çš„è§†é‡è¿˜å¤ªå°ã€‚æœ€åå‘ä¸€å¼  TCP çš„çŠ¶æ€è½¬ç§»å›¾ï¼Œæ„Ÿå—ä¸‹ TCP çš„å¤æ‚æ€§ã€‚</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/f/f6/Tcp_state_diagram_fixed_new.svg" alt=""></p>
<h2 id="Ref-">Ref.</h2><blockquote>
<p><a href="http://nil.csail.mit.edu/6.824/2015/labs/lab-2.html" target="_blank" rel="external">lab2#Part A</a></p>
<p><a href="https://en.wikipedia.org/wiki/Protocol" target="_blank" rel="external">WIKI#Protocol</a></p>
<p><a href="https://en.wikipedia.org/wiki/Finite-state_machine" target="_blank" rel="external">WIKI#FSM</a></p>
<p><a href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol" target="_blank" rel="external">WIKI#TCP</a></p>
<p><a href="http://pet.ece.iisc.ernet.in/course/E2223/ch.pdf" target="_blank" rel="external">Specification of Protocol Using FSM</a></p>
<p><a href="http://cs.uccs.edu/~cs522/pe/pe.htm" target="_blank" rel="external">Protocol Specification using Sequence Chart or Message Flow DiagramApply Formal Method To Protocol Specification</a></p>
</blockquote>
<p>End.</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="Protocol">Protocol</h2><p>æœ¬æ–‡ä¸­ Protocol ç‰¹æŒ‡é€šè®¯åè®®ã€‚<br>é¦–å…ˆç®€å•çš„ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯ Protocolï¼Œæ¥çœ‹çœ‹ WIKI ä¸Šæ˜¯æ€ä¹ˆå®šä¹‰å®ƒçš„ï¼š</p>
<blockquote>
<p>Communications protocol, a defined set of rules and regulations that determine how data is transmitted in telecommunications and computer networking  â€”<a href="https://en.wikipedia.org/wiki/Protocol">WIKI#Protocol</a></p>
</blockquote>
<p>ç®€å•çš„æ¥è¯´ï¼Œåè®®æ˜¯è§„èŒƒæ•°æ®ä¼ è¾“çš„ä¸€å¥—è§„åˆ™ã€‚</p>
<h2 id="Finite_State_Machines_(FSM)">Finite State Machines (FSM)</h2><p>ä¸‹é¢æ˜¯æ‘˜è‡ª WIKI çš„å¯¹æœ‰é™çŠ¶æ€æœºçš„è¯´æ˜ï¼š</p>
<blockquote>
<p>It is conceived as an abstract machine that can be in one of a finite number of states. The machine is in only one state at a time; the state it is in at any given time is called the current state. It can change from one state to another when initiated by a triggering event or condition; this is called a transition. A particular FSM is defined by a list of its states, and the triggering condition for each transition.    â€”<a href="https://en.wikipedia.org/wiki/Finite-state_machine">WIKI#FSM</a></p>
</blockquote>
<p>æœ‰é™çŠ¶æ€æœºæ˜¯ä¸€ç§æŠ½è±¡çš„æœºå™¨ï¼Œæ‹¥æœ‰æœ‰é™ä¸ªçŠ¶æ€ã€‚å®ƒåœ¨æ¯ä¸ªç¡®å®šçš„æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªçŠ¶æ€ï¼ˆå½“å‰çŠ¶æ€ï¼‰ï¼Œå®ƒçš„çŠ¶æ€ä¼šç”±äºè¾“å…¥æ¡ä»¶è€Œå‘ç”Ÿå˜åŒ–ã€‚ä¸€ä¸ªçŠ¶æ€è½¬ç§»è¡¨å¯ä»¥å®šä¹‰ä¸€ä¸ªæœ‰é™çŠ¶æ€æœºã€‚<br>æœ‰ç‚¹ç»•ï¼Œä¸è¿‡æŒ‰æˆ‘çš„ç†è§£ï¼Œæœ‰é™çŠ¶æ€æœºæœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼ŒçŠ¶æ€å’Œè¾“å…¥æ¡ä»¶ã€‚è¿™ä¸¤è€…ä¹‹é—´æœ‰ä¸€å¥—è§„åˆ™æŸç¼šç€ï¼Œè§„åˆ™å°±è¿™ä¸ª FSM çš„è¡Œä¸ºã€‚<br>]]>
    
    </summary>
    
      <category term="Algorithms" scheme="http://neilsh.me/tags/Algorithms/"/>
    
      <category term="C.S.ç¬”è®°" scheme="http://neilsh.me/tags/C-S-%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Go Note]]></title>
    <link href="http://neilsh.me/2015/10/08/golang_note/"/>
    <id>http://neilsh.me/2015/10/08/golang_note/</id>
    <published>2015-10-08T14:03:00.000Z</published>
    <updated>2015-11-11T12:33:40.000Z</updated>
    <content type="html"><![CDATA[<!--
TODO:
   - ...
-->
<h2 id="new,_make_and_Local_variable"><code>new</code>, <code>make</code> and Local variable</h2><p>In short: new allocates memory; make initializes the slice, map, and channel types; local variable may be not <em>local</em> at all.</p>
<blockquote>
<p><code>new</code>: new(T) allocates zeroed storage for a new item of type T and returns its address, a value of type *T. In Go terminology, it returns a pointer to a newly allocated zero value of type T.</p>
<p><code>make</code>: creates slices, maps, and channels only, and it returns an <em>initialized (not zeroed)</em> value of type T (not *T).  </p>
<p>Local variable: unlike in C, itâ€™s perfectly OK to return the address of a local variable; the storage associated with the variable survives after the function returns. In fact, taking the address of a composite literal allocates a fresh instance each time it is evaluated, so we can combine these last two lines. (e.g., <code>return &amp;File{fd: fd, name: name}</code>)<br> â€” <a href="https://golang.org/doc/effective_go.html#allocation_new" target="_blank" rel="external">Effective GO#allocation_new</a><br><a id="more"></a></p>
</blockquote>
<h2 id="Stack_or_Heap?">Stack or Heap?</h2><p><a href="https://golang.org/doc/faq#stack_or_heap" target="_blank" rel="external">Golang FAQ#stackheap</a><br><strong>How do I know whether a variable is allocated on the heap or the stack?</strong></p>
<p>From a correctness standpoint, you donâ€™t need to know. Each variable in Go exists as long as there are <em>references</em> to it. The storage location chosen by the implementation is irrelevant to the semantics of the language.</p>
<p>The storage location does have an effect on writing efficient programs. When possible, the Go compilers will allocate variables that are local to a function in that functionâ€™s stack frame. However, if the compiler cannot prove that the variable is not referenced after the function returns, then the compiler must allocate the variable on the garbage-collected heap to avoid dangling pointer errors. Also, if a local variable is very large, it might make more sense to store it on the heap rather than the stack.</p>
<p>In the current compilers, if a variable has its address taken, that variable is a candidate for allocation on the heap. However, a basic escape analysis recognizes some cases when such variables will not live past the return from the function and can reside on the stack.</p>
<p>An excellent talk about stack and heap of Go. <a href="http://dave.cheney.net/2014/06/07/five-things-that-make-go-fast" target="_blank" rel="external">Five things that make Go fast</a></p>
<h2 id="Happen_before_and_Channel">Happen before and Channel</h2><p><a href="https://golang.org/ref/mem#tmp_7" target="_blank" rel="external">Golang Memory Model#channel</a></p>
<blockquote>
<p>A send on a channel happens before the corresponding receive from that channel completes.</p>
</blockquote>
<p>An interesting case where <em>Happen Before</em> will take place.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="typename">int</span>)</span><br><span class="line"><span class="keyword">var</span> a <span class="typename">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> f() &#123;</span><br><span class="line">    a = <span class="string">"hello, world"</span></span><br><span class="line">    &lt;-c</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">    <span class="keyword">go</span> f()</span><br><span class="line">    c &lt;- <span class="number">0</span></span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This snippet guarantes to print â€œhello, worldâ€. The write to a happens before the receive on c, which happens before the corresponding send on c completes, which happens before the print.<br>If the channel were buffered (e.g., <code>c = make(chan int, 1)</code>) then the program would not be guaranteed to print â€œhello, worldâ€. (It might print the empty string, crash, or do something else.)</p>
<h2 id="Concurrency">Concurrency</h2><p><a href="https://talks.golang.org/2012/concurrency.slide" target="_blank" rel="external">Go Concurrency Patterns</a></p>
<h3 id="main_exits"><code>main</code> exits</h3><p>What happens to goroutines that running background when main function returns?</p>
<blockquote>
<p>When the main returns, the programm goes away.<br>       â€” <a href="https://youtu.be/f6kdp27TYZs?t=7m46s" target="_blank" rel="external">Rob Pike#main_exit</a></p>
</blockquote>
<p>It confused me for a long time, now I get a concrete answer.</p>
<h3 id="Generator_in_Go">Generator in Go</h3><blockquote>
<p>Generator: function that returns a channel.<br>Channels are first-class values, just like strings or integers.</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"time"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"math/rand"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">    <span class="comment">// Python-like usage</span></span><br><span class="line">    <span class="keyword">for</span> s := <span class="keyword">range</span> boring(<span class="string">"generator"</span>) &#123;</span><br><span class="line">        fmt.Println(s)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"func main exits"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ### Generator ###</span></span><br><span class="line"><span class="keyword">func</span> boring(msg <span class="typename">string</span>) &lt;-<span class="keyword">chan</span> <span class="typename">string</span> &#123; <span class="comment">// Returns receive-only channel of strings.</span></span><br><span class="line">    c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="typename">string</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="keyword">func</span>() &#123; <span class="comment">// We launch the goroutine from inside the function.</span></span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">            c &lt;- fmt.Sprintf(<span class="string">"%s %d"</span>, msg, i)</span><br><span class="line">            time.Sleep(time.Duration(rand.Intn(<span class="number">1e3</span>)) * time.Millisecond)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">close</span>(c) <span class="comment">// close channel c, otherwise for-range will be blocked.</span></span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">return</span> c <span class="comment">// Return the channel to the caller.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Unlike <strong>Generator</strong> in Python, the concept in Go is simple: <em>Generator: function that returns a channel</em>.</p>
<ul>
<li>Python Generator: generates data in time.</li>
<li>Go Generator: return a channel, reveives data in time.</li>
</ul>
<h3 id="Tricky_Keyword,_select">Tricky Keyword, <code>select</code></h3><blockquote>
<p>Select<br>The select statement provides another way to handle multiple channels.<br>Itâ€™s like a switch, but each case is a communication: </p>
<ul>
<li>All channels are evaluated. </li>
<li>Selection blocks until one communication can proceed, which then does. </li>
<li>If multiple can proceed, select chooses pseudo-randomly. </li>
<li>A default clause, if present, executes immediately if no channel is ready.</li>
</ul>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> v1 := &lt;-c1:</span><br><span class="line">        fmt.Printf(<span class="string">"received %v from c1\n"</span>, v1)</span><br><span class="line">    <span class="keyword">case</span> v2 := &lt;-c2:</span><br><span class="line">        fmt.Printf(<span class="string">"received %v from c2\n"</span>, v1)</span><br><span class="line">    <span class="keyword">case</span> c3 &lt;- <span class="number">23</span>:</span><br><span class="line">        fmt.Printf(<span class="string">"sent %v to c3\n"</span>, <span class="number">23</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        fmt.Printf(<span class="string">"no one was ready to communicate\n"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Select with <strong>default</strong> is a non-blocking statement, even if no other case can be processed. Without <strong>default</strong>, select block forever if no other case can be processed.</p>
<p>END.</p>
]]></content>
    <summary type="html">
    <![CDATA[<!--
TODO:
   - ...
-->
<h2 id="new,_make_and_Local_variable"><code>new</code>, <code>make</code> and Local variable</h2><p>In short: new allocates memory; make initializes the slice, map, and channel types; local variable may be not <em>local</em> at all.</p>
<blockquote>
<p><code>new</code>: new(T) allocates zeroed storage for a new item of type T and returns its address, a value of type *T. In Go terminology, it returns a pointer to a newly allocated zero value of type T.</p>
<p><code>make</code>: creates slices, maps, and channels only, and it returns an <em>initialized (not zeroed)</em> value of type T (not *T).  </p>
<p>Local variable: unlike in C, itâ€™s perfectly OK to return the address of a local variable; the storage associated with the variable survives after the function returns. In fact, taking the address of a composite literal allocates a fresh instance each time it is evaluated, so we can combine these last two lines. (e.g., <code>return &amp;File{fd: fd, name: name}</code>)<br> â€” <a href="https://golang.org/doc/effective_go.html#allocation_new">Effective GO#allocation_new</a><br>]]>
    
    </summary>
    
      <category term="Go" scheme="http://neilsh.me/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ReadingFragment Structured Computer Organization]]></title>
    <link href="http://neilsh.me/2015/09/21/fragment_structured_Computer_Organization/"/>
    <id>http://neilsh.me/2015/09/21/fragment_structured_Computer_Organization/</id>
    <published>2015-09-21T11:44:00.000Z</published>
    <updated>2015-11-11T12:33:40.000Z</updated>
    <content type="html"><![CDATA[<h1 id="Parallelism_in_Computer_Organization">Parallelism in Computer Organization</h1><p>Why we need parallel computing? Because we are close to the limit of physics â€” the speed of light and memory becomes the bottleneck of computer.</p>
<h2 id="Parallelism_in_CPU">Parallelism in CPU</h2><ul>
<li>Pipeline<ul>
<li>Sinlge pipeline</li>
<li>Mutli-pipeline</li>
<li>Superscalar pipeline</li>
</ul>
</li>
<li>Array Computers, single control unit and a array of processor.</li>
<li>Multiprocessors, multiple CPUs shared with one common  main memory, and communicate through BUS.</li>
</ul>
<h2 id="Parallelism_in_Memory">Parallelism in Memory</h2><ul>
<li>Modern CPUs has itâ€™s own private memory, cache.</li>
<li>Redundant Array of Inexpensive Disk(RAID), there are 5 level of RAID. I will be surprised if one system supports all 5 level RAID, especially level 2 and 3 ;-)<ul>
<li>Level 0, strips data(typically, a sector) over disks in round robin fashion. No backups.</li>
<li>Level 1, make an additional redundant backup of level 0.</li>
</ul>
</li>
</ul>
<a id="more"></a>
<h1 id="IJVM">IJVM</h1><p><strong>IJVM</strong> is short for <em>Integer instructions only Java Virtual Machine</em>.</p>
<h2 id="IJVM_Memory_Model">IJVM Memory Model</h2><p>It looks like IJVM has a set of different stack operations compares with other machines. IJVM instructions can access memory only by indexing from some special registers. CPP, LV and SP point to word(4 bytes).</p>
<ul>
<li>The constant pool, addressing by CPP, it is loaded when the program is brought into memory and read-only afterward.</li>
<li>The Local variable frame, addressing by LV.</li>
<li>The operand stack, addressing by SP. Push and pop actions take place in this stack.</li>
<li>The method area, consider as the â€œTEXTâ€ area in UNIXâ€™s memory, addressing by PC. The first 2 byte indicating the number of parameters for the method, the second 2 bytes indicating the size of the local variables, opcode begins at the 5th byte.</li>
</ul>
<h2 id="IJVM_method_invocation">IJVM method invocation</h2><p>Instead of using <code>CALL</code> instraction, JVM use <code>INVOKEVIRTUAL</code>. Below is a brief explanation of method invocation(highly recommad reading <a href="http://users.cis.fiu.edu/~prabakar/cda4101/Common/notes/lecture20.html" target="_blank" rel="external">CDA-4101 Lecture 20 Notes</a>)</p>
<ol>
<li>Push <code>PC</code>, <code>LV</code>, <code>OBJREF</code>(reference of the methodâ€™s object) and parameters into Local variable frame.</li>
<li>Build a new Local variable frame, the size of the new frame are determined by the second 2 bytes reading from The method area, and stores the callerâ€™s PC ans LV in the top of the new frame. Replace <code>OBJREF</code> with <code>Link ptr</code> which points to the callerâ€™s PC. Now <code>LV</code> points to <code>Link ptr</code> and <code>SP</code> points to callerâ€™s LV.</li>
<li><code>PC</code> points to 5th byte in the method area.</li>
<li>Mark the new local variables frame as the current frame by seting <code>LV</code> with the address of <code>OBJREF</code>.</li>
</ol>
<p>After the method is done, the return value will be stored in <code>OBJREF</code> (<code>Link ptr</code>).</p>
<h2 id="Some_Qs_about_JVM">Some Qs about JVM</h2><ol>
<li>Give the Java statement that produced the following IJVM code:<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ILOAD <span class="literal">j</span></span><br><span class="line">ILOAD <span class="keyword">n</span></span><br><span class="line">ISUB</span><br><span class="line">BIPUSH 7</span><br><span class="line">ISUB</span><br><span class="line">DUP</span><br><span class="line">IADD</span><br><span class="line">ISTORE <span class="literal">i</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>A: <code>i = (j - n - 7) x 2;</code></p>
<ol>
<li>The JVM <code>INVOKEVIRTUAL</code> instruction needs to know how many parameters it has. Why?</li>
</ol>
<p>A: Old <code>PC</code> and <code>LV</code> will be stored on address of the top of local variables which will be computed by adding the size of local variables and <strong>parameters</strong>.</p>
<h1 id="Intel_Core_i7">Intel Core i7</h1><p>Core i7 is a CPU with CISC outside and RISC inside. In side the chip, there is a decoder which build a bridge between CISC instructions and RISC data path.</p>
<h1 id="Ref-">Ref.</h1><blockquote>
<p>Structured Computer Organization(6th Edition) by Andrew S. Tanenbaum<br><a href="http://users.cis.fiu.edu/~prabakar/cda4101/Common/notes/lecture20.html" target="_blank" rel="external">CDA-4101 Lecture 20 Notes</a></p>
</blockquote>
<p>ä¸ªäººç¬”è®°ï¼Œéš¾å…æœ‰è¯¯ï¼Œå¦‚æœ‰å‘ç°ï¼Œè¿˜æœ›æŒ‡å‡ºã€‚<br>END.</p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="Parallelism_in_Computer_Organization">Parallelism in Computer Organization</h1><p>Why we need parallel computing? Because we are close to the limit of physics â€” the speed of light and memory becomes the bottleneck of computer.</p>
<h2 id="Parallelism_in_CPU">Parallelism in CPU</h2><ul>
<li>Pipeline<ul>
<li>Sinlge pipeline</li>
<li>Mutli-pipeline</li>
<li>Superscalar pipeline</li>
</ul>
</li>
<li>Array Computers, single control unit and a array of processor.</li>
<li>Multiprocessors, multiple CPUs shared with one common  main memory, and communicate through BUS.</li>
</ul>
<h2 id="Parallelism_in_Memory">Parallelism in Memory</h2><ul>
<li>Modern CPUs has itâ€™s own private memory, cache.</li>
<li>Redundant Array of Inexpensive Disk(RAID), there are 5 level of RAID. I will be surprised if one system supports all 5 level RAID, especially level 2 and 3 ;-)<ul>
<li>Level 0, strips data(typically, a sector) over disks in round robin fashion. No backups.</li>
<li>Level 1, make an additional redundant backup of level 0.</li>
</ul>
</li>
</ul>]]>
    
    </summary>
    
      <category term="Reading" scheme="http://neilsh.me/tags/Reading/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[jupyter-core 4.0.6 çš„å‘å¸ƒ]]></title>
    <link href="http://neilsh.me/2015/09/18/jupyter_core_406/"/>
    <id>http://neilsh.me/2015/09/18/jupyter_core_406/</id>
    <published>2015-09-18T12:39:00.000Z</published>
    <updated>2015-11-11T12:33:40.000Z</updated>
    <content type="html"><![CDATA[<h1 id="Jupyter_ä¸_IPython">Jupyter ä¸ IPython</h1><p>Jupyter æ˜¯ç”± IPython æ¼”åŒ–è€Œæ¥çš„ï¼Œä¸¤è€…é…åˆä½¿ç”¨å¯æä¾›äº¤äº’å¼çš„ç¼–ç¨‹ä½“éªŒï¼Œå®ç°è§†è§‰åŒ–ç¼–ç¨‹ï¼Œå†™äº†ä»€ä¹ˆï¼Œé©¬ä¸Šå°±èƒ½çœ‹è§æ•ˆæœã€‚Jupyter ç±»ä¼¼äºå®¢æˆ·ç«¯ï¼ŒIPython ä½œä¸º Jupyter çš„å†…æ ¸ã€‚ä¹‹å‰ IPython çš„æ€æ‰‹é” notebook ç°åœ¨è½¬ç§»åˆ° Jupyter ä¸­äº†ã€‚è¯¥ç¥å™¨ä¸ä»…å¯¹ data science æœ‰å¥‡æ•ˆï¼Œå¯¹äºä¸€èˆ¬çš„ python åº”ç”¨å¼€å‘ä¹Ÿæœ‰æå¤§çš„å¸®åŠ©ï¼Œå®ƒåŒæ ·é€‚åˆç”¨äºå­¦ä¹  pythonï¼Œå…¶æ˜“ç”¨æ€§ç›´è¿½ PyCharmã€‚</p>
<h1 id="BUGï¼Ÿ">BUGï¼Ÿ</h1><p>IPython ä»Šå¹´åˆçš„æ—¶å€™å°±æœ‰æ‰€æ¥è§¦ï¼Œä¸è¿‡ç”¨äº†å‡ å¤©å°±å¸è½½äº†ï¼Œé‚£æ—¶ç”¨çš„è¿˜æ˜¯ IPython notebookã€‚æ˜¨å¤©ç”±äºè¯¾ç¨‹éœ€è¦ï¼Œæƒ³åœ¨æœ¬åœ°å®‰è£… IPythonã€‚ä¹ æƒ¯æ€§åœ° GOOGLEï¼Œ æ‰“å¼€ IPython çš„å®˜ç½‘ï¼ŒæŸ¥çœ‹å®‰è£…æ•™ç¨‹ <a href="https://jupyter.readthedocs.org/en/latest/install.html" target="_blank" rel="external">Installation</a> ï¼Œæ²¡æƒ³åˆ°å±…ç„¶è·³è½¬åˆ°äº† Jupyter çš„æ–‡æ¡£ï¼Œå½“æ—¶å°±å¤§åƒä¸€æ–¤ï¼Œå†ä»”ç»†ä¸€çœ‹ï¼Œå°¼ç›è¿ IPython å®˜ç½‘çš„åå­—éƒ½å˜äº†ã€‚</p>
<blockquote>
<p><a href="https://ipython.org/" target="_blank" rel="external">Jupyter and the future of IPython - IPython</a></p>
</blockquote>
<p>ä¸€ç›´ä»¥æ¥å°±çŸ¥é“ python çš„ä¸–ç•Œå˜åŒ–å¿«ï¼Œå¯æ²¡æƒ³åˆ°å±…ç„¶è¿™ä¹ˆå¿«ï¼Œæ²¡å‡ ä¸ªæœˆï¼Œé¡¹ç›®çš„åç§°éƒ½å˜äº†ã€‚ âˆ‘(ï¿£â–¡ï¿£;)<br><a id="more"></a><br>æŒ‰ç…§æ•™ç¨‹ï¼Œ<code>pip install jupyter</code>ï¼Œä¸€åˆ‡éƒ½å¾ˆé¡ºåˆ©ï¼Œé¡ºåˆ©åˆ°è®©æˆ‘ä¸æ•¢ç›¸ä¿¡ï¼Œå®‰è£… python ç¬¬ä¸‰æ–¹æ¨¡å—åœ¨æˆ‘å°è±¡ä¸­éƒ½æ˜¯æŒºè›‹ç–¼çš„ã€‚<br>æœä¸å…¶ç„¶ï¼Œå®‰è£…å®Œä¹‹åï¼Œä¸€è¿è¡Œ <code>jupter notebook</code> å°±æŠ¥é”™äº†ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter notebook</span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/usr/local/bin/jupyter-notebook"</span>, line <span class="number">11</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    sys.exit(main())</span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/jupyter_core/application.py"</span>, line <span class="number">267</span>, <span class="keyword">in</span> launch_instance</span><br><span class="line">    <span class="keyword">return</span> super(JupyterApp, cls).launch_instance(argv=argv, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/traitlets/config/application.py"</span>, line <span class="number">591</span>, <span class="keyword">in</span> launch_instance</span><br><span class="line">    app.initialize(argv) File <span class="string">"&lt;string&gt;"</span>, line <span class="number">2</span>, <span class="keyword">in</span> initialize</span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/traitlets/config/application.py"</span>, line <span class="number">75</span>, <span class="keyword">in</span> catch_config_error</span><br><span class="line">    <span class="keyword">return</span> method(app, *args, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/notebook/notebookapp.py"</span>, line <span class="number">1001</span>, <span class="keyword">in</span> initialize</span><br><span class="line">    super(NotebookApp, self).initialize(argv) File <span class="string">"&lt;string&gt;"</span>, line <span class="number">2</span>, <span class="keyword">in</span> initialize</span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/traitlets/config/application.py"</span>, line <span class="number">75</span>, <span class="keyword">in</span> catch_config_error</span><br><span class="line">    <span class="keyword">return</span> method(app, *args, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/jupyter_core/application.py"</span>, line <span class="number">243</span>, <span class="keyword">in</span> initialize</span><br><span class="line">    self.migrate_config()</span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/jupyter_core/application.py"</span>, line <span class="number">169</span>, <span class="keyword">in</span> migrate_config</span><br><span class="line">    migrate() </span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/jupyter_core/migrate.py"</span>, line <span class="number">232</span>, <span class="keyword">in</span> migrate</span><br><span class="line">    <span class="keyword">if</span> migrate_static_custom(custom_src, custom_dst): </span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/jupyter_core/migrate.py"</span>, line <span class="number">160</span>, <span class="keyword">in</span> migrate_static_custom</span><br><span class="line">    <span class="keyword">if</span> custom_css_empty:</span><br><span class="line">UnboundLocalError: local variable <span class="string">'custom_css_empty'</span> referenced before assignment</span><br></pre></td></tr></table></figure></p>
<p>ä¸€çœ‹æœ‰ cssï¼Œç›´è§‰å‘Šè¯‰æˆ‘ï¼Œå¯èƒ½æ˜¯ Jinjia2 ä¹‹ç±»å…³äºç½‘é¡µå¤„ç†çš„æ¨¡å—å‡ºé”™äº†ï¼Œäºæ˜¯å¸è½½å†é‡è£…ï¼Œè¿˜æ˜¯æœ‰æ­¤é”™è¯¯ã€‚pip è¯•äº†å‡ éä¸è¡Œï¼Œapt-get è¯•äº†å‡ éä¹Ÿä¸è¡Œã€‚è°·æ­Œæ¥è°·æ­Œå»éƒ½æ‰¾ä¸åˆ°ç­”æ¡ˆï¼Œé¡¹ç›®çš„ issus ä¹Ÿç¿»äº†ä¸€éï¼ŒåŒæ ·æ²¡ç»“æœï¼Œå‰å‰ååèŠ±äº†ä¸€ä¸ªå¤šå°æ—¶ï¼ŒæŒºæ²®ä¸§çš„ã€‚</p>
<h1 id="BUG_fix">BUG fix</h1><p>è¿é‡è£…å¤§æ³•éƒ½ä¸è¡Œï¼Œè¿™è¯¥ä¸ä¼šæ˜¯ BUG å§ï¼Ÿç»†ç»†çœ‹äº†ä¸€è¾¹ tracebackï¼Œå†é…åˆæºç ä¸€çœ‹ï¼Œç«‹åˆ»å°±çŸ¥é“å“ªé‡Œå¯èƒ½å‡ºé”™äº†ã€‚<br>åŸæ¥ Jupyter åœ¨ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ä¼šæ£€æµ‹ä¹‹å‰æ˜¯å¦ç”¨è¿‡ IPythonï¼Œå¦‚æœç”¨è¿‡ï¼Œé‚£å°±æŠŠæ—§çš„é…ç½®è½¬æ¢æˆæ–°çš„ã€‚æŠŠæ—§ç‰ˆ IPython é…ç½®æ–‡ä»¶å¤¹åˆ äº†ä¹‹åï¼Œå†è¿è¡Œ<code>jupyter notebook</code>ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚é¡ºæ‰‹ä¿®äº†è¿™ä¸ª BUGã€‚</p>
<h1 id="Create_a_Pull_Request">Create a Pull Request</h1><p>æ—¢ç„¶ä¿®äº† BUGï¼Œé‚£è‚¯å®šè¦å‘é¡¹ç›®å¼€å‘è€…åé¦ˆå•Šï¼Œè¦ä¸ºå¼€æºä¸–ç•Œåšè´¡çŒ®ï¼ Github ä¸»é¡µä¹Ÿèƒ½å¥½çœ‹ç‚¹ã€‚ (Î„â—à¸´à±ªâ—Ÿà¸´â€µ)<br>è¿‡ç¨‹ä¹Ÿå¾ˆç®€å•ï¼š</p>
<ol>
<li>åˆ›å»ºè¯¥ BUG çš„ issusï¼ˆå¯é€‰ï¼Œå»ºè®®åˆ›å»ºï¼‰</li>
<li>fork <a href="https://github.com/jupyter/jupyter_core" target="_blank" rel="external">jupyter-core</a></li>
<li>clone è‡ªå·±çš„é¡¹ç›®åˆ°æœ¬åœ°</li>
<li>ä¿®è¡¥ BUG</li>
<li>git push origin</li>
<li>ç‚¹å‡»é¡¹ç›®å³ä¾§çš„ pull request ï¼Œåˆ›å»º pull request</li>
</ol>
<p>è¿™æˆäº†æˆ‘çš„ç¬¬ä¸€ä¸ª Pull Requestã€‚ç°åœ¨ jupyter-core æœ€æ–°çš„ç‰ˆæœ¬æ˜¯ 4.0.6ï¼Œ æ„Ÿè§‰è¿™å°±æ˜¯ä¸ºæˆ‘å‘å¸ƒçš„ã€‚æˆ‘ä¹Ÿæˆäº† jupyter æ ¸å¿ƒæ¨¡å—çš„è´¡çŒ®è€…ï¼Œå‘µå‘µã€‚</p>
<h1 id="Ref-">Ref.</h1><blockquote>
<p><a href="https://ipython.org/" target="_blank" rel="external">https://ipython.org/</a><br><a href="https://jupyter.org/index.html" target="_blank" rel="external">https://jupyter.org/index.html</a><br><a href="https://jupyter.readthedocs.org/en/latest/install.html" target="_blank" rel="external">https://jupyter.readthedocs.org/en/latest/install.html</a><br><a href="https://yangsu.github.io/pull-request-tutorial/" target="_blank" rel="external">Pull Request Tutorial - A Visual Guide to Pull Requests</a></p>
</blockquote>
<p>ä¸ªäººç¬”è®°ï¼Œéš¾å…æœ‰è¯¯ï¼Œå¦‚æœ‰å‘ç°ï¼Œè¿˜æœ›æŒ‡å‡ºã€‚<br>END.</p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="Jupyter_ä¸_IPython">Jupyter ä¸ IPython</h1><p>Jupyter æ˜¯ç”± IPython æ¼”åŒ–è€Œæ¥çš„ï¼Œä¸¤è€…é…åˆä½¿ç”¨å¯æä¾›äº¤äº’å¼çš„ç¼–ç¨‹ä½“éªŒï¼Œå®ç°è§†è§‰åŒ–ç¼–ç¨‹ï¼Œå†™äº†ä»€ä¹ˆï¼Œé©¬ä¸Šå°±èƒ½çœ‹è§æ•ˆæœã€‚Jupyter ç±»ä¼¼äºå®¢æˆ·ç«¯ï¼ŒIPython ä½œä¸º Jupyter çš„å†…æ ¸ã€‚ä¹‹å‰ IPython çš„æ€æ‰‹é” notebook ç°åœ¨è½¬ç§»åˆ° Jupyter ä¸­äº†ã€‚è¯¥ç¥å™¨ä¸ä»…å¯¹ data science æœ‰å¥‡æ•ˆï¼Œå¯¹äºä¸€èˆ¬çš„ python åº”ç”¨å¼€å‘ä¹Ÿæœ‰æå¤§çš„å¸®åŠ©ï¼Œå®ƒåŒæ ·é€‚åˆç”¨äºå­¦ä¹  pythonï¼Œå…¶æ˜“ç”¨æ€§ç›´è¿½ PyCharmã€‚</p>
<h1 id="BUGï¼Ÿ">BUGï¼Ÿ</h1><p>IPython ä»Šå¹´åˆçš„æ—¶å€™å°±æœ‰æ‰€æ¥è§¦ï¼Œä¸è¿‡ç”¨äº†å‡ å¤©å°±å¸è½½äº†ï¼Œé‚£æ—¶ç”¨çš„è¿˜æ˜¯ IPython notebookã€‚æ˜¨å¤©ç”±äºè¯¾ç¨‹éœ€è¦ï¼Œæƒ³åœ¨æœ¬åœ°å®‰è£… IPythonã€‚ä¹ æƒ¯æ€§åœ° GOOGLEï¼Œ æ‰“å¼€ IPython çš„å®˜ç½‘ï¼ŒæŸ¥çœ‹å®‰è£…æ•™ç¨‹ <a href="https://jupyter.readthedocs.org/en/latest/install.html">Installation</a> ï¼Œæ²¡æƒ³åˆ°å±…ç„¶è·³è½¬åˆ°äº† Jupyter çš„æ–‡æ¡£ï¼Œå½“æ—¶å°±å¤§åƒä¸€æ–¤ï¼Œå†ä»”ç»†ä¸€çœ‹ï¼Œå°¼ç›è¿ IPython å®˜ç½‘çš„åå­—éƒ½å˜äº†ã€‚</p>
<blockquote>
<p><a href="https://ipython.org/">Jupyter and the future of IPython - IPython</a></p>
</blockquote>
<p>ä¸€ç›´ä»¥æ¥å°±çŸ¥é“ python çš„ä¸–ç•Œå˜åŒ–å¿«ï¼Œå¯æ²¡æƒ³åˆ°å±…ç„¶è¿™ä¹ˆå¿«ï¼Œæ²¡å‡ ä¸ªæœˆï¼Œé¡¹ç›®çš„åç§°éƒ½å˜äº†ã€‚ âˆ‘(ï¿£â–¡ï¿£;)<br>]]>
    
    </summary>
    
      <category term="git" scheme="http://neilsh.me/tags/git/"/>
    
      <category term="python" scheme="http://neilsh.me/tags/python/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Few words about 6.828]]></title>
    <link href="http://neilsh.me/2015/08/30/few_words_about_6_828/"/>
    <id>http://neilsh.me/2015/08/30/few_words_about_6_828/</id>
    <published>2015-08-30T14:14:00.000Z</published>
    <updated>2015-11-13T02:51:04.000Z</updated>
    <content type="html"><![CDATA[<p>Recently Iâ€™ve been working on JOS, which is part of <a href="http://pdos.csail.mit.edu/6.828/2014/index.html" target="_blank" rel="external">6.828: Operating System Engineering</a>. 6.828 is a great course about OS, it brings principle to practice, you will implement a simple OS in this course. It also talks about the most fancy research of OS. I recommend every CS sutdent to take this course.</p>
<a id="more"></a>
<h2 id="6-828ç®€ä»‹">6.828ç®€ä»‹</h2><p>å¥½äº†ï¼Œè£…é€¼å®Œæ¯•ã€‚æˆ‘è®¤çœŸè¯´è¯´æœ€è¿‘ä¸Šçš„è¿™é—¨è¯¾ï¼Œ6.828æ˜¯ MIT å¼€æ”¾è¯¾ç¨‹ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¼€æ”¾äº†æ‰€æœ‰å…³äºè¯¥è¯¾ç¨‹çš„èµ„æ–™ï¼ŒåŒ…æ‹¬ä¸Šè¯¾è§†é¢‘ã€‚æˆ‘ä¸ªäººè®¤ä¸ºè¿™æ˜¯ä¸€é—¨æå¥½çš„å…³äºæ“ä½œç³»ç»Ÿè¯¾ç¨‹ï¼Œç»å…¸ä¹¦ç±ä¸Šçš„çŸ¥è¯†åœ¨è¿™å°†ä¸å†æ¯ç‡¥ï¼Œå®ƒæ˜¯ä¸€é—¨æ“ä½œç³»ç»Ÿè¯¾ç¨‹ï¼ŒåŒæ—¶ä¹Ÿå¹¿æ³›åœ°æ¶‰åŠäº†CSä¸­çš„å…¶ä»–å†…å®¹ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºç½‘ç»œï¼Œå®‰å…¨ï¼Œåˆ†å¸ƒå¼è®¡ç®—ç­‰ç­‰ã€‚</p>
<h2 id="çŸ¥æ–°">çŸ¥æ–°</h2><h3 id="å¯»æ‰¾èµ„æ–™çš„æ­£ç¡®å§¿åŠ¿">å¯»æ‰¾èµ„æ–™çš„æ­£ç¡®å§¿åŠ¿</h3><p>è¯¾ç¨‹å®éªŒä¸­æœ‰è®¸å¤šåœ°æ–¹å¹¶æ²¡æœ‰è¯´å¾—å¾ˆä»”ç»†ï¼Œåªæœ‰å¤§æ¦‚çš„æ„å›¾ï¼Œå®ç°çš„ç»†èŠ‚éœ€è¦ä½ è‡ªå·±å»æŸ¥é˜…èµ„æ–™ã€‚æ¯”å¦‚è¯´æ±‡ç¼–é‡Œé¢çš„ <code>call</code> <code>ret</code> å¯¹ <code>ESP``EBP``EIP</code>ä¸‰ä¸ªå¯„å­˜å™¨çš„å½±å“ï¼Œå®ƒæŒ‡å‡ºäº†è¿™ä¸¤ä¸ªæŒ‡ä»¤äºå‡½æ•°è°ƒç”¨ä¸Šã€ä¼ é€’å‚æ•°æœ‰å…³ï¼Œç„¶åå®ƒè®©ä½ å†™ä¸€ä¸ªæ ˆå›æº¯å‡½æ•°ã€‚<br>Google <code>ret call</code> çš„ç¬¬ä¸€ä¸ªç»“æœï¼š<a href="http://www.c-jump.com/CIS77/ASM/Procedures/P77_0010_call_ret.htm" target="_blank" rel="external">CALL and RET Instructions</a></p>
<blockquote>
<p>CALL pushes the return address onto the stack and transfers control to a procedure.<br>RET pops the return address off the stack and returns control to that location.</p>
</blockquote>
<p>å—¯ï¼Œå¾ˆå¥½ï¼ŒæŠŠ <code>call</code> å’Œ <code>ret</code> æ‰€å¹²çš„äº‹è¯´äº†ä¸€ä¸‹ï¼Œä½†æ˜¯å¤ªæ¨¡ç³Šäº†ï¼Œæ¯”å¦‚è¯´ return address æŒ‡å‘å“ªé‡Œï¼Œæ€æ ·æ¥ transfers control ï¼Œ pops the return address åˆ°å“ªé‡Œï¼Ÿè¿™äº›éƒ½æ²¡æœ‰è¯´æ¸…æ¥šã€‚å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œè¿™ä¸ªç»“æœåªèƒ½åšå‚è€ƒï¼Œå¹¶ä¸èƒ½ç›´æ¥æ‹¿æ¥ç”¨ã€‚<br>åæ¥ç»è¿‡ä¸€ç•ªæŸ¥æ‰¾åæ‰¾åˆ°äº†å›¾æ–‡å¹¶èŒ‚çš„èµ„æ–™ã€‚<a href="http://unixwiz.net/techtips/win32-callconv-asm.html" target="_blank" rel="external">Intel x86 Function-call Conventions - Assembly View</a> å…¶ä¸­ Calling a __cdecl function é‚£ä¸€èŠ‚è®²å¾—å¾ˆæ¸…æ¥š:<br><img src="http://ww1.sinaimg.cn/large/7f793092gw1evo1wpue9bg20770cm3yd.gif" alt=""></p>
<blockquote>
<p>16(%ebp)    - third function parameter<br>12(%ebp)    - second function parameter<br>8(%ebp)    - first function parameter</p>
</blockquote>
<p>ä¸€å›¾èƒœåƒè¨€ï¼Œå‡½æ•°è°ƒç”¨ï¼Œå‚æ•°ä¼ é€’ï¼Œ<code>ESP``EBP``EIP</code>éƒ½ç»™è¯´æ˜ç™½äº†ã€‚å¯¹æ¯”ä¸€ä¸‹å‰é¢å¼•ç”¨çš„èµ„æ–™ï¼Œå®Œå…¨ç¬¦åˆã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥ç†è§£ï¼Œä¸ºä»€ä¹ˆæ ˆè¦ä»é«˜å‘ä½ç”Ÿé•¿ï¼ŒC è¯­è¨€ä¸­å‚æ•°ä¸ºä»€ä¹ˆä»å³å‘å·¦å‹å…¥æ ˆï¼Œå‡½æ•°å†…çš„æœ¬åœ°å˜é‡å ç”¨çš„å†…å­˜ä¸ºä»€ä¹ˆä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†ï¼Œè¿™ä¸€åˆ‡éƒ½æ˜¯ç´§å¯†ç›¸å…³çš„ã€‚</p>
<h3 id="C_çš„é»‘é­”æ³•">C çš„é»‘é­”æ³•</h3><p>C è¯­è¨€ä½œä¸ºå…¥é—¨è¯¾åœ¨å¤§ä¸€ä¸Šå­¦æœŸæ—¶å°±å­¦äº†ï¼Œæ•™ææ˜¯è°­æµ©å¼ºçš„ï¼Œä»–çš„ä¹¦åœ¨ç½‘ä¸Šè¢«å–·çš„ç‹—è¡€æ·‹å¤´ï¼Œæˆ‘ä¹Ÿè§‰å¾—è¿™ä¸æ˜¯æœ¬å¥½æ•™æï¼Œå€Ÿäº†æœ¬ B&amp;D çš„ ã€ŠThe C Programming Languageã€‹ï¼Œå›«å›µåæ£åœ°çœ‹äº†ä¸€éï¼ŒæŒ‡é’ˆã€ç»“æ„ä½“ã€è”åˆä½“ã€æšä¸¾ç­‰æ¦‚å¿µå€’èƒŒå¦‚æµï¼ŒæœŸæœ«çš„æ—¶å€™æ‹¿äº†é«˜åˆ†ï¼Œè‡ªä»¥ä¸º C å­¦å¾—è¿˜ä¸é”™ã€‚ç°åœ¨æƒ³æ¥ï¼Œé‚£æ—¶è¿˜æ˜¯å¤ªå¹´è½»ï¼Œæ“ä½œç³»ç»Ÿé‡Œæ¼«å¤©çš„æŒ‡é’ˆï¼Œç»“æ„ä½“ã€è”åˆä½“äº’ç›¸çš„åµŒå¥—æ›´æ˜¯å°‘ä¸äº†ï¼Œå„ç§ç¥å¥‡çš„å†™æ³•è§éƒ½æ²¡è§è¿‡ã€‚ä¸‹é¢æ¥å‡ ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<h4 id="ç»™ç»“æ„ä½“åˆå§‹åŒ–æ—¶ç»™æŒ‡å®šæˆå‘˜èµ‹å€¼ï¼š">ç»™ç»“æ„ä½“åˆå§‹åŒ–æ—¶ç»™æŒ‡å®šæˆå‘˜èµ‹å€¼ï¼š</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> foo &#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">unsigned</span> u;</span><br><span class="line">    <span class="keyword">char</span> *str;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bar</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *s = <span class="string">"Hello!"</span>;</span><br><span class="line">    <span class="keyword">struct</span> foo f = &#123;</span><br><span class="line">        .str = s;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="è·¨æºæ–‡ä»¶è°ƒç”¨åŒ¿åç»“æ„ä½“å˜é‡ï¼š">è·¨æºæ–‡ä»¶è°ƒç”¨åŒ¿åç»“æ„ä½“å˜é‡ï¼š</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰åœ¨ a.c ä¸­</span></span><br><span class="line"><span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">unsigned</span> us[<span class="number">99</span>];</span><br><span class="line">&#125; foo;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ b.c ä¸­</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">unsigned</span> us[<span class="number">99</span>];</span><br><span class="line">&#125; foo;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bar</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, foo.i);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å…³é”®å­—_volatile">å…³é”®å­— volatile</h4><blockquote>
<p>the volatile keyword indicates that a value may change between different accesses, even if it does not appear to be modified. This keyword prevents an optimizing compiler from optimizing away subsequent reads or writes and thus incorrectly reusing a stale value or omitting writes.    â€” <a href="https://en.wikipedia.org/wiki/Volatile_(computer_programming" target="_blank" rel="external">Wikipedia</a>)</p>
</blockquote>
<p>å¼•ç”¨æŒ‡å‡º volatile æ˜¯ä¸ºäº†é˜²æ­¢ç¼–è¯‘â€œä¼˜åŒ–â€å¯¹è¯¥å˜é‡çš„ä¸€ç³»åˆ—è¯»å†™æ“ä½œã€‚ä¸Šé¢æŠ›å‡ºä¸€å¤§æ®µç»“è®ºï¼Œè¿˜æ˜¯æŒºä»¤äººç–‘æƒ‘çš„ã€‚ä»€ä¹ˆå« may change between different accessesï¼Œ ä»€ä¹ˆå« optimizing away subsequent reads or writesï¼Ÿè¿™ä¸€åˆ‡ç”¨â€œåº•å±‚â€œçš„æ±‡ç¼–æ¥è§£é‡Šåè€Œå®¹æ˜“ã€‚<br><a href="/asset/code/v_int.c">å¸¦æœ‰ volatile</a><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// volatile_int.c</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="keyword">int</span> foo;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ€»è®¡4æ¬¡å¯¹ foo çš„æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    foo = <span class="number">0xff</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, foo);</span><br><span class="line">    foo = <span class="number">0xff</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, foo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¯‘</span></span><br><span class="line">$ gcc -O1 volatile_int.c -o volatile_int</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ±‡ç¼–</span></span><br><span class="line">$ objdump -S volatile_int &gt; v.asm</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">000000000040055d &#60;main&#62;:&#10;  40055d:&#9;48 83 ec 08          &#9;sub    $0x8,%rsp&#10;  400561:&#9;c7 05 d9 0a 20 00 ff &#9;movl   $0xff,0x200ad9(%rip)        # 601044 &#60;foo&#62;&#10;  400568:&#9;00 00 00 &#10;  40056b:&#9;8b 15 d3 0a 20 00    &#9;mov    0x200ad3(%rip),%edx        # 601044 &#60;foo&#62;&#10;  400571:&#9;be 34 06 40 00       &#9;mov    $0x400634,%esi&#10;  400576:&#9;bf 01 00 00 00       &#9;mov    $0x1,%edi&#10;  40057b:&#9;b8 00 00 00 00       &#9;mov    $0x0,%eax&#10;  400580:&#9;e8 db fe ff ff       &#9;callq  400460 &#60;__printf_chk@plt&#62;&#10;  400585:&#9;c7 05 b5 0a 20 00 ff &#9;movl   $0xff,0x200ab5(%rip)        # 601044 &#60;foo&#62;&#10;  40058c:&#9;00 00 00 &#10;  40058f:&#9;8b 15 af 0a 20 00    &#9;mov    0x200aaf(%rip),%edx        # 601044 &#60;foo&#62;&#10;  400595:&#9;be 34 06 40 00       &#9;mov    $0x400634,%esi&#10;  40059a:&#9;bf 01 00 00 00       &#9;mov    $0x1,%edi&#10;  40059f:&#9;b8 00 00 00 00       &#9;mov    $0x0,%eax&#10;  4005a4:&#9;e8 b7 fe ff ff       &#9;callq  400460 &#60;__printf_chk@plt&#62;&#10;  4005a9:&#9;48 83 c4 08          &#9;add    $0x8,%rsp&#10;  4005ad:&#9;c3                   &#9;retq   &#10;  4005ae:&#9;66 90                &#9;xchg   %ax,%ax</span><br></pre></td></tr></table></figure>
<p><a href="/asset/code/nv_int.c">ä¸å¸¦ volatile</a><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">000000000040055d &#60;main&#62;:&#10;  40055d:&#9;48 83 ec 08          &#9;sub    $0x8,%rsp&#10;  400561:&#9;c7 05 d9 0a 20 00 ff &#9;movl   $0xff,0x200ad9(%rip)        # 601044 &#60;foo&#62;&#10;  400568:&#9;00 00 00 &#10;  40056b:&#9;ba ff 00 00 00       &#9;mov    $0xff,%edx&#10;  400570:&#9;be 34 06 40 00       &#9;mov    $0x400634,%esi&#10;  400575:&#9;bf 01 00 00 00       &#9;mov    $0x1,%edi&#10;  40057a:&#9;b8 00 00 00 00       &#9;mov    $0x0,%eax&#10;  40057f:&#9;e8 dc fe ff ff       &#9;callq  400460 &#60;__printf_chk@plt&#62;&#10;  400584:&#9;c7 05 b6 0a 20 00 ff &#9;movl   $0xff,0x200ab6(%rip)        # 601044 &#60;foo&#62;&#10;  40058b:&#9;00 00 00 &#10;  40058e:&#9;ba ff 00 00 00       &#9;mov    $0xff,%edx&#10;  400593:&#9;be 34 06 40 00       &#9;mov    $0x400634,%esi&#10;  400598:&#9;bf 01 00 00 00       &#9;mov    $0x1,%edi&#10;  40059d:&#9;b8 00 00 00 00       &#9;mov    $0x0,%eax&#10;  4005a2:&#9;e8 b9 fe ff ff       &#9;callq  400460 &#60;__printf_chk@plt&#62;&#10;  4005a7:&#9;48 83 c4 08          &#9;add    $0x8,%rsp&#10;  4005ab:&#9;c3                   &#9;retq   &#10;  4005ac:&#9;0f 1f 40 00          &#9;nopl   0x0(%rax)</span><br></pre></td></tr></table></figure></p>
<p>å¯¹æ¯”å¯è§ï¼Œå¸¦æœ‰ volatile çš„å¯¹ foo æœ‰å››æ¬¡æ“ä½œï¼Œè€Œä¸å¸¦çš„åªæœ‰ 2 æ¬¡ï¼Œä»è¿™ä¸ªä¾‹å­å¯ä»¥çœ‹å‡ºä¸€äº›ç«¯å€ªï¼Œ volatile ç¡®ä¿äº† C æºç ä¸­æ¯æ¬¡å¯¹ foo çš„æ“ä½œéƒ½æ˜¯ç›´æ¥å¯¹ foo å†…å­˜åœ°å€çš„æ“ä½œã€‚</p>
<h4 id="æŒ‡é’ˆä¸æ•°ç»„">æŒ‡é’ˆä¸æ•°ç»„</h4><p>ç”¨ä¼ªç æ¥ç®€è¿°ä¸€ä¸‹ä¸¤è€…çš„å…³ç³»ã€‚</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">char *pc = <span class="number">0</span>ï¼›</span><br><span class="line">int *<span class="constant">pi</span> = <span class="number">0</span>;</span><br><span class="line">int ai[<span class="number">5</span>] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;;</span><br><span class="line"></span><br><span class="line">(pc += <span class="number">1</span>) == <span class="number">1</span> <span class="keyword">is</span> <span class="constant">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (sizeof(int) == <span class="number">4</span>)</span><br><span class="line">    <span class="keyword">then</span> <span class="constant">pi</span> + <span class="number">1</span> == <span class="number">4</span> <span class="keyword">is</span> <span class="constant">true</span>; ((int *)pc) + <span class="number">1</span> == <span class="number">5</span> <span class="keyword">is</span> <span class="constant">true</span>;</span><br><span class="line"></span><br><span class="line">*ai == <span class="number">0</span> <span class="keyword">is</span> <span class="constant">true</span></span><br><span class="line"></span><br><span class="line"><span class="constant">pi</span> = ai</span><br><span class="line">    <span class="keyword">then</span> *<span class="constant">pi</span> == <span class="number">0</span>, <span class="constant">pi</span>[<span class="number">1</span>] == <span class="number">1</span>, <span class="constant">pi</span>[<span class="number">4</span>] == <span class="number">4</span> are <span class="constant">true</span>;</span><br></pre></td></tr></table></figure>
<p>è‡ªä»å­¦äº†6.828åï¼ŒæŒ‡é’ˆå†ä¹Ÿä¸æ˜¯æ´ªæ°´çŒ›å…½ï¼Œè‡ªä»¥ä¸ºä½™å·²è¾¾æ”¶å‘è‡ªå¦‚çš„å¢ƒç•Œã€‚</p>
<h3 id="æ‚é¡¹">æ‚é¡¹</h3><p>å¯¹å„ç§è®¡ç®—æœºæœ¯è¯­æœ‰äº†æ–°çš„è®¤è¯†ï¼šprocessã€threadã€stubã€trapã€callerã€calleeã€coroutineç­‰ç­‰ã€‚<br>å„ç§å‘½ä»¤ï¼šmanã€gitã€makeã€gccã€objdumpç­‰ç­‰ã€‚ç‰¹åˆ«æ˜¯manï¼Œæˆ‘è¿˜æ˜¯ç¬¬ä¸€æ¬¡çŸ¥é“ï¼Œmanè¿˜èƒ½å½“ç¼–ç¨‹æ‰‹å†Œï¼ŒæŸ¥çœ‹å‡½æ•°çš„ç”¨æ³•ã€‚<br>ç†è®ºä¸å®è·µä¹‹é—´çš„å·®å¼‚ï¼Œå·¥ç¨‹ä¸Šçš„æƒè¡¡äºå¦¥åã€‚</p>
<h2 id="ä¸€äº›èµ„æº">ä¸€äº›èµ„æº</h2><p><a href="http://pdos.csail.mit.edu/6.828/2014/index.html" target="_blank" rel="external">å®˜æ–¹ç½‘ç«™</a><br><a href="https://www.youtube.com/playlist?list=PLfciLKR3SgqNJKKIKUliWoNBBH1VHL3AP" target="_blank" rel="external">è¯¾ç¨‹è§†é¢‘</a><br><a href="https://bitbucket.org/overvenus/jos/" target="_blank" rel="external">æˆ‘çš„ JOS (å·²å®Œæˆlab1ï½6)</a></p>
<p>æœ€åï¼Œå†æ¬¡æ„Ÿè°¢ MIT çš„æ•™å¸ˆèŒå‘˜ä»¬ï¼Œå¹¶ä»¥ä¸€å¼  JOS é“ç…§ç»“å°¾ã€‚</p>
<p><img src="http://ww1.sinaimg.cn/large/7f793092gw1evohw0nih7j20k00bw75r.jpg" alt=""></p>
<p>ä¸ªäººç¬”è®°ï¼Œéš¾å…æœ‰è¯¯ï¼Œå¦‚æœ‰å‘ç°ï¼Œè¿˜æœ›æŒ‡å‡ºã€‚<br>END.</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Recently Iâ€™ve been working on JOS, which is part of <a href="http://pdos.csail.mit.edu/6.828/2014/index.html">6.828: Operating System Engineering</a>. 6.828 is a great course about OS, it brings principle to practice, you will implement a simple OS in this course. It also talks about the most fancy research of OS. I recommend every CS sutdent to take this course.</p>]]>
    
    </summary>
    
      <category term="C.S.ç¬”è®°" scheme="http://neilsh.me/tags/C-S-%E7%AC%94%E8%AE%B0/"/>
    
      <category term="MIT" scheme="http://neilsh.me/tags/MIT/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ç¬¬ä¸€ä»½å®ä¹ ]]></title>
    <link href="http://neilsh.me/2015/08/29/my_frist_internship/"/>
    <id>http://neilsh.me/2015/08/29/my_frist_internship/</id>
    <published>2015-08-29T06:33:00.000Z</published>
    <updated>2015-11-07T04:04:21.000Z</updated>
    <content type="html"><![CDATA[<p>ä¸¤ä¸ªæœˆä¸€æ™ƒè€Œè¿‡ï¼Œæš‘å‡ç»“æŸäº†ï¼Œç¬¬ä¸€ä»½å®ä¹ ä¹Ÿç»“æŸäº†ã€‚</p>
<p>è¿™æ®µæ—¶é—´ï¼Œæˆ‘åœ¨ EasyLinking å®ä¹ ï¼Œå¾—åˆ°äº† FULL TIME çš„å®‰å“å¼€å‘å·¥ä½œç»å†ï¼ŒçœŸçœŸåˆ‡åˆ‡åœ°è®¤è¯†åˆ°<strong>æ–‡æ¡£å’Œæ³¨é‡Š</strong>é‡è¦æ€§ï¼ŒåŒæ—¶è¿˜ç»“è¯†äº†ä¸€å¸®å‰è¾ˆï¼šé‡è§†äººæ‰çš„çºªæ€»ï¼Œå¹³å’Œçš„æ¸¸æ€»ï¼Œè‡ªå­¦æˆæ‰çš„ iOS å¤§ç‰›è€ç‹ï¼Œåå°å¼€å‘å¤§ç‰›è€é‚¹å’Œå°èƒ¡ï¼Œå¼€å‘èµ„å†ç¬¬ä¸€ä¸è€å¸ˆï¼Œå…¨æ ˆçš„åŒ—å¤§é«˜æç”Ÿè¶…å“¥ï¼Œç­‰ç­‰ã€‚</p>
<p>å®ä¹ ä¸­ç»™æˆ‘å°è±¡æœ€æ·±çš„è¿˜æ˜¯å›¢é˜Ÿåä½œã€‚ä¸å¾—ä¸è¯´ï¼Œè¿™ä¸ªæŠ€æœ¯å›¢é˜Ÿæˆå‘˜ä¹‹é—´ååŠ©æ•ˆç‡éå¸¸é«˜ï¼Œä¸€ä¸ªé—®é¢˜å‘ç°ä¹‹åï¼Œé©¬ä¸Šå°±èƒ½å¾—åˆ°åé¦ˆï¼Œæˆ‘æƒ³è¿™åº”è¯¥å¾—åˆ©äºæ‰å¹³åŒ–çš„ç®¡ç†æ¨¡å¼ã€‚</p>
<p>æ—¢ç„¶æˆ‘å®ä¹ çš„æ˜¯å®‰å“å¼€å‘ï¼Œé‚£å°±è¯´ä¸€ä¸‹å…³äºå®‰å“çš„äº‹å§ã€‚å¹¿æ’­æ˜¯ä¸€ä¸ªå®‰å“åº”ç”¨çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¹‹å‰æ²¡æœ‰å¼€å‘è¿‡ä¸šåŠ¡é€»è¾‘å¤æ‚çš„åº”ç”¨ï¼Œå¯¹æœ¬åœ°å¹¿æ’­çš„ç†è§£ä¹Ÿå°±åœç•™åœ¨ <a href="https://developer.android.com/reference/android/support/v4/content/LocalBroadcastManager.html" target="_blank" rel="external">æ–‡æ¡£</a> ä¸Šé¢ï¼Œç»è¿‡è¿™æ¬¡å®ä¹ ï¼Œæˆ‘å·²ç» understand from practice ï¼Œå®ƒå¾ˆå¼ºå¤§ï¼Œä¹Ÿå¾ˆå±é™©ï¼Œä¸æ„§è¢«ç§°ä¸ºå®‰å“ä¸­çš„ <code>goto</code>(æ³ªç›®ï¼Œæ‰è¿‡å‘)ã€‚å¯¹å®‰å“çš„è§¦å±äº‹ä»¶ä¹Ÿæœ‰äº†<a href="/2015/08/13/dispatch_and_handle_motionevent_in_android/">è¿›ä¸€æ­¥çš„è®¤è¯†</a>ã€‚æˆ‘è¿˜æˆåŠŸåœ°åŠæœäº†å®‰å“å¼€å‘ç»„ï¼ŒæŠŠ IDE ä» Eclipse è¿ç§»åˆ° AndroidStudioã€‚:-)</p>
<p>åœ¨å·¥ä½œä¹‹ä½™ï¼Œæˆ‘å®ç°äº†ä¸€ä¸ªå°å‹çš„æ“ä½œç³»ç»Ÿ <a href="https://bitbucket.org/overvenus/jos/" target="_blank" rel="external">JOS</a>ã€‚ç”±äºç™½å¤©æ²¡æœ‰ç©ºï¼ŒJOS çš„ä»£ç å¤§éƒ¨åˆ†æ˜¯åœ¨æ™šä¸Šå†™çš„ï¼Œæ¯å¤©éƒ½å†™åˆ°å‡Œæ™¨ï¼Œå¯¼è‡´ Work-life balance å¾ˆç³Ÿç³•ï¼Œè„¸ä¸Šå†’å‡ºäº†ä¸€äº›ç—˜ç—˜ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰æ„ä¹‰çš„æš‘å‡ã€‚</p>
<p>END.</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>ä¸¤ä¸ªæœˆä¸€æ™ƒè€Œè¿‡ï¼Œæš‘å‡ç»“æŸäº†ï¼Œç¬¬ä¸€ä»½å®ä¹ ä¹Ÿç»“æŸäº†ã€‚</p>
<p>è¿™æ®µæ—¶é—´ï¼Œæˆ‘åœ¨ EasyLinking å®ä¹ ï¼Œå¾—åˆ°äº† FULL TIME çš„å®‰å“å¼€å‘å·¥ä½œç»å†ï¼ŒçœŸçœŸåˆ‡åˆ‡åœ°è®¤è¯†åˆ°<strong>æ–‡æ¡£å’Œæ³¨é‡Š</strong>é‡è¦æ€§ï¼ŒåŒæ—¶è¿˜ç»“è¯†äº†ä¸€å¸®å‰è¾ˆï¼šé‡è§†äººæ‰çš„çºªæ€»ï¼Œå¹³å’Œçš„æ¸¸æ€»]]>
    </summary>
    
      <category term="Career" scheme="http://neilsh.me/tags/Career/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Androidè§¦å±äº‹ä»¶å¤„ç†åˆ†å‘--ä»¥SwipeRefreshLayoutä¸ºä¾‹]]></title>
    <link href="http://neilsh.me/2015/08/13/dispatch_and_handle_motionevent_in_android/"/>
    <id>http://neilsh.me/2015/08/13/dispatch_and_handle_motionevent_in_android/</id>
    <published>2015-08-13T06:33:00.000Z</published>
    <updated>2015-11-07T04:04:21.000Z</updated>
    <content type="html"><![CDATA[<h2 id="PullToRefresh_ä¸_SwipeRefreshLayout">PullToRefresh ä¸ SwipeRefreshLayout</h2><p>è¿™æ®µæ—¶é—´æˆ‘åœ¨ Easyinking å…¬å¸å®ä¹ ï¼Œ åšå®‰å“å¼€å‘ã€‚ä¹‹å‰çš„ App ä¸­å¤§é‡ä½¿ç”¨ <a href="https://github.com/chrisbanes/Android-PullToRefreshhttps://github.com/chrisbanes/Android-PullToRefresh" target="_blank" rel="external">Android-PullToRefresh</a>ã€‚è¿™ä¸ªè½®å­å¾ˆç»å…¸ï¼Œåœ¨è¾ƒä¹…ç‰ˆæœ¬çš„å®‰å“ä¸Šé¢ä¹Ÿå¾ˆå¥½ä½¿ï¼Œä¸è¿‡ä½œè€…å·²ç»æ”¾å¼ƒç»´æŠ¤äº†ï¼Œåœ¨æˆ‘ä»¬çš„ App ä¸Šä¹Ÿå‘ç°äº†ä¸€ä¸ªè¯¡å¼‚çš„BUGï¼šä¸WebViewé…åˆä½¿ç”¨æ—¶ï¼Œåœ¨ç½‘ç»œç¯å¢ƒå·®çš„æƒ…å†µä¸‹ä¼šå‡ºç°ä¸€æ¬¡ä¸‹æ‹‰å¤šæ¬¡åˆ·æ–°çš„æƒ…å†µï¼Œç—‡çŠ¶å°±æ˜¯æ•´ä¸ªç½‘é¡µåœ¨é‚£ä¸Šä¸‹æŠ½æã€‚åœ¨å®˜æ–¹æ”¯æŒåº“ support-v4:22 ä¸­è‡ªå¸¦äº†ä¸€ä¸ªç±»ä¼¼çš„ SwipeRefreshLayoutï¼Œæ•ˆæœä¹Ÿæ˜¯ä¸€çº§æ£’ã€‚ç”±äºä¸¤è€…çš„ API è®¾è®¡å·®ä¸å¤šï¼Œä½¿ç”¨çš„æƒ…æ™¯ä¹Ÿå‡ ä¹ä¸€æ ·ï¼Œæ‰€ä»¥å¯ä»¥æ— ç—›åœ°ä» <a href="https://github.com/chrisbanes/Android-PullToRefreshhttps://github.com/chrisbanes/Android-PullToRefresh" target="_blank" rel="external">PullToRefresh</a> è½¬ç§»è¿‡æ¥ã€‚</p>
<h2 id="æ•æ„Ÿçš„_SwipeRefreshLayout">æ•æ„Ÿçš„ SwipeRefreshLayout</h2><p>ä» PullToRefresh è½¬ç§»åˆ° SwipeRefreshLayout å¤§æ¦‚èŠ±äº†åæ¥åˆ†é’Ÿï¼Œåˆæ­¥æµ‹è¯•å‡ºæ¥çš„æ•ˆæœä¹Ÿä»¤äººæ»¡æ„ã€‚ä½†æ˜¯ï¼Œå®é™…ä½¿ç”¨ä¸­æ€»ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚æˆ‘ä»¬æŠŠä¸€ä¸ªWebViewæ”¾åœ¨äº† SwipeRefreshLayout ä¸­ï¼Œ è¯¥ WebView å‘ˆç°çš„ç½‘é¡µä¸­æœ‰ä¸€ä¸ªå›¾ç‰‡è½®æ’­ï¼Œå¯å·¦å³æ»‘åŠ¨ï¼Œä¸‹é¢çš„é—®é¢˜æ˜¯ SwipeRefreshLayout è¿‡äºæ•æ„Ÿï¼Œå®ƒæŠŠç¨æœ‰ä¸‹æ‹‰å€¾å‘çš„å·¦å³æ»‘åŠ¨å…¨éƒ¨æ‹¦æˆªæ‰ï¼Œå¹¶æŠŠä»–ä»¬å½“ä½œä¸‹æ‹‰çš„æ‰‹åŠ¿ï¼Œå…¸å‹çš„ False Positive ï¼Œ å¤„ç†çš„æ€è·¯ä¹Ÿå¾ˆç®€å•ï¼Œæ—¢ç„¶æ˜¯è¯¯æŠ¥ï¼Œè¿‡æ»¤ä¹‹å³å¯ã€‚</p>
<h3 id="è¯¯æŠ¥çš„æ‰‹åŠ¿"><strong>è¯¯æŠ¥çš„æ‰‹åŠ¿</strong></h3><p><img src="http://ww1.sinaimg.cn/bmiddle/7f793092gw1ev1xydoiwoj20u01hcwoe.jpg" alt=""><img src="http://ww3.sinaimg.cn/bmiddle/7f793092gw1ev1ys28bm4j20u01hc12q.jpg" alt=""></p>
<h3 id="ç†æƒ³ä¸­çš„æ‰‹åŠ¿"><strong>ç†æƒ³ä¸­çš„æ‰‹åŠ¿</strong></h3><p><img src="http://ww1.sinaimg.cn/bmiddle/7f793092gw1ev1ytgovwpj20u01hcgve.jpg" alt=""></p>
<a id="more"></a>
<h2 id="SwipeRefreshLayout_åˆ·æ–°çš„ç»†èŠ‚">SwipeRefreshLayout åˆ·æ–°çš„ç»†èŠ‚</h2><p>SwipeRefreshLayout æœ‰ä¸ªè‡ªå®šä¹‰æ¥å£ SwipeRefreshLayout.OnRefreshListenerï¼Œé‡Œé¢çš„å‡½æ•°<code>onRefresh()</code>ä¼šåœ¨ä¸‹æ‹‰åˆ·æ–°æ—¶æ‰§è¡Œã€‚SwipeRefreshLayout æŠŠ OnRefreshListener åŒ…è£…è¿›äº†<code>AnimationListener mRefreshListener</code>ï¼Œå¹¶ä¸”<code>onRefresh()</code>æ–¹æ³•åªä¼šåœ¨<code>onAnimationEnd()</code>ä¸­æ‰§è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Animation.AnimationListener mRefreshListener = <span class="keyword">new</span> Animation.AnimationListener() &#123;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animation animation)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animation animation)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animation animation)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mRefreshing) &#123;</span><br><span class="line">            <span class="comment">// Make sure the progress view is fully visible</span></span><br><span class="line">            mProgress.setAlpha(MAX_ALPHA);</span><br><span class="line">            mProgress.start();</span><br><span class="line">            <span class="keyword">if</span> (mNotify) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    mListener.onRefresh();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            mProgress.stop();</span><br><span class="line">            mCircleView.setVisibility(View.GONE);</span><br><span class="line">            setColorViewAlpha(MAX_ALPHA);</span><br><span class="line">            <span class="comment">// Return the circle to its start position</span></span><br><span class="line">            <span class="keyword">if</span> (mScale) &#123;</span><br><span class="line">                setAnimationProgress(<span class="number">0</span> <span class="comment">/* animation complete and view is hidden */</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                setTargetOffsetTopAndBottom(mOriginalOffsetTop - mCurrentTargetOffsetTop,</span><br><span class="line">                        <span class="keyword">true</span> <span class="comment">/* requires update */</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mCurrentTargetOffsetTop = mCircleView.getTop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// åˆ›å»ºåˆ·æ–°æŒ‡ç¤ºå›¾æ ‡    </span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createProgressView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mCircleView = <span class="keyword">new</span> CircleImageView(getContext(), CIRCLE_BG_LIGHT, CIRCLE_DIAMETER/<span class="number">2</span>);</span><br><span class="line">    mProgress = <span class="keyword">new</span> MaterialProgressDrawable(getContext(), <span class="keyword">this</span>);</span><br><span class="line">    mProgress.setBackgroundColor(CIRCLE_BG_LIGHT);</span><br><span class="line">    mCircleView.setImageDrawable(mProgress);</span><br><span class="line">    mCircleView.setVisibility(View.GONE);</span><br><span class="line">    addView(mCircleView);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ª listener æ³¨å†Œåœ¨<code>mCircleView</code>ï¼Œè´Ÿè´£äº†<strong>ä¸¤ä¸ªåŠ¨ç”»</strong>ï¼Œä¸€ä¸ªæ˜¯ä¸‹æ‹‰å›å¼¹çš„åŠ¨ç”»ï¼Œå¦ä¸€ä¸ªæ˜¯åˆ·æ–°è½¬åœˆçš„åŠ¨ç”»ã€‚ä¸‹æ‹‰å›å¼¹åŠ¨ç”»çš„å®Œæˆï¼Œä»£è¡¨è§¦å‘äº†åˆ·æ–°ï¼Œæ¥ä¸‹æ¥å°±æ‰§è¡Œ<code>onRefresh()</code>ã€‚åˆ·æ–°è½¬åœˆçš„åŠ¨ç”»å®Œæˆæ—¶ï¼Œä»£è¡¨äº†<code>onRefresh()</code>çš„å®Œæˆï¼Œä¹‹åå°±è®©åˆ·æ–°å›¾æ ‡æ¶ˆå¤±ã€‚</p>
<p>ä¸‹æ‹‰å›å¼¹çš„åŠ¨ç”»æ˜¯ç”±<code>animateOffsetToCorrectPosition()</code>å¼€å§‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åˆ·æ–°ä¹Ÿæ˜¯ç”±è¿™ä¸ªæ–¹æ³•è§¦å‘çš„ã€‚ç»è¿‡ç®€å•åˆ†æåä¸éš¾å‘ç°è§¦å‘åˆ·æ–°çš„æ˜¯<code>onTouchEvent()</code>æ–¹æ³•ã€‚</p>
<h2 id="onInterceptTouchEvent()_V-S-_onTouchEvent()">onInterceptTouchEvent() V.S. onTouchEvent()</h2><p>åœ¨å®‰å“è§¦å±äº‹ä»¶åˆ†å‘å¤„ç†è¿‡ç¨‹ä¸­è¿™ä¸¤ä¸ªæ˜¯å…³é”®æ–¹æ³•ã€‚åœ¨è¦†å†™è¿™ä¸¤ä¸ªæ–¹æ³•æ—¶éœ€è¦éµå®ˆä¸€å®šçš„è§„åˆ™ï¼Œå¦åˆ™ä¼šæœ‰å¥‡æ€ªçš„äº‹æƒ…å‘ç”Ÿï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<h3 id="ViewGroup-onInterceptTouchEvent()">ViewGroup.onInterceptTouchEvent()</h3><blockquote>
<p>Implement this method to intercept all touch screen motion events. This allows you to watch events as they are dispatched to your children, and take ownership of the current gesture at any point.</p>
<p>Using this function takes some care, as it has a fairly complicated interaction with View.onTouchEvent(MotionEvent), and using it requires implementing that method as well as this one in the correct way. Events will be received in the following order:</p>
<ul>
<li>You will receive the down event here.</li>
<li>The down event will be handled either by a child of this view group, or given to your own onTouchEvent() method to handle; this means you should implement onTouchEvent() to return true, so you will continue to see the rest of the gesture (instead of looking for a parent view to handle it). Also, by returning true from onTouchEvent(), you will not receive any following events in onInterceptTouchEvent() and all touch processing must happen in onTouchEvent() like normal.</li>
<li>For as long as you return false from this function, each following event (up to and including the final up) will be delivered first here and then to the targetâ€™s onTouchEvent().</li>
<li>If you return true from here, you will not receive any following events: the target view will receive the same event but with the action ACTION_CANCEL, and all further events will be delivered to your onTouchEvent() method and no longer appear here.</li>
</ul>
</blockquote>
<h3 id="View-onTouchEvent()">View.onTouchEvent()</h3><blockquote>
<p>Implement this method to handle touch screen motion events.</p>
<p>If this method is used to detect click actions, it is recommended that the actions be performed by implementing and calling performClick(). This will ensure consistent system behavior, including:</p>
<ul>
<li>obeying click sound preferences</li>
<li>dispatching OnClickListener calls</li>
<li>handling ACTION_CLICK when accessibility features are enabled</li>
</ul>
</blockquote>
<p>ä»æ–‡æ¡£ä¸Šæ¥çœ‹ï¼Œå½“ä¸€ä¸ªè§¦å±äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå®‰å“æ¡†æ¶ä¼šå…ˆæŠŠäº‹ä»¶å‘é€åˆ°<code>ViewGroup.onInterceptTouchEvent()</code>ï¼Œå†æ ¹æ®å…¶è¿”å›çš„ç»“æœæ¥å†³å®šè¯¥äº‹ä»¶è¯¥ä»½é…ç»™è‡ªå·±çš„<code>ViewGroup.onTouchEvent()</code>ï¼Œè¿˜æ˜¯ target view çš„<code>View.onTouchEvent()</code>ã€‚ï¼ˆæ³¨æ„ target view æŒ‡çš„æ˜¯ layout.xml ä¸­åµŒå¥—åœ¨SwipeRefreshLayouté‡Œçš„Viewï¼Œæˆ–æ˜¯å¤„äºSwipeRefreshLayoutä¹‹ä¸‹çš„Viewã€‚ï¼‰é‚£ä¹ˆSwipeRefreshLayoutåœ¨å¤„ç†è§¦å±äº‹ä»¶çš„æµç¨‹ä¹Ÿåº”å¦‚æ­¤ã€‚</p>
<h2 id="SwipeRefreshLayout_å¯¹è§¦å±äº‹ä»¶çš„ååº”">SwipeRefreshLayout å¯¹è§¦å±äº‹ä»¶çš„ååº”</h2><p>åœ¨ä¿®æ”¹SwipeRefreshLayoutå‰ï¼Œå°±ç®—ä¸æ¸…æ¥šå®ƒçš„ä»£ç ï¼Œé‚£è‡³å°‘ä¹Ÿè¦äº†è§£å®ƒå¯¹è§¦å±äº‹ä»¶çš„åé¦ˆã€‚æœ€ç›´è§‚çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œè¦†å†™é‚£ä¸¤ä¸ªæ–¹æ³•ï¼Œç®—æ˜¯æ›²çº¿æ•‘å›½å§ã€‚å…·ä½“çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SSwipeRefreshLayout</span> <span class="keyword">extends</span> <span class="title">SwipeRefreshLayout</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"SSwipe"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SSwipeRefreshLayout</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SSwipeRefreshLayout</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> b = <span class="keyword">super</span>.onTouchEvent(ev);</span><br><span class="line">        Log.d(TAG + <span class="string">"BT"</span>, String.valueOf(b));</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> b = <span class="keyword">super</span>.onInterceptTouchEvent(ev);</span><br><span class="line">        Log.d(TAG + <span class="string">"BI"</span>, String.valueOf(b));</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è§¦å‘åˆ·æ–°">è§¦å‘åˆ·æ–°</h3><h4 id="å‘å·¦ä¸‹æ»‘"><strong>å‘å·¦ä¸‹æ»‘</strong></h4><p><img src="http://ww2.sinaimg.cn/bmiddle/7f793092gw1ev34kpb2ldj20u01hc7an.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">03</span>:<span class="number">52.650</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">03</span>:<span class="number">52.679</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.657</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.790</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.808</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBTï¹• true  &lt;--- onTouchEvent</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.811</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBTï¹• true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.831</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBTï¹• true</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="å‘å³ä¸‹æ»‘"><strong>å‘å³ä¸‹æ»‘</strong></h4><p><img src="http://ww4.sinaimg.cn/bmiddle/7f793092gw1ev34lnjl05j20u01hcn3v.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.546</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.700</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.717</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.726</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.743</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.760</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.777</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.794</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.812</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.829</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBTï¹• true  &lt;--- onTouchEvent</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">25</span>:<span class="number">27.845</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBTï¹• true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.868</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBTï¹• true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">06.893</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBTï¹• true</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="ç¬”ç›´å‘ä¸‹æ»‘"><strong>ç¬”ç›´å‘ä¸‹æ»‘</strong></h4><p><img src="http://ww3.sinaimg.cn/bmiddle/7f793092gw1ev34m7lgjxj20u01hcdmi.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">13.798</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">14.115</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">14.132</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">14.150</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBTï¹• true  &lt;--- onTouchEvent</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">14.166</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBTï¹• true</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">10</span>:<span class="number">29</span>:<span class="number">14.183</span>  <span class="number">10606</span>-<span class="number">10606</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBTï¹• true</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="ä¸è§¦å‘åˆ·æ–°">ä¸è§¦å‘åˆ·æ–°</h3><p>æ³¨æ„æŸ¥çœ‹<strong>æ»šåŠ¨æ¡</strong>ã€‚</p>
<h4 id="å‘å·¦ä¸‹æ»‘-1"><strong>å‘å·¦ä¸‹æ»‘</strong></h4><p><img src="http://ww2.sinaimg.cn/bmiddle/7f793092gw1ev34y348moj20u01hc454.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.169</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.249</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.273</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.290</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.307</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.324</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.341</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.358</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.375</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">54.392</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line">...                                                                                           &lt;-- <span class="function"><span class="title">onTouchEvent</span><span class="params">()</span></span> Never Called!</span><br></pre></td></tr></table></figure>
<h4 id="å‘å³ä¸‹æ»‘-1"><strong>å‘å³ä¸‹æ»‘</strong></h4><p><img src="http://ww2.sinaimg.cn/bmiddle/7f793092gw1ev34xmt6cjj20u01hcn3w.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">01.868</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.028</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.050</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.067</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.084</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.102</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.119</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">24</span>:<span class="number">02.136</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line">...                                                                                           &lt;-- <span class="function"><span class="title">onTouchEvent</span><span class="params">()</span></span> Never Called!</span><br></pre></td></tr></table></figure>
<h4 id="ç¬”ç›´å‘ä¸‹æ»‘-1"><strong>ç¬”ç›´å‘ä¸‹æ»‘</strong></h4><p><img src="http://ww4.sinaimg.cn/bmiddle/7f793092gw1ev34x7oe5fj20u01hcdm9.jpg" alt=""></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.059</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.185</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.203</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.222</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.237</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.247</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line"><span class="number">08</span>-<span class="number">15</span> <span class="number">11</span>:<span class="number">21</span>:<span class="number">47.265</span>  <span class="number">28406</span>-<span class="number">28406</span>/com<span class="class">.example</span><span class="class">.android</span><span class="class">.swiperefreshlayoutbasic</span> D/SSwipeBIï¹• false</span><br><span class="line">...                                                                                           &lt;-- <span class="function"><span class="title">onTouchEvent</span><span class="params">()</span></span> Never Called!</span><br></pre></td></tr></table></figure>
<h3 id="SwipeRefreshLayout_è¡Œä¸ºæ€»ç»“">SwipeRefreshLayout è¡Œä¸ºæ€»ç»“</h3><p>ä»ä¸Šé¢ä¸¤ç±»å¤§æƒ…å†µï¼Œå…­ç§å°æƒ…å†µæ¥çœ‹ï¼Œå®ƒçš„è¡Œä¸ºå’Œæ–‡æ¡£å†™æ˜çš„ä¸€è‡´ï¼š</p>
<ul>
<li><p>è§¦å‘åˆ·æ–°</p>
<ul>
<li><p>å½“è§¦å±å‘ç”Ÿæ—¶ï¼Œäº‹ä»¶å…ˆåˆ°è¾¾<code>onInterceptTouchEvent()</code></p>
</li>
<li><p><code>onInterceptTouchEvent()</code>æ”¶åˆ°äº‹ä»¶åï¼Œè¿”å›<code>false</code>ï¼Œåˆ™æ­¤äº‹ä»¶ä¼šå‘ä¸‹ä¼ é€’åˆ° <strong>target view</strong> ,åŒæ—¶ä½¿å¾—ä¸‹ä¸€æ¬¡äº‹ä»¶ä¹Ÿæ˜¯ä¹Ÿ<strong>å…ˆç»è¿‡æ­¤æ–¹æ³•</strong>ã€‚</p>
</li>
<li><p>ç»è¿‡å‡ æ¬¡äº‹ä»¶å<code>onInterceptTouchEvent()</code>è¿”å›<code>true</code>ï¼Œä¹‹åçš„äº‹ä»¶éƒ½<strong>ä¸å†ç»è¿‡æ­¤æ–¹æ³•</strong>ï¼Œä¹Ÿä¸ä¼šä¼ ç»™ target viewï¼Œ<strong>ç›´æ¥ä¼ ç»™</strong><code>SwipeRefreshLayout.onTouchEvent()</code>ã€‚</p>
</li>
<li><p><code>SwipeRefreshLayout.onTouchEvent()</code>æ¥æ‰‹äº‹ä»¶ï¼Œ <strong>target view</strong> ä¸å†æ”¶åˆ°ä»»ä½•äº‹ä»¶ï¼Œä¸‹æ‹‰åˆ·æ–°çš„æŒ‡ç¤ºå›¾æ ‡å¼€å§‹å‡ºç°ã€‚</p>
</li>
</ul>
</li>
<li><p>ä¸è§¦å‘åˆ·æ–°</p>
<ul>
<li><p>å½“è§¦å±å‘ç”Ÿæ—¶ï¼Œäº‹ä»¶å…ˆåˆ°è¾¾<code>onInterceptTouchEvent()</code></p>
</li>
<li><p><code>onInterceptTouchEvent()</code>æ”¶åˆ°äº‹ä»¶åï¼Œåˆ¤è¯»ä¸ºæ­¤æ¬¡æ‰‹åŠ¿æ²¡æœ‰åˆ·æ–°çš„æ„å›¾ï¼Œä¸€ç›´è¿”å›<code>false</code>ã€‚</p>
</li>
</ul>
</li>
</ul>
<p><code>onInterceptTouchEvent()</code>è¿”å›çš„ç»“æœå°±æ˜¯æˆ‘ä»¬è¦çš„å¾ªç¯ä¸å˜é‡ï¼Œåˆ†æåˆ°æ­¤å·®ä¸å¤šå°±ç»“æŸäº†ï¼Œæ ¹æ®å®ƒçš„è¡Œä¸ºï¼Œå¯ä»¥å¾ˆè½»æ¾çš„é™ä½å®ƒçš„æ•æ„Ÿåº¦ã€‚</p>
<h2 id="é™ä½_SwipeRefreshLayout_çš„æ•æ„Ÿåº¦">é™ä½ SwipeRefreshLayout çš„æ•æ„Ÿåº¦</h2><p><em>æ­¤å°èŠ‚éƒ¨åˆ†å†…å®¹æœ‰å…³ <code>MotionEvent</code>, ç”±äºç¯‡å¹…åŸå› ä¸å†èµ˜è¿°ã€‚è¯¦è§å‚è€ƒèµ„æ–™ã€‚</em></p>
<p>è¿”å›æˆ‘ä»¬ç¢°åˆ°é—®é¢˜ä¸­æ¥ï¼Œç°åœ¨æœ‰ä¸ª WebView åµŒåœ¨ SwipeRefreshLayout ä¸­ï¼Œè¯¥ WebView å‘ˆç°çš„ç½‘é¡µä¸­æœ‰ä¸ªå›¾ç‰‡è½®æ’­ï¼Œä½†æˆ‘ä»¬æƒ³åˆ‡æ¢å›¾ç‰‡æ—¶ç»å¸¸ä¼šè¢« SwipeRefreshLayout æ‰“æ–­ï¼Œä½¿åˆ‡æ¢å›¾ç‰‡çš„åŠ¨ä½œæˆä¸ºä¸‹æ¥åˆ·æ–°çš„åŠ¨ä½œï¼Œé€ æˆä½¿ç”¨ä½“éªŒä¸Šçš„ç¼ºé™·ã€‚</p>
<p>æ—¢ç„¶ SwipeRefreshLayout çœŸæ­£æ¥æ‰‹è§¦å±äº‹ä»¶æ˜¯ä» <code>onInterceptTouchEvent()</code> è¿”å› <code>true</code> å¼€å§‹çš„ã€‚é‚£æˆ‘ä»¬åªè¦è§¦å±äº‹ä»¶å¼€å§‹æ—¶åˆ¤æ–­ç”¨æˆ·æ˜¯æƒ³åˆ·æ–°è¿˜æ˜¯åƒåˆ‡æ¢å›¾ç‰‡ã€‚è§£å†³çš„æ€è·¯æ¸…æ™°äº†ï¼Œæ¥ä¸‹æ¥æ˜¯åˆ¤æ–­çš„ç­–ç•¥</p>
<p>å¦‚ä½•åˆ¤æ–­ç”¨æˆ·çš„æ„å›¾ï¼Ÿæˆ‘ä»¬å¯ä»¥ç®€å•ä¸€ç‚¹ï¼Œå–ä» <code>ACTION_DOWN</code> å¼€å§‹çš„ä¸¤æ¬¡ <code>ACTION_MOVE</code>,å¹¶è®¡ç®—ä¸¤ç‚¹æ‰€æ„æˆçš„ç›´çº¿åŒå±å¹• <code>X</code> è½´æ‰€å‘ˆçš„è§’åº¦ï¼š</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">O                 X</span><br><span class="line">  +----------------+</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">        M1 +    </span>|</span><br><span class="line">  |<span class="string">         /      </span>|</span><br><span class="line">  |<span class="string">       /ang     </span>|</span><br><span class="line">  |<span class="string">  M2 + ----- X  </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">  |<span class="string">                </span>|</span><br><span class="line">Y +----------------+</span><br></pre></td></tr></table></figure>
<p>å½“ç”¨æˆ·æ‰‹åŠ¿çš„å¤´ä¸¤æ¬¡ <code>ACTION_MOVE</code> æ„æˆè§’åº¦å°äº <code>ang</code> æ—¶å°±è®© <code>onInterceptTouchEvent()</code> ä¸€ç›´è¿”å› <code>false</code> ç›´åˆ° <code>ACTION_UP</code> ä¸ºæ­¢ã€‚è¿™æ ·ä¿è¯äº† SwipeRefreshLayout ä¸ä¼šè½»æ˜“åœ°æˆªæ–­è§¦å±äº‹ä»¶ï¼Œè®© <strong>target view</strong> æœ‰æœºä¼šå¤„ç†è¯¥äº‹ä»¶ï¼ŒåŒæ—¶ä¹Ÿä¿è¯äº†å¾ªç¯ä¸å˜å¼çš„æˆç«‹ï¼Œä¸ä¼šå½±å“ SwipeRefreshLayout çš„æ­£å¸¸å·¥ä½œã€‚</p>
<h2 id="SHOW_ME_THE_CODE">SHOW ME THE CODE</h2><script src="https://gist.github.com/Overvenus/dc0ec5c4de5c27585c91.js"></script>

<p>æ¬¢è¿åˆ°æˆ‘çš„<a href="https://gist.github.com/Overvenus/dc0ec5c4de5c27585c91#file-numbswiperefreshlayout-java" target="_blank" rel="external">Gist</a>æŸ¥çœ‹ä»£ç ã€‚</p>
<h3 id="NumbSwipeRefreshLayout_æ•ˆæœ">NumbSwipeRefreshLayout æ•ˆæœ</h3><p>æ³¨æ„æŸ¥çœ‹<strong>ä¸Šæ–¹é˜´å½±</strong>ã€‚</p>
<p><img src="http://ww1.sinaimg.cn/bmiddle/7f793092gw1ev3c6eyty8j20u01hc0zi.jpg" alt=""><img src="http://ww4.sinaimg.cn/bmiddle/7f793092gw1ev3c6qlmwhj20u01hcwl4.jpg" alt=""></p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2><blockquote>
<p><a href="https://android.googlesource.com/platform/frameworks/support/+/d9df810a8e9ac28148c853249f0951329053c784/v4/java/android/support/v4/widget/SwipeRefreshLayout.java" target="_blank" rel="external">SwipeRefreshLayout æºç </a><br><a href="https://developer.android.com/reference/android/support/v4/widget/SwipeRefreshLayout.html" target="_blank" rel="external">SwipeRefreshLayout æ–‡æ¡£</a><br><a href="https://developer.android.com/training/gestures/viewgroup.html" target="_blank" rel="external">Managing Touch Events in a ViewGroup</a><br><a href="https://developer.android.com/reference/android/view/ViewGroup.html#onInterceptTouchEvent(android.view.MotionEvent" target="_blank" rel="external">ViewGroup.onInterceptTouchEvent(MotionEvent)</a><br><a href="https://developer.android.com/reference/android/view/View.html#onTouchEvent(android.view.MotionEvent" target="_blank" rel="external">View.onTouchEvent(MotionEvent)</a><br><a href="https://developer.android.com/reference/android/view/MotionEvent.html" target="_blank" rel="external">MotionEvent</a><br><a href="http://stackoverflow.com/a/12559204/3920448" target="_blank" rel="external">Calculate gesture distance in Android â€” Stack Overflow</a><br><a href="http://android-developers.blogspot.com/2010/06/making-sense-of-multitouch.html" target="_blank" rel="external">Making Sense of Multitouch</a><br><a href="https://en.wikipedia.org/wiki/False_positives_and_false_negatives" target="_blank" rel="external">False positives and false negatives</a></p>
</blockquote>
<p>ä¸ªäººç¬”è®°ï¼Œéš¾å…æœ‰è¯¯ï¼Œå¦‚æœ‰å‘ç°ï¼Œè¿˜æœ›æŒ‡å‡ºã€‚<br>END.</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="PullToRefresh_ä¸_SwipeRefreshLayout">PullToRefresh ä¸ SwipeRefreshLayout</h2><p>è¿™æ®µæ—¶é—´æˆ‘åœ¨ Easyinking å…¬å¸å®ä¹ ï¼Œ åšå®‰å“å¼€å‘ã€‚ä¹‹å‰çš„ App ä¸­å¤§é‡ä½¿ç”¨ <a href="https://github.com/chrisbanes/Android-PullToRefreshhttps://github.com/chrisbanes/Android-PullToRefresh">Android-PullToRefresh</a>ã€‚è¿™ä¸ªè½®å­å¾ˆç»å…¸ï¼Œåœ¨è¾ƒä¹…ç‰ˆæœ¬çš„å®‰å“ä¸Šé¢ä¹Ÿå¾ˆå¥½ä½¿ï¼Œä¸è¿‡ä½œè€…å·²ç»æ”¾å¼ƒç»´æŠ¤äº†ï¼Œåœ¨æˆ‘ä»¬çš„ App ä¸Šä¹Ÿå‘ç°äº†ä¸€ä¸ªè¯¡å¼‚çš„BUGï¼šä¸WebViewé…åˆä½¿ç”¨æ—¶ï¼Œåœ¨ç½‘ç»œç¯å¢ƒå·®çš„æƒ…å†µä¸‹ä¼šå‡ºç°ä¸€æ¬¡ä¸‹æ‹‰å¤šæ¬¡åˆ·æ–°çš„æƒ…å†µï¼Œç—‡çŠ¶å°±æ˜¯æ•´ä¸ªç½‘é¡µåœ¨é‚£ä¸Šä¸‹æŠ½æã€‚åœ¨å®˜æ–¹æ”¯æŒåº“ support-v4:22 ä¸­è‡ªå¸¦äº†ä¸€ä¸ªç±»ä¼¼çš„ SwipeRefreshLayoutï¼Œæ•ˆæœä¹Ÿæ˜¯ä¸€çº§æ£’ã€‚ç”±äºä¸¤è€…çš„ API è®¾è®¡å·®ä¸å¤šï¼Œä½¿ç”¨çš„æƒ…æ™¯ä¹Ÿå‡ ä¹ä¸€æ ·ï¼Œæ‰€ä»¥å¯ä»¥æ— ç—›åœ°ä» <a href="https://github.com/chrisbanes/Android-PullToRefreshhttps://github.com/chrisbanes/Android-PullToRefresh">PullToRefresh</a> è½¬ç§»è¿‡æ¥ã€‚</p>
<h2 id="æ•æ„Ÿçš„_SwipeRefreshLayout">æ•æ„Ÿçš„ SwipeRefreshLayout</h2><p>ä» PullToRefresh è½¬ç§»åˆ° SwipeRefreshLayout å¤§æ¦‚èŠ±äº†åæ¥åˆ†é’Ÿï¼Œåˆæ­¥æµ‹è¯•å‡ºæ¥çš„æ•ˆæœä¹Ÿä»¤äººæ»¡æ„ã€‚ä½†æ˜¯ï¼Œå®é™…ä½¿ç”¨ä¸­æ€»ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚æˆ‘ä»¬æŠŠä¸€ä¸ªWebViewæ”¾åœ¨äº† SwipeRefreshLayout ä¸­ï¼Œ è¯¥ WebView å‘ˆç°çš„ç½‘é¡µä¸­æœ‰ä¸€ä¸ªå›¾ç‰‡è½®æ’­ï¼Œå¯å·¦å³æ»‘åŠ¨ï¼Œä¸‹é¢çš„é—®é¢˜æ˜¯ SwipeRefreshLayout è¿‡äºæ•æ„Ÿï¼Œå®ƒæŠŠç¨æœ‰ä¸‹æ‹‰å€¾å‘çš„å·¦å³æ»‘åŠ¨å…¨éƒ¨æ‹¦æˆªæ‰ï¼Œå¹¶æŠŠä»–ä»¬å½“ä½œä¸‹æ‹‰çš„æ‰‹åŠ¿ï¼Œå…¸å‹çš„ False Positive ï¼Œ å¤„ç†çš„æ€è·¯ä¹Ÿå¾ˆç®€å•ï¼Œæ—¢ç„¶æ˜¯è¯¯æŠ¥ï¼Œè¿‡æ»¤ä¹‹å³å¯ã€‚</p>
<h3 id="è¯¯æŠ¥çš„æ‰‹åŠ¿"><strong>è¯¯æŠ¥çš„æ‰‹åŠ¿</strong></h3><p><img src="http://ww1.sinaimg.cn/bmiddle/7f793092gw1ev1xydoiwoj20u01hcwoe.jpg" alt=""><img src="http://ww3.sinaimg.cn/bmiddle/7f793092gw1ev1ys28bm4j20u01hc12q.jpg" alt=""></p>
<h3 id="ç†æƒ³ä¸­çš„æ‰‹åŠ¿"><strong>ç†æƒ³ä¸­çš„æ‰‹åŠ¿</strong></h3><p><img src="http://ww1.sinaimg.cn/bmiddle/7f793092gw1ev1ytgovwpj20u01hcgve.jpg" alt=""></p>]]>
    
    </summary>
    
      <category term="Android" scheme="http://neilsh.me/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[GOTOä¸æ‹“æ‰‘æ’åº]]></title>
    <link href="http://neilsh.me/2015/07/04/goto_and_topological_sorting/"/>
    <id>http://neilsh.me/2015/07/04/goto_and_topological_sorting/</id>
    <published>2015-07-04T14:26:00.000Z</published>
    <updated>2015-11-07T04:04:21.000Z</updated>
    <content type="html"><![CDATA[<h2 id="goto_in_C">goto in C</h2><p><code>goto</code>åœ¨Cè¯­è¨€ä¸­å¯ä»¥å®ç°æ— é™åˆ¶è·³è½¬ï¼Œç°åœ¨æœ‰å¾ˆå¤šäººéƒ½å»ºè®®åœ¨å®é™…ç¼–ç¨‹ä¸­ä½¿ç”¨å®ƒï¼Œå› ä¸ºå®ƒä¼šä½¿ç¨‹åºçš„æ§åˆ¶æµç¨‹(control flow)å˜å¾—æ··ä¹±ï¼Œéš¾ä»¥é˜…è¯»ã€‚</p>
<h3 id="goto,_break,_continue">goto, break, continue</h3><p><code>goto</code>,<code>break</code>,<code>continue</code> ä¸‰è€…éƒ½å¯ä»¥æ‰“æ–­æ§åˆ¶æµç¨‹ï¼Œä½†åä¸¤è€…éƒ½æ˜¯æœ‰é™åˆ¶çš„ï¼Œåªèƒ½æ‰“æ–­å½“å‰çš„<code>{}</code>(scope)ã€‚<br><code>continue</code> åªèƒ½å†™åœ¨loopé‡Œï¼Œä¸ç„¶ç¼–è¯‘æŠ¥ï¼šcontinue statement not within loopï¼Œ<br><code>break</code>åªèƒ½å†™åœ¨loopæˆ–è€…switchä¸­ï¼Œä¸ç„¶ç¼–è¯‘æŠ¥ï¼šbreak statement not within loop or switchã€‚<br><code>goto</code>åˆ™ä¸åŒï¼Œå®ƒå¯å†™åœ¨å’Œè·³è½¬åˆ°å‡½æ•°çš„ä»»æ„è¡Œï¼Œè‡ªç”±åº¦æå¤§ï¼Œä¸€ä¸ªä¸å°å¿ƒå°±ä¼šæœ‰bugï¼Œè¿™æ ·çš„ä»£ç é€šå¸¸ä¹Ÿéš¾ä»¥ç»´æŠ¤ã€‚ä¸è¿‡ç”¨çš„å¥½å½“ç„¶ä¹Ÿå¯ä»¥å¢åŠ æ•ˆç‡çš„åŒæ—¶æåˆ°å¯è¯»æ€§ã€‚<br><a id="more"></a></p>
<blockquote>
<p>I think gotoâ€™s are fine, and they are often more readable than large<br>amounts of indentation. Thatâ€™s <em>especially</em> true if the code flow isnâ€™t<br>actually naturally indented (in this case it is, so I donâ€™t think using<br>goto is in any way <em>clearer</em> than not, but in general gotoâ€™s can be quite<br>good for readability).<br>â€”-Linus</p>
</blockquote>
<h2 id="æ‹“æ‰‘æ’åº">æ‹“æ‰‘æ’åº</h2><p>ã€Šç®—æ³•å¯¼è®ºã€‹ä¸­æ‹“æ‰‘æ’åºçš„ä¾‹å­ï¼Œç²‰è‰²çš„æ˜¯å„ç‰©ä»¶çš„ä¾èµ–å›¾ï¼Œé’è‰²çš„æ˜¯æ‹“æ‰‘æ’åºå›¾ã€‚<br><img src="http://ww4.sinaimg.cn/large/7f793092gw1ets46e3xppj20ok0kcq4d.jpg" alt=""><br>æ ¹æ®å›¾ï¼Œå¦‚æœè¿˜æ²¡ç©¿å†…è£¤ï¼Œæ‹¿å°±å¿…é¡»è¦ç©¿å†…è£¤é‚£ä¸ªèŠ‚ç‚¹å¼€å§‹èµ°èµ·ï¼›å¦‚æœå·²ç»ç©¿å¥½å†…è£¤å’Œè£¤å­äº†ï¼Œé‚£ä»è…°å¸¦å¼€å§‹èµ°èµ·ä¾¿å¯ã€‚<br>å¯ä»¥çœ‹å‡ºï¼Œæ‹“æ‰‘æ’åºå›¾ä¸­çš„å„ç‰©ä»¶çš„ä¾èµ–å…³ç³»ä¸ç®­å¤´ç›¸åï¼Œä¸ç®¡ä»å“ªç‚¹è¿›å…¥ï¼Œæœ€ç»ˆçš„è¿˜æ˜¯ä¼šåˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
<h2 id="å†…å­˜ç®¡ç†å¼•å‘çš„æ€è€ƒ">å†…å­˜ç®¡ç†å¼•å‘çš„æ€è€ƒ</h2><p>åœ¨JOSçš„å†…å­˜ç®¡ç†æ¨¡å—ä¸­ï¼Œæœ‰ä¸€ä¸ª<code>page_insert</code>çš„å‡½æ•°ï¼Œå®ƒè´Ÿè´£è®°å½•<code>page</code>çš„åœ°å€å’Œæƒé™ï¼Œè¿™ä¸ªå‡½æ•°æœ€ç»ˆçš„ç»“æœåªæœ‰ä¸€ä¸ªï¼Œä½†è¾“å…¥æœ‰å¤šç§æƒ…å†µï¼Œä¸ºäº†å¤„ç†è¿™äº›æƒ…å†µï¼ŒåŠ¿å¿…è¦å†™å¤šä¸ªåˆ¤æ–­ã€‚<br>æ’å…¥çš„<code>pagetable</code>ä¸­å¯¹åº”è¯¥<code>page</code>çš„æ¡ç›®æ˜¯å¦æœ‰æ—§çºªå½•ï¼Ÿå¦‚æœæ²¡æœ‰ç›´æ¥æ’å…¥ï¼Œè®¾ç½®æƒé™ï¼Œç»“æŸï¼›å¦‚æœæœ‰ï¼Œæ˜¯å¦åŒä¸€ä¸ª<code>page</code>ï¼Œå¦‚æœåŒä¸€ä¸ªï¼Œè®¾ç½®æ–°æƒé™ï¼Œç»“æŸï¼›å¦‚æœä¸æ˜¯åŒä¸€ä¸ªï¼Œåˆ æ‰æ—§è®°å½•ï¼Œæ’å…¥è¯¥<code>page</code>åœ°å€ï¼Œè®¾ç½®æƒé™ï¼Œç»“æŸã€‚<br>å¤§è‡´çš„é€»è¾‘è¯·çœ‹ä¸‹å›¾ï¼š<br><img src="http://ww3.sinaimg.cn/large/7f793092gw1etufs6cjxnj20av0m1gmq.jpg" alt=""></p>
<p>ä»æè¿°å¯çŸ¥ï¼Œåªæœ‰æ¡ä»¶è·³è½¬æ¥å¤„ç†è¿™äº›æƒ…å†µä¼šæœ‰è®¸å¤šé‡å¤çš„ä»£ç ï¼Œè€Œä¸”ä¸ç›´è§‚ï¼Œéš¾ä»¥ç†è§£ã€‚</p>
<h3 id="ä¸ç”¨gotoçš„page_insert">ä¸ç”¨<code>goto</code>çš„<code>page_insert</code></h3><p>æ— <code>goto</code>ï¼Œä½†ä»£ç é‡å¤ï¼Œåˆ¤æ–­å±‚çº§è¿‡å¤šï¼Œä¸æ˜“ç†è§£ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">page_insert</span><span class="params">(pde_t *pgdir, <span class="keyword">struct</span> PageInfo *pp, <span class="keyword">void</span> *va, <span class="keyword">int</span> perm)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">pte_t</span> *va_pte = pgdir_walk(pgdir, va, <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">if</span> (! va_pte)</span><br><span class="line">		<span class="comment">// E_NO_MEM, if page table couldn't be allocated</span></span><br><span class="line">		<span class="keyword">return</span> -E_NO_MEM;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">physaddr_t</span> pp_pa = page2pa(pp);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ((*va_pte) &amp; PTE_P) &#123;</span><br><span class="line">		<span class="comment">// There is something in this pte.</span></span><br><span class="line">		<span class="keyword">if</span> (PTE_ADDR(*va_pte) == pp_pa) &#123;</span><br><span class="line">			<span class="comment">// Re-insert</span></span><br><span class="line">			*va_pte = pp_pa | perm | PTE_P;</span><br><span class="line">			<span class="keyword">if</span> (perm | PTE_U)</span><br><span class="line">				<span class="comment">// Changes to User Table</span></span><br><span class="line">				pgdir[PDX(va)] |= PTE_U;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// Different page</span></span><br><span class="line">		page_remove(pgdir, va);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Nothing in this PTE</span></span><br><span class="line">	*va_pte = pp_pa | perm | PTE_P;</span><br><span class="line">	<span class="keyword">if</span> (perm | PTE_U)</span><br><span class="line">		<span class="comment">// Changes to User Table</span></span><br><span class="line">		pgdir[PDX(va)] |= PTE_U;</span><br><span class="line"></span><br><span class="line">	pp-&gt;pp_ref += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="ä½¿ç”¨gotoçš„page_insert">ä½¿ç”¨<code>goto</code>çš„<code>page_insert</code></h3><p>æœ‰<code>goto</code>ï¼Œä½†ä»£ç ä¸é‡å¤ï¼Œè·³è½¬å±‚çº§å°‘ï¼Œç›´è§‚ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">page_insert</span><span class="params">(pde_t *pgdir, <span class="keyword">struct</span> PageInfo *pp, <span class="keyword">void</span> *va, <span class="keyword">int</span> perm)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">pte_t</span> *va_pte = pgdir_walk(pgdir, va, <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">if</span> (! va_pte)</span><br><span class="line">		<span class="comment">// E_NO_MEM, if page table couldn't be allocated</span></span><br><span class="line">		<span class="keyword">return</span> -E_NO_MEM;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">physaddr_t</span> pp_pa = page2pa(pp);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (! (*va_pte) &amp; PTE_P)</span><br><span class="line">		<span class="comment">// Nothing in this PTE</span></span><br><span class="line">		<span class="keyword">goto</span> nonpresent;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// There is something in this pte.</span></span><br><span class="line">	<span class="keyword">if</span> (PTE_ADDR(*va_pte) == pp_pa)</span><br><span class="line">		<span class="comment">// Re-insert</span></span><br><span class="line">		<span class="keyword">goto</span> present_same;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="comment">// Different page</span></span><br><span class="line">		<span class="keyword">goto</span> present_different;</span><br><span class="line"></span><br><span class="line">	present_different:</span><br><span class="line">		page_remove(pgdir, va);</span><br><span class="line"></span><br><span class="line">	nonpresent:</span><br><span class="line">		*va_pte = pp_pa;</span><br><span class="line">		pp-&gt;pp_ref += <span class="number">1</span>;</span><br><span class="line">		tlb_invalidate(pgdir, va);</span><br><span class="line"></span><br><span class="line">	present_same:</span><br><span class="line">		*va_pte = pp_pa | perm | PTE_P;</span><br><span class="line">		<span class="keyword">if</span> (perm &amp; PTE_U)</span><br><span class="line">			<span class="comment">// Commits to User Table</span></span><br><span class="line">			pgdir[PDX(va)] |= PTE_U;</span><br><span class="line">		<span class="keyword">if</span> (perm &amp; PTE_W)</span><br><span class="line">			pgdir[PDX(va)] |= PTE_W;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="æ€»ç»“">æ€»ç»“</h2><ul>
<li><code>goto</code>æœ€å¥½ä¸åˆ¤æ–­å†™åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿ä»è¯­æ„ç†è§£æ­¤è¯­å¥ã€‚</li>
<li>å¦‚æœå‡ºå£åªæœ‰ä¸€ä¸ªï¼Œè¿›å£æœ‰å¤šä¸ªï¼Œå¯é€‚å½“ç”¨<code>goto</code>ï¼Œç¬¦åˆDRYã€‚</li>
</ul>
<h3 id="Another_fancy_case">Another fancy case</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// error handler</span></span><br><span class="line">swith(i) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        foo();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        bar();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        n = dosth_1();</span><br><span class="line">        <span class="keyword">if</span> (n)</span><br><span class="line">            <span class="keyword">goto</span> bad;</span><br><span class="line">        n = dosth_2();</span><br><span class="line">        <span class="keyword">if</span> (n)</span><br><span class="line">            <span class="keyword">goto</span> bad:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">    bad:</span><br><span class="line">        report();</span><br><span class="line">        <span class="keyword">end_t</span>his();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ›´å¤šèµ„æ–™">æ›´å¤šèµ„æ–™</h3><blockquote>
<p><a href="https://en.wikipedia.org/wiki/Gotohttps://en.wikipedia.org/wiki/Goto" target="_blank" rel="external">https://en.wikipedia.org/wiki/Gotohttps://en.wikipedia.org/wiki/Goto</a><br><a href="https://en.wikipedia.org/wiki/Topological_sorting" target="_blank" rel="external">https://en.wikipedia.org/wiki/Topological_sorting</a><br><a href="https://web.archive.org/web/20051128093253/http://kerneltrap.org/node/553/2131" target="_blank" rel="external">https://web.archive.org/web/20051128093253/http://kerneltrap.org/node/553/2131</a><br>Knuth, Donald E. â€œStructured Programming with go to Statements.â€ ACM Computing Surveys (CSUR) 6, no. 4 (1974): 261-301.</p>
</blockquote>
<p>ä¸ªäººç¬”è®°ï¼Œéš¾å…æœ‰è¯¯ï¼Œå¦‚æœ‰å‘ç°ï¼Œè¿˜æœ›æŒ‡å‡ºã€‚<br>END.</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="goto_in_C">goto in C</h2><p><code>goto</code>åœ¨Cè¯­è¨€ä¸­å¯ä»¥å®ç°æ— é™åˆ¶è·³è½¬ï¼Œç°åœ¨æœ‰å¾ˆå¤šäººéƒ½å»ºè®®åœ¨å®é™…ç¼–ç¨‹ä¸­ä½¿ç”¨å®ƒï¼Œå› ä¸ºå®ƒä¼šä½¿ç¨‹åºçš„æ§åˆ¶æµç¨‹(control flow)å˜å¾—æ··ä¹±ï¼Œéš¾ä»¥é˜…è¯»ã€‚</p>
<h3 id="goto,_break,_continue">goto, break, continue</h3><p><code>goto</code>,<code>break</code>,<code>continue</code> ä¸‰è€…éƒ½å¯ä»¥æ‰“æ–­æ§åˆ¶æµç¨‹ï¼Œä½†åä¸¤è€…éƒ½æ˜¯æœ‰é™åˆ¶çš„ï¼Œåªèƒ½æ‰“æ–­å½“å‰çš„<code>{}</code>(scope)ã€‚<br><code>continue</code> åªèƒ½å†™åœ¨loopé‡Œï¼Œä¸ç„¶ç¼–è¯‘æŠ¥ï¼šcontinue statement not within loopï¼Œ<br><code>break</code>åªèƒ½å†™åœ¨loopæˆ–è€…switchä¸­ï¼Œä¸ç„¶ç¼–è¯‘æŠ¥ï¼šbreak statement not within loop or switchã€‚<br><code>goto</code>åˆ™ä¸åŒï¼Œå®ƒå¯å†™åœ¨å’Œè·³è½¬åˆ°å‡½æ•°çš„ä»»æ„è¡Œï¼Œè‡ªç”±åº¦æå¤§ï¼Œä¸€ä¸ªä¸å°å¿ƒå°±ä¼šæœ‰bugï¼Œè¿™æ ·çš„ä»£ç é€šå¸¸ä¹Ÿéš¾ä»¥ç»´æŠ¤ã€‚ä¸è¿‡ç”¨çš„å¥½å½“ç„¶ä¹Ÿå¯ä»¥å¢åŠ æ•ˆç‡çš„åŒæ—¶æåˆ°å¯è¯»æ€§ã€‚<br>]]>
    
    </summary>
    
      <category term="Algorithms" scheme="http://neilsh.me/tags/Algorithms/"/>
    
      <category term="C" scheme="http://neilsh.me/tags/C/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[å†…æ ¸çš„å¯åŠ¨å’Œå»ºç«‹è™šæ‹Ÿå†…å­˜]]></title>
    <link href="http://neilsh.me/2015/07/02/os_setup_and_virtual_memory_setup/"/>
    <id>http://neilsh.me/2015/07/02/os_setup_and_virtual_memory_setup/</id>
    <published>2015-07-02T10:02:00.000Z</published>
    <updated>2015-11-07T04:04:21.000Z</updated>
    <content type="html"><![CDATA[<h2 id="å¼•è¨€">å¼•è¨€</h2><p>è¿™ç¯‡åšæ–‡å†™ JOS å¦‚ä½•å»ºç«‹è™šæ‹Ÿå†…å­˜ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ MIT6.828 Lab2 çš„ç­”æ¡ˆã€‚<br>JOS æ˜¯ MIT6.828 æ“ä½œç³»ç»Ÿè¯¾ç¨‹ä¸­ç»™å­¦ç”Ÿç»ƒä¹ ç”¨çš„å°å‹å†…æ ¸ã€‚JOS æ˜¯ä¸€ä¸ª X86 å¹³å°çš„32ä½æ“ä½œç³»ç»Ÿï¼Œå®ƒæ˜¯æ ¹æ® Unix ç¬¬6ç‰ˆ è®¾è®¡çš„ï¼Œä¹Ÿå°±æ˜¯è¿™ç¯‡paper <a href="http://pdos.csail.mit.edu/6.828/2014/readings/ritchie78unix.pdf" target="_blank" rel="external">The UNIX Time-Sharing System</a>ã€‚</p>
<h2 id="MMUçš„å·¥ä½œæœºåˆ¶">MMUçš„å·¥ä½œæœºåˆ¶</h2><p><code>MMU</code>æ˜¯ x86 CPU é›†æˆçš„ä¸€ä¸ªç¡¬ä»¶ï¼Œè´Ÿè´£æŠŠè™šæ‹Ÿåœ°å€ç¿»è¯‘æˆç‰©ç†åœ°å€ã€‚å¢åŠ ä¸€å±‚ç¿»è¯‘ä¸æ˜¯ä¼šé™ä½æ€§èƒ½ï¼Œé‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ç‰©ç†åœ°å€ï¼Ÿè¿™æ˜¯å› ä¸ºè®¾è®¡ Computer å’Œ OS çš„ Scientists ä¸ºäº†å®ç°ä¸åŒåº”ç”¨ç¨‹åºä¹‹é—´çš„ isolation ä»¥å¢åŠ  safety å’Œé™ä½åº”ç”¨ç¨‹åºçš„ Complexityã€‚<br><code>MMU</code>åœ¨è®¡ç®—æœºå¯åŠ¨åˆæœŸæ˜¯ä¸å·¥ä½œçš„ï¼Œåªæœ‰å¯„å­˜å™¨<code>cr0</code>ä¸­çš„flagæ‰“å¼€ï¼Œå®ƒæ‰ä¼šå·¥ä½œã€‚</p>
<p>æœ¬æ–‡å†™æœ€ç®€å•çš„32ä½è™šæ‹Ÿå†…å­˜æœºåˆ¶ï¼ŒåŒæ ·ä¹Ÿæ˜¯ JOS ç”¨çš„ã€‚<br>å…ˆç¥­å‡ºä¸€å¼ ç¥å›¾ï¼Œè¿™å¼ å›¾ç”ŸåŠ¨å½¢è±¡çš„è¯´æ˜äº†<code>MMU</code>çš„å·¥ä½œæµç¨‹ï¼š<br><a id="more"></a><br><img src="http://ww1.sinaimg.cn/large/7f793092gw1etosykok6uj216o1kwdq0.jpg" alt=""><br>æœ¯è¯­è¯´æ˜ï¼š</p>
<blockquote>
<p><code>page</code>: <code>MMU</code> åœ¨é€»è¾‘ä¸ŠæŠŠå†…å­˜åˆ†å‰²ä¸ºä¸€ä¸ªä¸€ä¸ª4KBå¤§å°çš„å—ã€‚<br><code>page table</code>: ä¸€ä¸ª <code>page</code>ï¼Œå¤§å°4KBï¼Œå†…å®¹æ˜¯<em>1024ä¸ª</em>æŒ‡å‘ä¸åŒ <code>page</code> çš„åœ°å€åŠå…¶æƒé™ã€‚<br><code>page directory</code>ï¼šä¸€ä¸ª <code>page</code>ï¼Œå¤§å°4KBï¼Œå†…å®¹æ˜¯<em>1024ä¸ª</em>æŒ‡å‘ä¸åŒ <code>page table</code> çš„åœ°å€åŠå…¶æƒé™ã€‚<br><code>cr3</code>: x86 CPU ä¸­çš„ä¸€ä¸ªå¯„å­˜å™¨ï¼Œå­˜æœ‰ä¸€ä¸ª32ä½çš„åœ°å€ï¼ŒæŒ‡å‘ä¸€ä¸ª <code>page directory</code>ã€‚</p>
</blockquote>
<p>å•ä¸ª<code>page</code>çš„å¯»å€ï¼š</p>
<blockquote>
<p>4KB = 4096 = 0x1000</p>
</blockquote>
<p>ç”±äºæ¯ä¸€ä¸ª <code>page</code> éƒ½æ˜¯4KBï¼Œå®ƒä»¬çš„èµ·å§‹åœ°å€æ˜¯<em>0x?????000</em>ï¼Œä»¥3ä¸ª0x0ç»“å°¾ï¼Œæ‰€ä»¥<em>çœŸæ­£æœ‰æ•ˆ</em>çš„æ•°æ®æ˜¯å‰20bitsã€‚ä¹‹åçš„12bitså¯ç”¨æ¥è®¾ç½®è¯¥ <code>page</code>çš„æƒé™ã€‚è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆç¥å›¾ä¸­ä»…é å‰20bitsçš„<code>PPN</code>å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„<code>page</code>ã€‚</p>
<p>ä¸€ä¸ª<code>page directory</code>è¶³ä»¥æ˜ å°„4GBçš„å†…å­˜ï¼š</p>
<blockquote>
<p>1 x 1024 x 1024 x (4 x 1024) = 4GB<br>one <code>cr3</code> points to one <code>page directory</code><br>one <code>page directory</code> has 1024 <code>page tables</code><br>one <code>page table</code> has 1024 <code>pages</code><br>one <code>page</code> has 4KB memory</p>
</blockquote>
<h2 id="BootLoader_åˆ°å†…æ ¸">BootLoader åˆ°å†…æ ¸</h2><p>BIOS æŠŠç¡¬ç›˜ç¬¬ä¸€ä¸ªæ‰‡åŒºçš„æ•°æ®(BootLoader)åŠ è½½åˆ°å†…å­˜ç‰©ç†åœ°å€<code>0x7c00</code>åï¼Œä¾¿æŠŠ<code>eip = 7c00</code>ï¼ŒCPU å¼€å§‹æ‰§è¡Œå†…å­˜<code>7c00</code>å¤„(BootLoader)çš„ä»£ç ï¼Œæ­¤æ—¶ CPU è¿˜æœªå¼€å¯ <code>PAGING</code>ï¼Œå¹¶å¤„äº16ä½æ¨¡å¼ã€‚BootLoagerè¦åšçš„å°±æ˜¯å…³é—­ä¸­æ–­ï¼Œå¼€å¯ä¿æŠ¤æ¨¡å¼ï¼Œè¿›å…¥32ä½å·¥ä½œçŠ¶æ€ï¼Œå¹¶ä¸”æŠŠç¡¬ç›˜ä¸­çš„å†…æ ¸åŠ è½½ä»£å†…å­˜<code>0x10000</code>å¤„ï¼Œç„¶åæŠŠç¡¬ä»¶çš„ä½¿ç”¨æƒç§»äº¤ç»™å†…æ ¸ã€‚</p>
<h2 id="å†…æ ¸åˆæœŸçš„å†…å­˜æ˜ å°„">å†…æ ¸åˆæœŸçš„å†…å­˜æ˜ å°„</h2><h3 id="å¼€å¯_MMU">å¼€å¯ MMU</h3><p>å†…æ ¸æ¥ç®¡ç¡¬ä»¶åï¼Œæ‰€æœ‰çš„åœ°å€éƒ½æ˜¯ç‰©ç†åœ°å€ï¼Œ<code>eip</code>å¯„å­˜å™¨æŒ‡å‘ç‰©ç†åœ°å€çš„å†…æ ¸æŒ‡ä»¤ã€‚ä¹‹åï¼Œå†…æ ¸ç¬¬ä¸€æ—¶é—´å¼€å¯äº†<code>MMU</code>ã€‚ä¸‹é¢æ˜¯ JOS å†…æ ¸å¯åŠ¨çš„å¤´å‡ æ¡æ±‡ç¼–ä»£ç ï¼Œåœ¨<code>entry.S</code>æ–‡ä»¶ä¸­ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">.text</span><br><span class="line"><span class="preprocessor"># The Multiboot header</span></span><br><span class="line">.align <span class="number">4</span></span><br><span class="line">.<span class="keyword">long</span> MULTIBOOT_HEADER_MAGIC</span><br><span class="line">.<span class="keyword">long</span> MULTIBOOT_HEADER_FLAGS</span><br><span class="line">.<span class="keyword">long</span> CHECKSUM</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># '_start' specifies the ELF entry point.  Since we haven't set up</span></span><br><span class="line"><span class="preprocessor"># virtual memory when the bootloader enters this code, we need the</span></span><br><span class="line"><span class="preprocessor"># bootloader to jump to the *physical* address of the entry point.</span></span><br><span class="line">.globl		_start</span><br><span class="line">_start = RELOC(entry)</span><br><span class="line"></span><br><span class="line">.globl entry</span><br><span class="line">entry:</span><br><span class="line">	movw	$<span class="number">0x1234</span>,<span class="number">0x472</span>			<span class="preprocessor"># warm boot</span></span><br><span class="line"></span><br><span class="line">    <span class="preprocessor"># entry_pgdir æ˜¯ page directoryï¼Œè¢«ç¡¬ç¼–ç åœ¨å†…æ ¸ä¸­ã€‚</span></span><br><span class="line">	movl	$(RELOC(entry_pgdir)), %eax</span><br><span class="line">	movl	%eax, %cr3</span><br><span class="line">	<span class="preprocessor"># Turn on paging.  å¼€å¯ PAGING</span></span><br><span class="line">	movl	%cr0, %eax</span><br><span class="line">	orl	$(CR0_PE|CR0_PG|CR0_WP), %eax</span><br><span class="line">	movl	%eax, %cr0</span><br><span class="line"><span class="preprocessor">#æ¥ä¸‹é¢çš„æ±‡ç¼–ä»£ç </span></span><br></pre></td></tr></table></figure></p>
<p>ä½†æ­¤æ—¶è™šæ‹Ÿå†…å­˜è¿˜æ²¡æœ‰å»ºç«‹ï¼Œä»£ç æ“ä½œçš„åœ°å€è¿˜æ˜¯ç‰©ç†åœ°å€ï¼Œæ‰€ç”¨çš„ page directory åŠ page table ç¡¬ç¼–ç åœ¨å†…æ ¸ä¸­ï¼Œè™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€æ˜¯<em>ä¸€å¯¹ä¸€ä¸”è¿ç»­æ˜ å°„</em>çš„ã€‚<br>ä¸‹é¢æ˜¯ç¡¬ç¼–ç åœ¨å†…æ ¸ä¸­çš„ page directoryã€‚å¤§æ„å°±æ˜¯è™šæ‹Ÿåœ°å€<code>0x0000 0000ï½0x0040 0000</code>å’Œ<code>0xF000 0000ï½0xF040 0000</code>éƒ½æ˜ å°„åˆ°ç‰©ç†åœ°å€<code>0x0000 0000ï½0x0040 0000</code>ï¼Œä¸”æ˜¯<em>è¿ç»­ä¸€å¯¹ä¸€æ˜ å°„</em>ã€‚æ¢å¥è¯è¯´ï¼Œæ•´ä¸ªå†…æ ¸çš„è™šæ‹Ÿåœ°å€å°±æ˜¯ç‰©ç†åœ°å€åŠ ä¸Š<code>KERNBASE</code>ï¼Œè¯¦ç»†ä¸‹é¢å†…æ ¸ç»“æ„ä¼šè§£é‡Šã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">define</span> KERNBASE 0xF0000000</span></span><br><span class="line">__attribute__((__aligned__(PGSIZE)))  <span class="comment">// 4KB å¯¹é½</span></span><br><span class="line"><span class="keyword">pde_t</span> entry_pgdir[<span class="number">1024</span>] = &#123;</span><br><span class="line">	<span class="comment">// Map VA's [0, 4MB) to PA's [0, 4MB)</span></span><br><span class="line">	[<span class="number">0</span>]</span><br><span class="line">		= ((<span class="keyword">uintptr_t</span>)entry_pgtable - KERNBASE) + PTE_P,</span><br><span class="line">	<span class="comment">// Map VA's [KERNBASE, KERNBASE+4MB) to PA's [0, 4MB)</span></span><br><span class="line">	[KERNBASE&gt;&gt;<span class="number">22</span>]</span><br><span class="line">		= ((<span class="keyword">uintptr_t</span>)entry_pgtable - KERNBASE) + PTE_P + PTE_W</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>ä¸è¿‡è¿™æ ·åšè¿˜æ˜¯æœ‰é—®é¢˜ï¼Œè¿™ä¸ª page directory åŠå…¶ page table å¿…é¡»è¦åœ¨å†…å­˜å¼€å§‹çš„å¤´4MBä¹‹å†…ï¼Œä¸ç„¶MMUå°±ä¼šæŠ¥é”™ã€‚ä¸è¿‡å¹¸å¥½ï¼Œæˆ‘ä»¬çš„å†…æ ¸è¿˜ä¸å¤§ï¼Œ4MBè¶³å¤Ÿè£…ä¸‹ï¼Œå®é™…ä¸Šè¿˜æœ‰è®¸å¤šç©ºé—²çš„ç©ºé—´ã€‚</p>
<h3 id="å·¥ä½œåœ¨è™šæ‹Ÿåœ°å€">å·¥ä½œåœ¨è™šæ‹Ÿåœ°å€</h3><p>å¼€å¯<code>MMU</code>åï¼Œæ‰€æœ‰å¯¹å†…å­˜çš„æ“ä½œéƒ½ä¼šç»è¿‡ç¿»è¯‘ï¼ŒCPU çš„<code>eip</code>å¯„å­˜å™¨è¿˜æ˜¯æŒ‡å‘ä½ä½çš„ç‰©ç†åœ°å€ï¼Œä¸ºäº†åç»­ä»£ç çš„æ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬è¦æŠŠå®ƒè½¬åŒ–ä¸ºæŒ‡å‘é«˜ä½çš„è™šæ‹Ÿåœ°å€ï¼Œåœ¨ JOS è¿™ä¸ªè½¬åŒ–å¾ˆç®€å•ï¼Œå…¶å®è´¨å°±æ˜¯åŠ ä¸Š<code>KERNBASE</code>ï¼Œç†ç”±è§ä¸Šé¢<code>entry_pgdir</code>ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#æ¥ä¸Šé¢çš„æ±‡ç¼–ä»£ç ã€‚</span></span><br><span class="line">	<span class="preprocessor"># Now paging is enabled, but we're still running at a low EIP</span></span><br><span class="line">	<span class="preprocessor"># (why is this okay?).  Jump up above KERNBASE before entering</span></span><br><span class="line">	<span class="preprocessor"># C code.</span></span><br><span class="line">	mov	$relocated, %eax</span><br><span class="line">	jmp	*%eax</span><br><span class="line">relocated:  <span class="preprocessor"># æ­¤å¤„çš„è™šæ‹Ÿåœ°å€=ç‰©ç†åœ°å€+KERNBASE</span></span><br><span class="line">    <span class="preprocessor"># ...</span></span><br></pre></td></tr></table></figure>
<p><code>jmp</code>ä¹‹åå†…å­˜å°±æ­£å¼å·¥ä½œå®ŒæˆåˆæœŸçš„<code>PAGING</code>ã€‚<br>ä¸ºä»€ä¹ˆè¦<code>jmp</code>ä¸€ä¸‹ï¼ˆç–‘æƒ‘è„¸ï¼‰ï¼Ÿè¯·çœ‹<code>å†…æ ¸çš„ç»“æ„</code>ã€‚</p>
<h3 id="å†…æ ¸çš„ç»“æ„">å†…æ ¸çš„ç»“æ„</h3><p>æˆ‘<em>è®¤ä¸ºï¼ˆå¯èƒ½æœ‰é”™ï¼Œè¿˜æ²¡å­¦è¿‡ç¼–è¯‘ï¼‰</em>ï¼š</p>
<blockquote>
<p>JOS çš„å†…æ ¸æ˜¯è™šæ‹ŸæŒ‰åœ°å€é“¾æ¥çš„ï¼Œæ‰€æœ‰<code>symbol</code>ï¼ˆï¼Œä»£ç å’Œé™æ€å˜é‡ï¼Ÿï¼‰çš„åœ°å€éƒ½æ˜¯è™šæ‹Ÿåœ°å€ï¼ˆå¯¹äºå†…æ ¸åˆæœŸæ¥è¯´ï¼‰ã€‚</p>
</blockquote>
<p>è¿™å¥è¯æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿè¯·çœ‹å†…æ ¸çš„é“¾æ¥æ–‡ä»¶ã€‚<br><figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ENTRY<span class="params">(_start)</span></span><br><span class="line">SECTIONS</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* Link the kernel at this address: "." means the current address */</span></span><br><span class="line">	. = <span class="number">0</span>xF0100000;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* AT(...) gives the load address of this section, which tells</span><br><span class="line">	   the boot loader where to load the kernel in physical memory */</span></span><br><span class="line">	.<span class="built_in">text</span> : AT<span class="params">(<span class="number">0</span>x100000)</span> &#123;</span><br><span class="line">		<span class="built_in">*</span><span class="params">(.text .stub .text.* .gnu.linkonce.t.*)</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	PROVIDE<span class="params">(etext = .)</span>;	<span class="comment">/* Define the 'etext' symbol to this value */</span></span><br><span class="line">    <span class="comment">/* ... */</span></span><br></pre></td></tr></table></figure></p>
<p>ç”¨è¿™é“¾æ¥æ–‡ä»¶ç¼–è¯‘å‡ºçš„å†…æ ¸çš„ section headers å¦‚ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ objdump -h obj/kern/kernel&#10;&#10;obj/kern/kernel:     file format elf32-i386&#10;Sections:&#10;Idx Name          Size      VMA       LMA       File off  Algn&#10;  0 .text         00001947  f0100000  00100000  00001000  2**4&#10;                  CONTENTS, ALLOC, LOAD, READONLY, CODE&#10;  1 .rodata       00000770  f0101960  00101960  00002960  2**5&#10;                  CONTENTS, ALLOC, LOAD, READONLY, DATA&#10;  2 .stab         00003919  f01020d0  001020d0  000030d0  2**2&#10;                  CONTENTS, ALLOC, LOAD, READONLY, DATA&#10;  3 .stabstr      00001907  f01059e9  001059e9  000069e9  2**0&#10;                  CONTENTS, ALLOC, LOAD, READONLY, DATA&#10;  4 .data         0000a300  f0108000  00108000  00009000  2**12&#10;                  CONTENTS, ALLOC, LOAD, DATA&#10;  5 .bss          00000644  f0112300  00112300  00013300  2**5&#10;                  ALLOC&#10;  6 .comment      00000024  00000000  00000000  00013300  2**0&#10;                  CONTENTS, READONLY</span><br></pre></td></tr></table></figure>
<p><code>VMA</code>ï¼švirtual memory address | <code>LMA</code>ï¼šload memory address<br><code>0 .text         00001947  f0100000  00100000  00001000  2**4</code>ï¼Œ<br><code>.text</code>çš„è™šæ‹Ÿåœ°å€æ˜¯<code>0xf0100000</code>ï¼ŒåŠ è½½åœ°å€ï¼ˆæ‰§è¡Œåœ°å€ï¼‰<code>0x00100000</code>ã€‚<br>å†…æ ¸çš„ç¬¬ä¸€æ¡æŒ‡ä»¤åœ¨å†…å­˜<code>0x00100000</code>å¤„ï¼Œ<code>eip = 0x00100000</code>ï¼Œè™šæ‹Ÿåœ°å€æ˜¯<code>0xf0100000</code>ã€‚</p>
<p>å†çœ‹å†…æ ¸çš„ symbol tableï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ objdump -t obj/kern/kernel | sed &#39;1,/SYMBOL TABLE/d; s/ .* / /; /^$$/d&#39;&#10;addr.      sym.&#10;0010000c T _start&#10;f010000c T entry&#10;f010002f t relocated&#10;f010003e t spin&#10;f0100040 T i386_init&#10;f0100094 T _panic&#10;f01000f3 T _warn&#10;...</span><br></pre></td></tr></table></figure>
<p><code>0010000c T _start</code> å’Œ <code>f010000c T entry</code> å®ƒä»¬å°±æ˜¯ä¸Šé¢çš„æ±‡ç¼–ä»£ç ä¸­çš„<code>_start</code> å’Œ <code>entry</code>ã€‚<br>è¿™æ„å‘³ç€ <code>0010000c</code> å’Œ <code>f010000c</code> æŒ‡å‘çš„æ˜¯åŒä¸€å¤„ã€‚å› ä¸ºå†…æ ¸ä»<code>f010000c</code>å¼€å§‹é“¾æ¥ï¼Œæ‰€ä»¥<code>relocated</code>å¤„äºé«˜ä½ï¼ˆå³è™šæ‹Ÿåœ°å€ï¼‰ã€‚<code>jmp</code>æ˜¯ä¸ºäº†ä½¿<code>eip</code>æŒ‡å‘è™šæ‹Ÿåœ°å€çš„å†…æ ¸ä»£ç ã€‚<code>mov</code>æ˜¯ä¸ºäº†é˜²æ­¢ assembler æŠŠ<code>jmp</code>â€œä¼˜åŒ–â€æ‰ã€‚</p>
<h3 id="å†…æ ¸å»ºç«‹è™šæ‹Ÿå†…å­˜">å†…æ ¸å»ºç«‹è™šæ‹Ÿå†…å­˜</h3><p>å®Œæˆä¸Šé¢çš„å·¥ä½œä¹‹åï¼Œå†…æ ¸å¼€å§‹å»ºç«‹è™šæ‹Ÿå†…å­˜ã€‚<br><code>pmap.c</code>æ˜¯ JOS çš„å†…å­˜ç®¡ç†çš„æºç æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯ä¸€äº›å…³é”®çš„å…¨å±€å˜é‡ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// These variables are set by i386_detect_memory()</span></span><br><span class="line"><span class="keyword">size_t</span> npages;			<span class="comment">// Amount of physical memory (in pages)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">size_t</span> npages_basemem;	<span class="comment">// Amount of base memory (in pages)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// These variables are set in mem_init()</span></span><br><span class="line"><span class="keyword">pde_t</span> *kern_pgdir;		<span class="comment">// Kernel's initial page directory</span></span><br><span class="line"><span class="comment">// ç”¨æ¥ä»£è¡¨`page`çš„ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">struct</span> PageInfo *pages;		<span class="comment">// Physical page state array</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">struct</span> PageInfo *page_free_list;	<span class="comment">// Free list of physical pages</span></span><br></pre></td></tr></table></figure>
<p><code>void mem_init(void);</code>è¿™å‡½æ•°åˆå§‹åŒ–ç¡¬ä»¶çš„å…¨éƒ¨å†…å­˜å¹¶å»ºç«‹è™šæ‹Ÿå†…å­˜ã€‚ä¸‹é¢æˆ‘èŠ‚é€‰äº†éƒ¨åˆ†ä»£ç ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mem_init</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// Find out how much memory the machine has (npages &amp; npages_basemem).</span></span><br><span class="line">	<span class="comment">// é¦–å…ˆæ¢æµ‹æ‰€æœ‰çš„æœºå™¨æœ‰å¤šå°‘å†…å­˜</span></span><br><span class="line">	i386_detect_memory();</span><br><span class="line">	<span class="comment">//////////////////////////////////////////////////////////////////////</span></span><br><span class="line">	<span class="comment">// create initial page directory.</span></span><br><span class="line">	<span class="comment">// ç”¨ä¸€ä¸ªç®€æ˜“çš„ alloc å‡½æ•°ä¸ºå˜é‡`kern_pgdir`ç”³è¯·ä¸€ä¸ª`page`ï¼Œ</span></span><br><span class="line">	<span class="comment">// æ­¤`page`åœ¨kernelä¹‹åã€‚`kern_pgdir`æŒ‡å‘ä¸€ä¸ªé«˜ä½çš„è™šæ‹Ÿåœ°å€ã€‚</span></span><br><span class="line">	kern_pgdir = (<span class="keyword">pde_t</span> *) boot_alloc(PGSIZE);</span><br><span class="line">	<span class="built_in">memset</span>(kern_pgdir, <span class="number">0</span>, PGSIZE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æŠŠ`kern_pgdir`æ‰€åœ¨çš„ page çš„ä½ä½ç‰©ç†åœ°å€æ’å…¥åˆ°`kern_pgdir`å¯¹åº”çš„æ§½ä¸­ï¼Œ</span></span><br><span class="line">	<span class="comment">// å¹¶è®¾ç½®æƒé™ã€‚Permissions: kernel R, user R</span></span><br><span class="line">	kern_pgdir[PDX(UVPT)] = PADDR(kern_pgdir) | PTE_U | PTE_P;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä¸º`PageInfo`ç”³è¯·ç©ºé—´ï¼Œç‰©ç†å†…å­˜æœ‰å¤šå°‘å°±ç”³è¯·å¤šå°‘ä¸ª`PageInfo`ï¼Œè¿™ä¸ªé“¾è¡¨åœ¨`kern_pgdir`ä¹‹å</span></span><br><span class="line">	<span class="comment">// è¿™äº›`PageInfo`æ˜¯ä¸ºäº†æ–°çš„å†…å­˜ç®¡ç†æœºåˆ¶åšå‡†å¤‡çš„ï¼Œç”¨ä»¥è·Ÿè¸ªå„`page`çš„ä½¿ç”¨æƒ…å†µã€‚</span></span><br><span class="line">	pages = (<span class="keyword">struct</span> PageInfo *)boot_alloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> PageInfo) * npages);</span><br><span class="line">	<span class="comment">// ç­‰ç­‰ã€‚ã€‚ã€‚</span></span><br><span class="line">```	</span><br><span class="line"></span><br><span class="line">æ­¤æ—¶çš„ç‰©ç†å†…å­˜çš„ä½¿ç”¨æƒ…å†µæ˜¯è¿™æ ·çš„ï¼š</span><br></pre></td></tr></table></figure>
<pre><code>[BASEMEM] &lt;------------- 0x00000000
<span class="bullet">...
</span><span class="bullet">...   </span>640KB
<span class="bullet">...
</span>[IOPHYSMEM] &lt;----------- 0x000A0000
<span class="bullet">...
</span><span class="bullet">...   </span>I/O hole
<span class="bullet">...
</span>[EXTPHYSMEM] &lt;---------- 0x00100000
<span class="bullet">...
</span>extern char entry[]; &lt;-- 0x0010000c
<span class="bullet">...
</span><span class="bullet">...   </span>kernel
<span class="bullet">...
</span>extern char end[]; &lt;---- 0x00113970
<span class="bullet">...
</span><span class="bullet">...   </span>ç”±äº4KBå¯¹é½ï¼Œè¿™ä¼šæœ‰ç©ºç™½
<span class="bullet">...
</span><span class="code">`kern_pgdir`</span>
<span class="bullet">...
</span><span class="bullet">....  </span>one page gap
<span class="bullet">...
</span><span class="code">`pages`</span> itself!
<span class="bullet">...   </span>used!
<span class="bullet">...   </span>...
<span class="bullet">...   </span>used!
<span class="bullet">...   </span>unused!
</code></pre><figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ä¹‹åçš„ä¸€äº›å‡½æ•°æ ¹æ®ä¸Šé¢çš„å›¾æŠŠå·²ç”¨çš„å†…å­˜è®°å½•åˆ°`kern_pgdir`å’Œ`pagetable`ä¸­å¹¶è®¾ç½®æƒé™ã€‚è®°å½•çš„æ–¹æ³•å¤§è‡´æ˜¯è¿™æ ·çš„ï¼š</span><br><span class="line"></span><br><span class="line">```c</span><br><span class="line"><span class="comment">// addr &gt;&gt; 22 å–å‰10ä½</span></span><br><span class="line"><span class="comment">// (addr &gt;&gt;12) &amp; 0x3FF å–ä¸­é—´10ä½</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// log virtual_addr</span></span><br><span class="line">pagetable_phys_addr = kern_pgdir[virtual_addr&gt;&gt;<span class="number">22</span>]</span><br><span class="line">pagetable_phys_addr[<span class="params">(virtual_addr&gt;&gt;<span class="number">12</span>)</span> &amp; <span class="number">0</span>x3FF] = page_phys_addr</span><br><span class="line"></span><br><span class="line"><span class="comment">// `MMU` workflow</span></span><br><span class="line"><span class="comment">// virtual_addr to physical_addr</span></span><br><span class="line">pagetable_phys_addr = kern_pgdir[<span class="params">(virtual_addr)</span>&gt;&gt;<span class="number">22</span>]</span><br><span class="line">page_phys_addr = pagetable[<span class="params">(virtual_addr&gt;&gt;<span class="number">12</span>)</span> &amp; <span class="number">0</span>x3FF]</span><br><span class="line">physical_addr = <span class="params">(page_phy_addr &amp; <span class="number">0</span>x3FF)</span> | <span class="params">(virtual_addr &amp; <span class="number">0</span>xFFFFFC00)</span></span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œå†…æ ¸å®ç°äº†è™šæ‹Ÿå†…å­˜ï¼Œå¹¶èƒ½åŠ¨æ€åˆ†é…ï¼Œå¯ä»¥å¤šä¸ªè™šæ‹Ÿåœ°å€æŒ‡å‘åŒä¸€ç‰©ç†åœ°å€ã€‚JOS è¿™ç§çš„ç®¡ç†æ–¹å¼ä½¿å¾—<code>page</code>åªæœ‰åœ¨è¢«ä½¿ç”¨æ—¶æ‰ä¼šè®°å½•åˆ°<code>pagetable</code>ä¸­ï¼Œç±»ä¼¼äº lazy initializationã€‚<br>è¿™ç§è™šæ‹Ÿåœ°å€çš„è®°å½•æ–¹å¼ä¹ŸåŒæ ·è§£é‡Šäº†ä¸ºä»€ä¹ˆç¨‹åºåœ¨ä½¿ç”¨ä¸€ä¸ªé‡æŒ‡é’ˆçš„æ—¶å€™ä¼šé€€å‡ºï¼Œå› ä¸ºè¿™ä¸ªé‡æŒ‡é’ˆæŒ‡å‘çš„åœ°å€è¯¥ç¨‹åºæ— æƒè®¿é—®çš„å¯èƒ½æ€§å¾ˆå¤§ï¼Œä¸€æ—¦è®¿é—®<code>MMU</code>ä¼šæŠ¥<code>pagefault</code>ï¼Œä»è€Œä½¿ç¨‹åºé€€å‡ºã€‚</p>
<p>å®Œæ•´çš„ pmap.c æ–‡ä»¶åœ¨<a href="/asset/code/pmap.c">è¿™å¯ä»¥è·å–</a>ï¼Œé‡Œé¢æœ‰æ¯”è¾ƒå®Œæ•´çš„æ³¨é‡Šã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2><p>JOS å†…æ ¸ä¸€å¯åŠ¨å°±å¼€å¯<code>MMU</code>ï¼Œç”¨çš„<code>page directory</code>æ˜¯æ‰‹å†™çš„é¢„å…ˆç¼–è¯‘åœ¨å†…æ ¸ä¸­çš„ã€‚ä¹‹åå†å»ºç«‹ä¸€ä¸ªæ–°çš„<code>page directory</code>ï¼Œè¿™ä¸ª<code>page directory</code>æ˜¯å¯ä»¥åŠ¨æ€å¢åŠ å‡å°‘è®°å½•çš„ï¼Œæ­¤æ—¶ JOS å†…å­˜çš„åˆå§‹åŒ–ç®—æ˜¯å®Œæˆäº†ã€‚</p>
<p>ä¸ªäººç¬”è®°ï¼Œéš¾å…æœ‰è¯¯ï¼Œå¦‚æœ‰å‘ç°ï¼Œè¿˜æœ›æŒ‡å‡ºã€‚<br>END.</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="å¼•è¨€">å¼•è¨€</h2><p>è¿™ç¯‡åšæ–‡å†™ JOS å¦‚ä½•å»ºç«‹è™šæ‹Ÿå†…å­˜ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ MIT6.828 Lab2 çš„ç­”æ¡ˆã€‚<br>JOS æ˜¯ MIT6.828 æ“ä½œç³»ç»Ÿè¯¾ç¨‹ä¸­ç»™å­¦ç”Ÿç»ƒä¹ ç”¨çš„å°å‹å†…æ ¸ã€‚JOS æ˜¯ä¸€ä¸ª X86 å¹³å°çš„32ä½æ“ä½œç³»ç»Ÿï¼Œå®ƒæ˜¯æ ¹æ® Unix ç¬¬6ç‰ˆ è®¾è®¡çš„ï¼Œä¹Ÿå°±æ˜¯è¿™ç¯‡paper <a href="http://pdos.csail.mit.edu/6.828/2014/readings/ritchie78unix.pdf">The UNIX Time-Sharing System</a>ã€‚</p>
<h2 id="MMUçš„å·¥ä½œæœºåˆ¶">MMUçš„å·¥ä½œæœºåˆ¶</h2><p><code>MMU</code>æ˜¯ x86 CPU é›†æˆçš„ä¸€ä¸ªç¡¬ä»¶ï¼Œè´Ÿè´£æŠŠè™šæ‹Ÿåœ°å€ç¿»è¯‘æˆç‰©ç†åœ°å€ã€‚å¢åŠ ä¸€å±‚ç¿»è¯‘ä¸æ˜¯ä¼šé™ä½æ€§èƒ½ï¼Œé‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ç‰©ç†åœ°å€ï¼Ÿè¿™æ˜¯å› ä¸ºè®¾è®¡ Computer å’Œ OS çš„ Scientists ä¸ºäº†å®ç°ä¸åŒåº”ç”¨ç¨‹åºä¹‹é—´çš„ isolation ä»¥å¢åŠ  safety å’Œé™ä½åº”ç”¨ç¨‹åºçš„ Complexityã€‚<br><code>MMU</code>åœ¨è®¡ç®—æœºå¯åŠ¨åˆæœŸæ˜¯ä¸å·¥ä½œçš„ï¼Œåªæœ‰å¯„å­˜å™¨<code>cr0</code>ä¸­çš„flagæ‰“å¼€ï¼Œå®ƒæ‰ä¼šå·¥ä½œã€‚</p>
<p>æœ¬æ–‡å†™æœ€ç®€å•çš„32ä½è™šæ‹Ÿå†…å­˜æœºåˆ¶ï¼ŒåŒæ ·ä¹Ÿæ˜¯ JOS ç”¨çš„ã€‚<br>å…ˆç¥­å‡ºä¸€å¼ ç¥å›¾ï¼Œè¿™å¼ å›¾ç”ŸåŠ¨å½¢è±¡çš„è¯´æ˜äº†<code>MMU</code>çš„å·¥ä½œæµç¨‹ï¼š<br>]]>
    
    </summary>
    
      <category term="C" scheme="http://neilsh.me/tags/C/"/>
    
      <category term="C.S.ç¬”è®°" scheme="http://neilsh.me/tags/C-S-%E7%AC%94%E8%AE%B0/"/>
    
      <category term="MIT" scheme="http://neilsh.me/tags/MIT/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Hello World]]></title>
    <link href="http://neilsh.me/2015/06/29/hello-world/"/>
    <id>http://neilsh.me/2015/06/29/hello-world/</id>
    <published>2015-06-29T13:36:00.000Z</published>
    <updated>2015-11-07T04:04:21.000Z</updated>
    <content type="html"><![CDATA[<p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<a id="more"></a>
<h2 id="Quick_Start">Quick Start</h2><h3 id="Create_a_new_post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run_server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate_static_files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy_to_remote_sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Welcome to <a href="http://hexo.io/">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>]]>
    
    </summary>
    
  </entry>
  
</feed>
